<!DOCTYPE html>
<html lang="en" class="no-touch js-focus-visible" data-js-focus-visible="">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>VIA_버전2</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css" />
        <!-- <link rel="stylesheet" href="via.css" /> -->
        <style>
            body{min-width:200px;padding:0;margin:0;font-family:sans-serif}*{box-sizing:border-box}input[type=text]{border:1px solid #ccc;margin:.6rem 0;padding:.2rem .4rem}a{text-decoration:none}textarea{border:1px solid #ccc;margin:.6rem 0;padding:.2rem .4rem}.top_panel{font-size:.9rem;display:block;background-color:#212121;color:#fff;z-index:1001;margin-bottom:1rem}.menubar{display:inline-block;height:1.8rem}.menubar a:link{color:#eee;text-decoration:none}.menubar a:visited{color:#eee;text-decoration:none}.menubar ul{display:block;padding:0;margin:0}.menubar li{display:inline;float:left;padding:.45rem 1rem}.menubar li:hover{background-color:#616161;cursor:default}.menubar li ul{display:none;background-color:#212121;border:1px solid #616161;min-width:10rem;position:absolute;z-index:100;margin:.4rem -1rem}.menubar li ul li{display:block;float:none;color:#eee;margin:0;padding:.6rem 1rem}.menubar li ul li:hover{cursor:pointer}.menubar li ul li.submenu_divider{margin:0 .4rem;padding:0;height:1px;border-bottom:1px solid #424242}.menubar li:hover ul{display:block}.toolbar{display:inline-block;margin-left:1rem}.toolbar svg{fill:#fff;margin:.2rem .1rem;height:1.2rem;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.toolbar svg:hover{fill:#ff0;cursor:pointer}.toolbar svg:active{fill:#fff}.toolbar ul{display:inline-block;padding:.2rem;margin:0}.toolbar li{display:inline;float:left;padding:0 .3rem;border:1px solid #fff}.toolbar li:hover{color:red;cursor:pointer}.middle_panel{display:table;table-layout:fixed;width:100%;z-index:1;padding:0}#leftsidebar{display:none;z-index:10;vertical-align:top}#display_area{display:table-cell;width:100%;z-index:1;margin:0;padding-left:1em;vertical-align:top}#image_panel{position:relative;outline:0}#image_panel img{visibility:hidden;opacity:0;position:absolute;top:0;left:0;width:100%;height:100%;outline:0}#image_panel canvas{position:absolute;top:0;left:0;outline:0}#image_panel .visible{visibility:visible!important;opacity:1!important}#image_panel label>img{visibility:visible;opacity:1;position:relative;width:auto;height:4em;outline:0}#image_grid_panel{position:relative;margin:0;padding:0;width:100%}#image_grid_panel #image_grid_toolbar{display:block;font-size:small;padding:.5rem 0}#image_grid_panel #image_grid_toolbar select{font-size:small}#image_grid_panel #image_grid_toolbar .tool{display:inline;margin:0 .5rem}#image_grid_panel #image_grid_group_panel{font-size:small}#image_grid_panel #image_grid_group_panel select{font-size:small}#image_grid_panel #image_grid_group_panel .image_grid_group_toolbar{display:inline;margin-left:2rem}#image_grid_panel #image_grid_group_panel .image_grid_group_toolbar select{margin:0 .2rem;padding:0;font-size:small}#image_grid_panel #image_grid_nav{display:inline;font-size:small;padding-left:.5rem;margin-top:.2rem}#image_grid_panel #image_grid_nav span{margin:0 .2rem}#image_grid_panel #image_grid_content{position:relative;overflow:hidden;margin:0;padding:0;outline:0}#image_grid_panel #image_grid_content #image_grid_content_img img{margin:.3em;padding:0;border:.2em solid #fff;outline:.1em solid #06f}#image_grid_panel #image_grid_content #image_grid_content_img .not_sel{opacity:.6;outline:0}#image_grid_panel #image_grid_content #image_grid_content_img{position:absolute;top:0;left:0;width:100%;height:100%}#image_grid_panel #image_grid_content #image_grid_content_rshape{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}#image_grid_panel #image_grid_content img{float:left;margin:0}#leftsidebar_collapse_panel{display:none;position:relative;z-index:10;vertical-align:top}#leftsidebar_show_button{font-size:large;margin-left:.1rem}#leftsidebar_show_button:hover{color:red;cursor:pointer}button.leftsidebar_accordion{font-size:large;background-color:#f2f2f2;cursor:pointer;padding:.5em .5em;width:100%;text-align:left;border:0;outline:0}button.leftsidebar_accordion:focus{outline:0}button.leftsidebar_accordion.active,button.leftsidebar_accordion:hover{background-color:#e6e6e6}button.leftsidebar_accordion:after{content:'\02795';color:#4d4d4d;float:right}button.leftsidebar_accordion.active:after{content:'\2796'}.leftsidebar_accordion_panel{display:none;padding:0 .5em;font-size:small;border-right:2px solid #f2f2f2;border-bottom:2px solid #f2f2f2}.leftsidebar_accordion_panel.show{display:block}.leftsidebar_accordion_panel table{border-collapse:collapse}.leftsidebar_accordion_panel td{border:1px solid #f2f2f2;padding:.2rem .4rem}.button_panel{display:inline-block;width:100%;margin:.2rem 0}.button_panel .text_button,.text_button{color:#00f;padding:.2rem .2rem;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.button_panel .flush_right{float:right}.button_panel .text_button:hover,.text_button:hover{cursor:pointer}.button_panel .text_button:active,.text_button:active{color:#000}.button_panel .active{border-bottom:1px solid #000}.button_panel .button{display:inline-block;padding:.35rem .5rem;margin:0 .05rem;cursor:pointer;background-color:#ccc;border-radius:.2rem;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.button_panel .button:hover{background-color:#000;color:#fff}#attribute_properties{display:table;width:100%;border-collapse:collapse;margin:1rem 0;border:1px solid #ccc}#attribute_properties .property{display:table-row}#attribute_properties .property span{display:table-cell;padding:.2rem .4rem}#attribute_properties .property span input{width:100%;border:1px solid #ccc;margin:0}#attribute_properties .property span input:focus{border:1px solid #000}#attribute_properties .property span select{width:100%;border:1px solid #ccc;margin:0}#attribute_options{display:table;width:100%;border-collapse:collapse;margin:1rem 0;border:1px solid #ccc;table-layout:fixed}#attribute_options .new_option_id_entry{display:inline-block;padding:1rem .2rem}#attribute_options .new_option_id_entry input{border:none;border-bottom:1px solid #ccc;margin:0;font-size:.8rem}#attribute_options .property{display:table-row}#attribute_options .property span{display:table-cell;padding:.2rem .2rem;font-weight:700}#attribute_options .property input{display:table-cell;width:94%;border:none;border-bottom:1px solid #ccc;margin:0;font-size:.8rem}#attribute_options .property input:focus{border-bottom:1px solid #000;background-color:#f2f2f2;color:#000}#attribute_options .property span input[type=checkbox]{vertical-align:middle}#attribute_options .property span input[type=radio]{vertical-align:middle}#user_input_panel{position:fixed;display:none;width:100%;height:100%;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.6);z-index:1002}#user_input_panel .content{position:fixed;background-color:#fff;top:50%;left:50%;transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);padding:2rem 4rem}#user_input_panel .content .title{font-size:large;font-weight:700}#user_input_panel .content .user_inputs{display:table;width:100%;border-collapse:collapse}#user_input_panel .content .user_inputs .row{display:table-row}#user_input_panel .content .user_inputs .cell{display:table-cell;padding:1rem .5rem;vertical-align:middle;border:1px solid #f2f2f2}#user_input_panel .content .user_confirm{display:table;width:100%;text-align:center;margin:2rem 0}#user_input_panel .content .user_confirm .ok{display:table-cell;width:48%}#user_input_panel .content .user_confirm .cancel{display:table-cell;width:48%}#user_input_panel .content .warning{color:red}#annotation_editor_panel{position:fixed;display:none;width:100%;left:0;bottom:0;background-color:#fff;border-top:2px solid #ccc;padding:.2em 1em;overflow:auto;z-index:1001;box-shadow:0 0 1em #ccc}#annotation_editor{display:table;margin-bottom:3em;border-collapse:collapse;font-size:inherit;position:absolute;background-color:#fff}#annotation_editor .row{display:table-row}#annotation_editor .highlight .col{background-color:#e6e6e6}#annotation_editor .col{display:table-cell;padding:.4em .6em;border:1px solid #000;vertical-align:middle;font-size:inherit}#annotation_editor .header{font-weight:700}#annotation_editor .id{font-weight:700}#annotation_editor .col input[type=checkbox]{vertical-align:middle}#annotation_editor .col input[type=radio]{vertical-align:middle;font-size:inherit}#annotation_editor .col label{vertical-align:middle;font-size:inherit}#annotation_editor .col textarea{border:.1em solid #ccc;padding:0;margin:0;font-size:inherit;background-color:#fff}#annotation_editor .col textarea:focus{border:.1em dashed #ccc}#annotation_editor .col span{display:block}#annotation_editor .col horizontal_container{display:inline-block}#annotation_editor .col .img_options{display:inline}#annotation_editor .col .img_options .imrow{display:block}#annotation_editor .col .img_options span{display:inline-block;margin:.2rem .4rem}#annotation_editor .col .img_options span img{height:4em}#annotation_editor .col .img_options p{margin:0;padding:0;font-size:inherit}#annotation_editor .col .img_options input[type=radio]{display:none}#annotation_editor .col .img_options input[type=radio]+label{display:block;cursor:pointer;text-align:center}#annotation_editor .col .img_options input[type=radio]:checked+label{border:.1em solid #000;background-color:#ccc;cursor:default;font-size:inherit}#project_info_panel{display:table;border-collapse:collapse;font-size:.8rem}#project_info_panel .row{display:table-row}#project_info_panel .col{display:table-cell;padding:.4rem .1rem;border:none}#project_info_panel .col input[type=text]{font-size:.8rem;border:none;border-bottom:1px solid #ccc;margin:0;width:100%}#project_info_panel .col input:focus{border-bottom:1px solid #000;background-color:#f2f2f2;color:#000}ul.region_shape{font-size:xx-large;list-style-type:none;overflow:hidden;padding:.4em 0;margin:0}ul.region_shape li{float:left;padding:0 .2em;fill:#fff;stroke:#000}ul.region_shape li:hover{cursor:pointer;fill:#fff;stroke:red}ul.region_shape .selected{fill:#fff;stroke:red}#region_info{font-size:.8em;margin-bottom:.4em}#img_fn_list{display:none;font-size:small;overflow:scroll;min-height:10rem;max-height:25rem}#img_fn_list ul{position:relative;line-height:1.3em;margin:0;padding:0;list-style-type:none}#img_fn_list li{white-space:nowrap;display:block;padding:0 .4rem}#img_fn_list li:hover{background-color:#d5e5ff;cursor:pointer}#img_fn_list .error{color:red}#img_fn_list .sel{border-left:.2rem solid #000!important;font-weight:700}#img_fn_list .buffered{border-left:.2rem solid #ccc}#message_panel{display:block;width:100%;position:fixed;bottom:0;z-index:9999;text-align:center}#message_panel .content{display:inline;margin:auto;background-color:#000;color:#ff0;font-size:small;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:2rem;padding:.5rem 2rem}.text_panel{display:none;margin:auto;font-size:medium;line-height:1.3em;margin:0;max-width:700px}.text_panel li{margin:1em 0;text-align:left}.text_panel p{text-align:left}.svg_button:hover{cursor:pointer}.loading_spinbox{display:inline-block;border:.4em solid #ccc;border-radius:50%;border-top:.4em solid #000;border-bottom:.4em solid #000;-webkit-animation:spin 2s linear infinite;animation:spin 2s linear infinite}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0)}100%{-webkit-transform:rotate(360deg)}}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}#invisible_file_input{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}.display_none{display:none!important}.display_block{display:block!important}#settings_panel{font-size:1rem;border-collapse:collapse;width:95%}#settings_panel a{border:1px solid #f2f2f2}#settings_panel .row{display:table-row;border-bottom:1px solid #f2f2f2}#settings_panel .variable{display:table-cell;width:60%;padding:.5rem .5rem}#settings_panel .variable div{display:block}#settings_panel .variable .desc{font-size:.7em;color:grey;padding:.2rem 0}#settings_panel .value{display:table-cell;vertical-align:middle;padding-left:1rem}.narrow_page_content li{font-size:.9rem;margin:.4rem 0}.narrow_page_content{width:60%}.force_small_font{font-size:small!important}.key{font-family:monospace;padding:1px 6px;background:linear-gradient(to bottom,#f0f0f0,#fcfcfc);border:1px solid #e0e0e0;white-space:nowrap;color:#303030;border-bottom-width:2px;border-radius:3px;font-size:1.2em}body.swal2-shown:not(.swal2-no-backdrop){overflow-y:hidden}body.swal2-toast-shown{overflow-y:auto}body.swal2-toast-shown.swal2-has-input>.swal2-container>.swal2-toast{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}body.swal2-toast-shown.swal2-has-input>.swal2-container>.swal2-toast .swal2-icon{margin:0 0 15px}body.swal2-toast-shown.swal2-has-input>.swal2-container>.swal2-toast .swal2-buttonswrapper{-webkit-box-flex:1;-ms-flex:1;flex:1;-ms-flex-item-align:stretch;align-self:stretch;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}body.swal2-toast-shown.swal2-has-input>.swal2-container>.swal2-toast .swal2-loading{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}body.swal2-toast-shown.swal2-has-input>.swal2-container>.swal2-toast .swal2-input{height:32px;font-size:14px;margin:5px auto}body.swal2-toast-shown>.swal2-container{position:fixed;background-color:transparent}body.swal2-toast-shown>.swal2-container.swal2-shown{background-color:transparent}body.swal2-toast-shown>.swal2-container.swal2-top{top:0;left:50%;bottom:auto;right:auto;-webkit-transform:translateX(-50%);transform:translateX(-50%)}body.swal2-toast-shown>.swal2-container.swal2-top-right{top:0;left:auto;bottom:auto;right:0}body.swal2-toast-shown>.swal2-container.swal2-top-left{top:0;left:0;bottom:auto;right:auto}body.swal2-toast-shown>.swal2-container.swal2-center-left{top:50%;left:0;bottom:auto;right:auto;-webkit-transform:translateY(-50%);transform:translateY(-50%)}body.swal2-toast-shown>.swal2-container.swal2-center{top:50%;left:50%;bottom:auto;right:auto;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}body.swal2-toast-shown>.swal2-container.swal2-center-right{top:50%;left:auto;bottom:auto;right:0;-webkit-transform:translateY(-50%);transform:translateY(-50%)}body.swal2-toast-shown>.swal2-container.swal2-bottom-left{top:auto;left:0;bottom:0;right:auto}body.swal2-toast-shown>.swal2-container.swal2-bottom{top:auto;left:50%;bottom:0;right:auto;-webkit-transform:translateX(-50%);transform:translateX(-50%)}body.swal2-toast-shown>.swal2-container.swal2-bottom-right{top:auto;left:auto;bottom:0;right:0}body.swal2-iosfix{position:fixed;left:0;right:0}body.swal2-no-backdrop>.swal2-shown{top:auto;bottom:auto;left:auto;right:auto;background-color:transparent}body.swal2-no-backdrop>.swal2-shown>.swal2-modal{-webkit-box-shadow:0 0 10px rgba(0,0,0,.4);box-shadow:0 0 10px rgba(0,0,0,.4)}body.swal2-no-backdrop>.swal2-shown.swal2-top{top:0;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%)}body.swal2-no-backdrop>.swal2-shown.swal2-top-left{top:0;left:0}body.swal2-no-backdrop>.swal2-shown.swal2-top-right{top:0;right:0}body.swal2-no-backdrop>.swal2-shown.swal2-center{top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}body.swal2-no-backdrop>.swal2-shown.swal2-center-left{top:50%;left:0;-webkit-transform:translateY(-50%);transform:translateY(-50%)}body.swal2-no-backdrop>.swal2-shown.swal2-center-right{top:50%;right:0;-webkit-transform:translateY(-50%);transform:translateY(-50%)}body.swal2-no-backdrop>.swal2-shown.swal2-bottom{bottom:0;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%)}body.swal2-no-backdrop>.swal2-shown.swal2-bottom-left{bottom:0;left:0}body.swal2-no-backdrop>.swal2-shown.swal2-bottom-right{bottom:0;right:0}.swal2-container{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;position:fixed;padding:10px;top:0;left:0;right:0;bottom:0;background-color:transparent;z-index:1060}.swal2-container.swal2-top{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.swal2-container.swal2-top-left{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.swal2-container.swal2-top-right{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}.swal2-container.swal2-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.swal2-container.swal2-center-left{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.swal2-container.swal2-center-right{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}.swal2-container.swal2-bottom{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.swal2-container.swal2-bottom-left{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.swal2-container.swal2-bottom-right{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}.swal2-container.swal2-grow-fullscreen>.swal2-modal{display:-webkit-box!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-flex:1;-ms-flex:1;flex:1;-ms-flex-item-align:stretch;align-self:stretch;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.swal2-container.swal2-grow-row>.swal2-modal{display:-webkit-box!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-flex:1;-ms-flex:1;flex:1;-ms-flex-line-pack:center;align-content:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.swal2-container.swal2-grow-column{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.swal2-container.swal2-grow-column.swal2-bottom,.swal2-container.swal2-grow-column.swal2-center,.swal2-container.swal2-grow-column.swal2-top{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.swal2-container.swal2-grow-column.swal2-bottom-left,.swal2-container.swal2-grow-column.swal2-center-left,.swal2-container.swal2-grow-column.swal2-top-left{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.swal2-container.swal2-grow-column.swal2-bottom-right,.swal2-container.swal2-grow-column.swal2-center-right,.swal2-container.swal2-grow-column.swal2-top-right{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.swal2-container.swal2-grow-column>.swal2-modal{display:-webkit-box!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-flex:1;-ms-flex:1;flex:1;-ms-flex-line-pack:center;align-content:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.swal2-container:not(.swal2-top):not(.swal2-top-left):not(.swal2-top-right):not(.swal2-center-left):not(.swal2-center-right):not(.swal2-bottom):not(.swal2-bottom-left):not(.swal2-bottom-right)>.swal2-modal{margin:auto}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){.swal2-container .swal2-modal{margin:0!important}}.swal2-container.swal2-fade{-webkit-transition:background-color .1s;transition:background-color .1s}.swal2-container.swal2-shown{background-color:rgba(0,0,0,.4)}.swal2-popup{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;background-color:#fff;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;border-radius:5px;-webkit-box-sizing:border-box;box-sizing:border-box;text-align:center;overflow-x:hidden;overflow-y:auto;display:none;position:relative;max-width:100%}.swal2-popup.swal2-toast{width:300px;padding:0 15px;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;overflow-y:hidden;-webkit-box-shadow:0 0 10px #d9d9d9;box-shadow:0 0 10px #d9d9d9}.swal2-popup.swal2-toast .swal2-title{max-width:300px;font-size:16px;text-align:left}.swal2-popup.swal2-toast .swal2-content{font-size:14px;text-align:left}.swal2-popup.swal2-toast .swal2-icon{width:32px;height:32px;margin:0 15px 0 0}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:32px;height:32px}.swal2-popup.swal2-toast .swal2-icon.swal2-info,.swal2-popup.swal2-toast .swal2-icon.swal2-question,.swal2-popup.swal2-toast .swal2-icon.swal2-warning{font-size:26px;line-height:32px}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:14px;width:22px}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:5px}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:5px}.swal2-popup.swal2-toast .swal2-buttonswrapper{margin:0 0 0 5px}.swal2-popup.swal2-toast .swal2-styled{margin:0 0 0 5px;padding:5px 10px}.swal2-popup.swal2-toast .swal2-styled:focus{-webkit-box-shadow:0 0 0 1px #fff,0 0 0 2px rgba(50,100,150,.4);box-shadow:0 0 0 1px #fff,0 0 0 2px rgba(50,100,150,.4)}.swal2-popup.swal2-toast .swal2-validationerror{width:100%;margin:5px -20px}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{border-radius:50%;position:absolute;width:32px;height:64px;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{border-radius:64px 0 0 64px;top:-4px;left:-15px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-transform-origin:32px 32px;transform-origin:32px 32px}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{border-radius:0 64px 64px 0;top:-5px;left:14px;-webkit-transform-origin:0 32px;transform-origin:0 32px}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:32px;height:32px}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{width:7px;height:90px;left:28px;top:8px}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:5px}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{width:12px;left:3px;top:18px}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{width:22px;right:3px;top:15px}.swal2-popup.swal2-toast .swal2-animate-success-line-tip{-webkit-animation:animate-toast-success-tip .75s;animation:animate-toast-success-tip .75s}.swal2-popup.swal2-toast .swal2-animate-success-line-long{-webkit-animation:animate-toast-success-long .75s;animation:animate-toast-success-long .75s}.swal2-popup:focus{outline:0}.swal2-popup.swal2-loading{overflow-y:hidden}.swal2-popup .swal2-title{color:#595959;font-size:30px;text-align:center;font-weight:600;text-transform:none;position:relative;margin:0 0 .4em;padding:0;display:block;word-wrap:break-word}.swal2-popup .swal2-buttonswrapper{-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-top:15px}.swal2-popup .swal2-buttonswrapper:not(.swal2-loading) .swal2-styled[disabled]{opacity:.4;cursor:no-drop}.swal2-popup .swal2-buttonswrapper.swal2-loading .swal2-styled.swal2-confirm{-webkit-box-sizing:border-box;box-sizing:border-box;border:4px solid transparent;border-color:transparent;width:40px;height:40px;padding:0;margin:7.5px;vertical-align:top;background-color:transparent!important;color:transparent;cursor:default;border-radius:100%;-webkit-animation:rotate-loading 1.5s linear 0s infinite normal;animation:rotate-loading 1.5s linear 0s infinite normal;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.swal2-popup .swal2-buttonswrapper.swal2-loading .swal2-styled.swal2-cancel{margin-left:30px;margin-right:30px}.swal2-popup .swal2-buttonswrapper.swal2-loading :not(.swal2-styled).swal2-confirm::after{display:inline-block;content:'';margin-left:5px;vertical-align:-1px;height:15px;width:15px;border:3px solid #999;-webkit-box-shadow:1px 1px 1px #fff;box-shadow:1px 1px 1px #fff;border-right-color:transparent;border-radius:50%;-webkit-animation:rotate-loading 1.5s linear 0s infinite normal;animation:rotate-loading 1.5s linear 0s infinite normal}.swal2-popup .swal2-styled{border:0;border-radius:3px;-webkit-box-shadow:none;box-shadow:none;color:#fff;cursor:pointer;font-size:17px;font-weight:500;margin:15px 5px 0;padding:10px 32px}.swal2-popup .swal2-styled:focus{outline:0;-webkit-box-shadow:0 0 0 2px #fff,0 0 0 4px rgba(50,100,150,.4);box-shadow:0 0 0 2px #fff,0 0 0 4px rgba(50,100,150,.4)}.swal2-popup .swal2-image{margin:20px auto;max-width:100%}.swal2-popup .swal2-close{background:0 0;border:0;margin:0;padding:0;width:38px;height:40px;font-size:36px;line-height:40px;font-family:serif;position:absolute;top:5px;right:8px;cursor:pointer;color:#ccc;-webkit-transition:color .1s ease;transition:color .1s ease}.swal2-popup .swal2-close:hover{color:#d55}.swal2-popup>.swal2-checkbox,.swal2-popup>.swal2-file,.swal2-popup>.swal2-input,.swal2-popup>.swal2-radio,.swal2-popup>.swal2-select,.swal2-popup>.swal2-textarea{display:none}.swal2-popup .swal2-content{font-size:18px;text-align:center;font-weight:300;position:relative;float:none;margin:0;padding:0;line-height:normal;color:#545454;word-wrap:break-word}.swal2-popup .swal2-checkbox,.swal2-popup .swal2-file,.swal2-popup .swal2-input,.swal2-popup .swal2-radio,.swal2-popup .swal2-select,.swal2-popup .swal2-textarea{margin:20px auto}.swal2-popup .swal2-file,.swal2-popup .swal2-input,.swal2-popup .swal2-textarea{width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;font-size:18px;border-radius:3px;border:1px solid #d9d9d9;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.06);box-shadow:inset 0 1px 1px rgba(0,0,0,.06);-webkit-transition:border-color .3s,-webkit-box-shadow .3s;transition:border-color .3s,-webkit-box-shadow .3s;transition:border-color .3s,box-shadow .3s;transition:border-color .3s,box-shadow .3s,-webkit-box-shadow .3s}.swal2-popup .swal2-file.swal2-inputerror,.swal2-popup .swal2-input.swal2-inputerror,.swal2-popup .swal2-textarea.swal2-inputerror{border-color:#f27474!important;-webkit-box-shadow:0 0 2px #f27474!important;box-shadow:0 0 2px #f27474!important}.swal2-popup .swal2-file:focus,.swal2-popup .swal2-input:focus,.swal2-popup .swal2-textarea:focus{outline:0;border:1px solid #b4dbed;-webkit-box-shadow:0 0 3px #c4e6f5;box-shadow:0 0 3px #c4e6f5}.swal2-popup .swal2-file::-webkit-input-placeholder,.swal2-popup .swal2-input::-webkit-input-placeholder,.swal2-popup .swal2-textarea::-webkit-input-placeholder{color:#ccc}.swal2-popup .swal2-file:-ms-input-placeholder,.swal2-popup .swal2-input:-ms-input-placeholder,.swal2-popup .swal2-textarea:-ms-input-placeholder{color:#ccc}.swal2-popup .swal2-file::-ms-input-placeholder,.swal2-popup .swal2-input::-ms-input-placeholder,.swal2-popup .swal2-textarea::-ms-input-placeholder{color:#ccc}.swal2-popup .swal2-file::placeholder,.swal2-popup .swal2-input::placeholder,.swal2-popup .swal2-textarea::placeholder{color:#ccc}.swal2-popup .swal2-range input{float:left;width:80%}.swal2-popup .swal2-range output{float:right;width:20%;font-size:20px;font-weight:600;text-align:center}.swal2-popup .swal2-range input,.swal2-popup .swal2-range output{height:43px;line-height:43px;vertical-align:middle;margin:20px auto;padding:0}.swal2-popup .swal2-input{height:43px;padding:0 12px}.swal2-popup .swal2-input[type=number]{max-width:150px}.swal2-popup .swal2-file{font-size:20px}.swal2-popup .swal2-textarea{height:108px;padding:12px}.swal2-popup .swal2-select{color:#545454;font-size:inherit;padding:5px 10px;min-width:40%;max-width:100%}.swal2-popup .swal2-radio{border:0}.swal2-popup .swal2-radio label:not(:first-child){margin-left:20px}.swal2-popup .swal2-radio input,.swal2-popup .swal2-radio span{vertical-align:middle}.swal2-popup .swal2-radio input{margin:0 3px 0 0}.swal2-popup .swal2-checkbox{color:#545454}.swal2-popup .swal2-checkbox input,.swal2-popup .swal2-checkbox span{vertical-align:middle}.swal2-popup .swal2-validationerror{background-color:#f0f0f0;margin:0 -20px;overflow:hidden;padding:10px;color:gray;font-size:16px;font-weight:300;display:none}.swal2-popup .swal2-validationerror::before{content:'!';display:inline-block;width:24px;height:24px;border-radius:50%;background-color:#ea7d7d;color:#fff;line-height:24px;text-align:center;margin-right:10px}@supports (-ms-accelerator:true){.swal2-range input{width:100%!important}.swal2-range output{display:none}}@media all and (-ms-high-contrast:none),(-ms-high-contrast:active){.swal2-range input{width:100%!important}.swal2-range output{display:none}}.swal2-icon{width:80px;height:80px;border:4px solid transparent;border-radius:50%;margin:20px auto 30px;padding:0;position:relative;-webkit-box-sizing:content-box;box-sizing:content-box;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.swal2-icon.swal2-error{border-color:#f27474}.swal2-icon.swal2-error .swal2-x-mark{position:relative;display:block}.swal2-icon.swal2-error [class^=swal2-x-mark-line]{position:absolute;height:5px;width:47px;background-color:#f27474;display:block;top:37px;border-radius:2px}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{-webkit-transform:rotate(45deg);transform:rotate(45deg);left:17px}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{-webkit-transform:rotate(-45deg);transform:rotate(-45deg);right:16px}.swal2-icon.swal2-warning{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#f8bb86;border-color:#facea8;font-size:60px;line-height:80px;text-align:center}.swal2-icon.swal2-info{font-family:'Open Sans',sans-serif;color:#3fc3ee;border-color:#9de0f6;font-size:60px;line-height:80px;text-align:center}.swal2-icon.swal2-question{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#87adbd;border-color:#c9dae1;font-size:60px;line-height:80px;text-align:center}.swal2-icon.swal2-success{border-color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-circular-line]{border-radius:50%;position:absolute;width:60px;height:120px;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=left]{border-radius:120px 0 0 120px;top:-7px;left:-33px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-transform-origin:60px 60px;transform-origin:60px 60px}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=right]{border-radius:0 120px 120px 0;top:-11px;left:30px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-transform-origin:0 60px;transform-origin:0 60px}.swal2-icon.swal2-success .swal2-success-ring{width:80px;height:80px;border:4px solid rgba(165,220,134,.2);border-radius:50%;-webkit-box-sizing:content-box;box-sizing:content-box;position:absolute;left:-4px;top:-4px;z-index:2}.swal2-icon.swal2-success .swal2-success-fix{width:7px;height:90px;position:absolute;left:28px;top:8px;z-index:1;-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.swal2-icon.swal2-success [class^=swal2-success-line]{height:5px;background-color:#a5dc86;display:block;border-radius:2px;position:absolute;z-index:2}.swal2-icon.swal2-success [class^=swal2-success-line][class$=tip]{width:25px;left:14px;top:46px;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-line][class$=long]{width:47px;right:8px;top:38px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.swal2-progresssteps{font-weight:600;margin:0 0 20px;padding:0}.swal2-progresssteps li{display:inline-block;position:relative}.swal2-progresssteps .swal2-progresscircle{background:#3085d6;border-radius:2em;color:#fff;height:2em;line-height:2em;text-align:center;width:2em;z-index:20}.swal2-progresssteps .swal2-progresscircle:first-child{margin-left:0}.swal2-progresssteps .swal2-progresscircle:last-child{margin-right:0}.swal2-progresssteps .swal2-progresscircle.swal2-activeprogressstep{background:#3085d6}.swal2-progresssteps .swal2-progresscircle.swal2-activeprogressstep~.swal2-progresscircle{background:#add8e6}.swal2-progresssteps .swal2-progresscircle.swal2-activeprogressstep~.swal2-progressline{background:#add8e6}.swal2-progresssteps .swal2-progressline{background:#3085d6;height:.4em;margin:0 -1px;z-index:10}[class^=swal2]{-webkit-tap-highlight-color:transparent}@-webkit-keyframes showSweetToast{0%{-webkit-transform:translateY(-10px) rotateZ(2deg);transform:translateY(-10px) rotateZ(2deg);opacity:0}33%{-webkit-transform:translateY(0) rotateZ(-2deg);transform:translateY(0) rotateZ(-2deg);opacity:.5}66%{-webkit-transform:translateY(5px) rotateZ(2deg);transform:translateY(5px) rotateZ(2deg);opacity:.7}100%{-webkit-transform:translateY(0) rotateZ(0);transform:translateY(0) rotateZ(0);opacity:1}}@keyframes showSweetToast{0%{-webkit-transform:translateY(-10px) rotateZ(2deg);transform:translateY(-10px) rotateZ(2deg);opacity:0}33%{-webkit-transform:translateY(0) rotateZ(-2deg);transform:translateY(0) rotateZ(-2deg);opacity:.5}66%{-webkit-transform:translateY(5px) rotateZ(2deg);transform:translateY(5px) rotateZ(2deg);opacity:.7}100%{-webkit-transform:translateY(0) rotateZ(0);transform:translateY(0) rotateZ(0);opacity:1}}@-webkit-keyframes hideSweetToast{0%{opacity:1}33%{opacity:.5}100%{-webkit-transform:rotateZ(1deg);transform:rotateZ(1deg);opacity:0}}@keyframes hideSweetToast{0%{opacity:1}33%{opacity:.5}100%{-webkit-transform:rotateZ(1deg);transform:rotateZ(1deg);opacity:0}}@-webkit-keyframes showSweetAlert{0%{-webkit-transform:scale(.7);transform:scale(.7)}45%{-webkit-transform:scale(1.05);transform:scale(1.05)}80%{-webkit-transform:scale(.95);transform:scale(.95)}100%{-webkit-transform:scale(1);transform:scale(1)}}@keyframes showSweetAlert{0%{-webkit-transform:scale(.7);transform:scale(.7)}45%{-webkit-transform:scale(1.05);transform:scale(1.05)}80%{-webkit-transform:scale(.95);transform:scale(.95)}100%{-webkit-transform:scale(1);transform:scale(1)}}@-webkit-keyframes hideSweetAlert{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}100%{-webkit-transform:scale(.5);transform:scale(.5);opacity:0}}@keyframes hideSweetAlert{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}100%{-webkit-transform:scale(.5);transform:scale(.5);opacity:0}}.swal2-show{-webkit-animation:showSweetAlert .3s;animation:showSweetAlert .3s}.swal2-show.swal2-toast{-webkit-animation:showSweetToast .5s;animation:showSweetToast .5s}.swal2-show.swal2-noanimation{-webkit-animation:none;animation:none}.swal2-hide{-webkit-animation:hideSweetAlert .15s forwards;animation:hideSweetAlert .15s forwards}.swal2-hide.swal2-toast{-webkit-animation:hideSweetToast .2s forwards;animation:hideSweetToast .2s forwards}.swal2-hide.swal2-noanimation{-webkit-animation:none;animation:none}@-webkit-keyframes animate-success-tip{0%{width:0;left:1px;top:19px}54%{width:0;left:1px;top:19px}70%{width:50px;left:-8px;top:37px}84%{width:17px;left:21px;top:48px}100%{width:25px;left:14px;top:45px}}@keyframes animate-success-tip{0%{width:0;left:1px;top:19px}54%{width:0;left:1px;top:19px}70%{width:50px;left:-8px;top:37px}84%{width:17px;left:21px;top:48px}100%{width:25px;left:14px;top:45px}}@-webkit-keyframes animate-success-long{0%{width:0;right:46px;top:54px}65%{width:0;right:46px;top:54px}84%{width:55px;right:0;top:35px}100%{width:47px;right:8px;top:38px}}@keyframes animate-success-long{0%{width:0;right:46px;top:54px}65%{width:0;right:46px;top:54px}84%{width:55px;right:0;top:35px}100%{width:47px;right:8px;top:38px}}@-webkit-keyframes animate-toast-success-tip{0%{width:0;left:1px;top:9px}54%{width:0;left:1px;top:9px}70%{width:24px;left:-4px;top:17px}84%{width:8px;left:10px;top:20px}100%{width:12px;left:3px;top:18px}}@keyframes animate-toast-success-tip{0%{width:0;left:1px;top:9px}54%{width:0;left:1px;top:9px}70%{width:24px;left:-4px;top:17px}84%{width:8px;left:10px;top:20px}100%{width:12px;left:3px;top:18px}}@-webkit-keyframes animate-toast-success-long{0%{width:0;right:22px;top:26px}65%{width:0;right:22px;top:26px}84%{width:26px;right:0;top:15px}100%{width:22px;right:3px;top:15px}}@keyframes animate-toast-success-long{0%{width:0;right:22px;top:26px}65%{width:0;right:22px;top:26px}84%{width:26px;right:0;top:15px}100%{width:22px;right:3px;top:15px}}@-webkit-keyframes rotatePlaceholder{0%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}5%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}12%{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}100%{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}}@keyframes rotatePlaceholder{0%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}5%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}12%{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}100%{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}}.swal2-animate-success-line-tip{-webkit-animation:animate-success-tip .75s;animation:animate-success-tip .75s}.swal2-animate-success-line-long{-webkit-animation:animate-success-long .75s;animation:animate-success-long .75s}.swal2-success.swal2-animate-success-icon .swal2-success-circular-line-right{-webkit-animation:rotatePlaceholder 4.25s ease-in;animation:rotatePlaceholder 4.25s ease-in}@-webkit-keyframes animate-error-icon{0%{-webkit-transform:rotateX(100deg);transform:rotateX(100deg);opacity:0}100%{-webkit-transform:rotateX(0);transform:rotateX(0);opacity:1}}@keyframes animate-error-icon{0%{-webkit-transform:rotateX(100deg);transform:rotateX(100deg);opacity:0}100%{-webkit-transform:rotateX(0);transform:rotateX(0);opacity:1}}.swal2-animate-error-icon{-webkit-animation:animate-error-icon .5s;animation:animate-error-icon .5s}@-webkit-keyframes animate-x-mark{0%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}50%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}80%{-webkit-transform:scale(1.15);transform:scale(1.15);margin-top:-6px}100%{-webkit-transform:scale(1);transform:scale(1);margin-top:0;opacity:1}}@keyframes animate-x-mark{0%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}50%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}80%{-webkit-transform:scale(1.15);transform:scale(1.15);margin-top:-6px}100%{-webkit-transform:scale(1);transform:scale(1);margin-top:0;opacity:1}}.swal2-animate-x-mark{-webkit-animation:animate-x-mark .5s;animation:animate-x-mark .5s}@-webkit-keyframes rotate-loading{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate-loading{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@font-face{font-weight:400;font-style:normal;font-family:Inter-Loom;src:url(https://cdn.loom.com/assets/fonts/inter/Inter-UI-Regular.woff2) format('woff2')}@font-face{font-weight:400;font-style:italic;font-family:Inter-Loom;src:url(https://cdn.loom.com/assets/fonts/inter/Inter-UI-Italic.woff2) format('woff2')}@font-face{font-weight:500;font-style:normal;font-family:Inter-Loom;src:url(https://cdn.loom.com/assets/fonts/inter/Inter-UI-Medium.woff2) format('woff2')}@font-face{font-weight:500;font-style:italic;font-family:Inter-Loom;src:url(https://cdn.loom.com/assets/fonts/inter/Inter-UI-MediumItalic.woff2) format('woff2')}@font-face{font-weight:700;font-style:normal;font-family:Inter-Loom;src:url(https://cdn.loom.com/assets/fonts/inter/Inter-UI-Bold.woff2) format('woff2')}@font-face{font-weight:700;font-style:italic;font-family:Inter-Loom;src:url(https://cdn.loom.com/assets/fonts/inter/Inter-UI-BoldItalic.woff2) format('woff2')}@font-face{font-weight:900;font-style:normal;font-family:Inter-Loom;src:url(https://cdn.loom.com/assets/fonts/inter/Inter-UI-Black.woff2) format('woff2')}@font-face{font-weight:900;font-style:italic;font-family:Inter-Loom;src:url(https://cdn.loom.com/assets/fonts/inter/Inter-UI-BlackItalic.woff2) format('woff2')}body{min-width:200px;padding:0;margin:0;font-family:sans-serif}*{box-sizing:border-box}input[type=text]{border:1px solid #ccc;margin:.6rem 0;padding:.2rem .4rem}a{text-decoration:none}textarea{border:1px solid #ccc;margin:.6rem 0;padding:.2rem .4rem}.top_panel{font-size:.9rem;display:block;background-color:#212121;color:#fff;z-index:1001;margin-bottom:1rem}.menubar{display:inline-block;height:1.8rem}.menubar a:link{color:#eee;text-decoration:none}.menubar a:visited{color:#eee;text-decoration:none}.menubar ul{display:block;padding:0;margin:0}.menubar li{display:inline;float:left;padding:.45rem 1rem}.menubar li:hover{background-color:#616161;cursor:default}.menubar li ul{display:none;background-color:#212121;border:1px solid #616161;min-width:10rem;position:absolute;z-index:100;margin:.4rem -1rem}.menubar li ul li{display:block;float:none;color:#eee;margin:0;padding:.6rem 1rem}.menubar li ul li:hover{cursor:pointer}.menubar li ul li.submenu_divider{margin:0 .4rem;padding:0;height:1px;border-bottom:1px solid #424242}.menubar li:hover ul{display:block}.toolbar{display:inline-block;margin-left:1rem}.toolbar svg{fill:#fff;margin:.2rem .1rem;height:1.2rem;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.toolbar svg:hover{fill:#ff0;cursor:pointer}.toolbar svg:active{fill:#fff}.toolbar ul{display:inline-block;padding:.2rem;margin:0}.toolbar li{display:inline;float:left;padding:0 .3rem;border:1px solid #fff}.toolbar li:hover{color:red;cursor:pointer}.middle_panel{display:table;table-layout:fixed;width:100%;z-index:1;padding:0}#leftsidebar{display:none;z-index:10;vertical-align:top}#display_area{display:table-cell;width:100%;z-index:1;margin:0;padding-left:1em;vertical-align:top}#image_panel{position:relative;outline:0}#image_panel img{visibility:hidden;opacity:0;position:absolute;top:0;left:0;width:100%;height:100%;outline:0}#image_panel canvas{position:absolute;top:0;left:0;outline:0}#image_panel .visible{visibility:visible!important;opacity:1!important}#image_panel label>img{visibility:visible;opacity:1;position:relative;width:auto;height:4em;outline:0}#image_grid_panel{position:relative;margin:0;padding:0;width:100%}#image_grid_panel #image_grid_toolbar{display:block;font-size:small;padding:.5rem 0}#image_grid_panel #image_grid_toolbar select{font-size:small}#image_grid_panel #image_grid_toolbar .tool{display:inline;margin:0 .5rem}#image_grid_panel #image_grid_group_panel{font-size:small}#image_grid_panel #image_grid_group_panel select{font-size:small}#image_grid_panel #image_grid_group_panel .image_grid_group_toolbar{display:inline;margin-left:2rem}#image_grid_panel #image_grid_group_panel .image_grid_group_toolbar select{margin:0 .2rem;padding:0;font-size:small}#image_grid_panel #image_grid_nav{display:inline;font-size:small;padding-left:.5rem;margin-top:.2rem}#image_grid_panel #image_grid_nav span{margin:0 .2rem}#image_grid_panel #image_grid_content{position:relative;overflow:hidden;margin:0;padding:0;outline:0}#image_grid_panel #image_grid_content #image_grid_content_img img{margin:.3em;padding:0;border:.2em solid #fff;outline:.1em solid #06f}#image_grid_panel #image_grid_content #image_grid_content_img .not_sel{opacity:.6;outline:0}#image_grid_panel #image_grid_content #image_grid_content_img{position:absolute;top:0;left:0;width:100%;height:100%}#image_grid_panel #image_grid_content #image_grid_content_rshape{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}#image_grid_panel #image_grid_content img{float:left;margin:0}#leftsidebar_collapse_panel{display:none;position:relative;z-index:10;vertical-align:top}#leftsidebar_show_button{font-size:large;margin-left:.1rem}#leftsidebar_show_button:hover{color:red;cursor:pointer}button.leftsidebar_accordion{font-size:large;background-color:#f2f2f2;cursor:pointer;padding:.5em .5em;width:100%;text-align:left;border:0;outline:0}button.leftsidebar_accordion:focus{outline:0}button.leftsidebar_accordion.active,button.leftsidebar_accordion:hover{background-color:#e6e6e6}button.leftsidebar_accordion:after{content:'\02795';color:#4d4d4d;float:right}button.leftsidebar_accordion.active:after{content:'\2796'}.leftsidebar_accordion_panel{display:none;padding:0 .5em;font-size:small;border-right:2px solid #f2f2f2;border-bottom:2px solid #f2f2f2}.leftsidebar_accordion_panel.show{display:block}.leftsidebar_accordion_panel table{border-collapse:collapse}.leftsidebar_accordion_panel td{border:1px solid #f2f2f2;padding:.2rem .4rem}.button_panel{display:inline-block;width:100%;margin:.2rem 0}.button_panel .text_button,.text_button{color:#00f;padding:.2rem .2rem;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.button_panel .flush_right{float:right}.button_panel .text_button:hover,.text_button:hover{cursor:pointer}.button_panel .text_button:active,.text_button:active{color:#000}.button_panel .active{border-bottom:1px solid #000}.button_panel .button{display:inline-block;padding:.35rem .5rem;margin:0 .05rem;cursor:pointer;background-color:#ccc;border-radius:.2rem;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.button_panel .button:hover{background-color:#000;color:#fff}#attribute_properties{display:table;width:100%;border-collapse:collapse;margin:1rem 0;border:1px solid #ccc}#attribute_properties .property{display:table-row}#attribute_properties .property span{display:table-cell;padding:.2rem .4rem}#attribute_properties .property span input{width:100%;border:1px solid #ccc;margin:0}#attribute_properties .property span input:focus{border:1px solid #000}#attribute_properties .property span select{width:100%;border:1px solid #ccc;margin:0}#attribute_options{display:table;width:100%;border-collapse:collapse;margin:1rem 0;border:1px solid #ccc;table-layout:fixed}#attribute_options .new_option_id_entry{display:inline-block;padding:1rem .2rem}#attribute_options .new_option_id_entry input{border:none;border-bottom:1px solid #ccc;margin:0;font-size:.8rem}#attribute_options .property{display:table-row}#attribute_options .property span{display:table-cell;padding:.2rem .2rem;font-weight:700}#attribute_options .property input{display:table-cell;width:94%;border:none;border-bottom:1px solid #ccc;margin:0;font-size:.8rem}#attribute_options .property input:focus{border-bottom:1px solid #000;background-color:#f2f2f2;color:#000}#attribute_options .property span input[type=checkbox]{vertical-align:middle}#attribute_options .property span input[type=radio]{vertical-align:middle}#user_input_panel{position:fixed;display:none;width:100%;height:100%;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.6);z-index:1002}#user_input_panel .content{position:fixed;background-color:#fff;top:50%;left:50%;transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);padding:2rem 4rem}#user_input_panel .content .title{font-size:large;font-weight:700}#user_input_panel .content .user_inputs{display:table;width:100%;border-collapse:collapse}#user_input_panel .content .user_inputs .row{display:table-row}#user_input_panel .content .user_inputs .cell{display:table-cell;padding:1rem .5rem;vertical-align:middle;border:1px solid #f2f2f2}#user_input_panel .content .user_confirm{display:table;width:100%;text-align:center;margin:2rem 0}#user_input_panel .content .user_confirm .ok{display:table-cell;width:48%}#user_input_panel .content .user_confirm .cancel{display:table-cell;width:48%}#user_input_panel .content .warning{color:red}#annotation_editor_panel{position:fixed;display:none;width:100%;left:0;bottom:0;background-color:#fff;border-top:2px solid #ccc;padding:.2em 1em;overflow:auto;z-index:1001;box-shadow:0 0 1em #ccc}#annotation_editor{display:table;margin-bottom:3em;border-collapse:collapse;font-size:inherit;position:absolute;background-color:#fff}#annotation_editor .row{display:table-row}#annotation_editor .highlight .col{background-color:#e6e6e6}#annotation_editor .col{display:table-cell;padding:.4em .6em;border:1px solid #000;vertical-align:middle;font-size:inherit}#annotation_editor .header{font-weight:700}#annotation_editor .id{font-weight:700}#annotation_editor .col input[type=checkbox]{vertical-align:middle}#annotation_editor .col input[type=radio]{vertical-align:middle;font-size:inherit}#annotation_editor .col label{vertical-align:middle;font-size:inherit}#annotation_editor .col textarea{border:.1em solid #ccc;padding:0;margin:0;font-size:inherit;background-color:#fff}#annotation_editor .col textarea:focus{border:.1em dashed #ccc}#annotation_editor .col span{display:block}#annotation_editor .col horizontal_container{display:inline-block}#annotation_editor .col .img_options{display:inline}#annotation_editor .col .img_options .imrow{display:block}#annotation_editor .col .img_options span{display:inline-block;margin:.2rem .4rem}#annotation_editor .col .img_options span img{height:4em}#annotation_editor .col .img_options p{margin:0;padding:0;font-size:inherit}#annotation_editor .col .img_options input[type=radio]{display:none}#annotation_editor .col .img_options input[type=radio]+label{display:block;cursor:pointer;text-align:center}#annotation_editor .col .img_options input[type=radio]:checked+label{border:.1em solid #000;background-color:#ccc;cursor:default;font-size:inherit}#project_info_panel{display:table;border-collapse:collapse;font-size:.8rem}#project_info_panel .row{display:table-row}#project_info_panel .col{display:table-cell;padding:.4rem .1rem;border:none}#project_info_panel .col input[type=text]{font-size:.8rem;border:none;border-bottom:1px solid #ccc;margin:0;width:100%}#project_info_panel .col input:focus{border-bottom:1px solid #000;background-color:#f2f2f2;color:#000}ul.region_shape{font-size:xx-large;list-style-type:none;overflow:hidden;padding:.4em 0;margin:0}ul.region_shape li{float:left;padding:0 .2em;fill:#fff;stroke:#000}ul.region_shape li:hover{cursor:pointer;fill:#fff;stroke:red}ul.region_shape .selected{fill:#fff;stroke:red}#region_info{font-size:.8em;margin-bottom:.4em}#img_fn_list{display:none;font-size:small;overflow:scroll;min-height:10rem;max-height:25rem}#img_fn_list ul{position:relative;line-height:1.3em;margin:0;padding:0;list-style-type:none}#img_fn_list li{white-space:nowrap;display:block;padding:0 .4rem}#img_fn_list li:hover{background-color:#d5e5ff;cursor:pointer}#img_fn_list .error{color:red}#img_fn_list .sel{border-left:.2rem solid #000!important;font-weight:700}#img_fn_list .buffered{border-left:.2rem solid #ccc}#message_panel{display:block;width:100%;position:fixed;bottom:0;z-index:9999;text-align:center}#message_panel .content{display:inline;margin:auto;background-color:#000;color:#ff0;font-size:small;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:2rem;padding:.5rem 2rem}.text_panel{display:none;margin:auto;font-size:medium;line-height:1.3em;margin:0;max-width:700px}.text_panel li{margin:1em 0;text-align:left}.text_panel p{text-align:left}.svg_button:hover{cursor:pointer}.loading_spinbox{display:inline-block;border:.4em solid #ccc;border-radius:50%;border-top:.4em solid #000;border-bottom:.4em solid #000;-webkit-animation:spin 2s linear infinite;animation:spin 2s linear infinite}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0)}100%{-webkit-transform:rotate(360deg)}}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}#invisible_file_input{width:.1px;height:.1px;opacity:0;overflow:hidden;position:absolute;z-index:-1}.display_none{display:none!important}.display_block{display:block!important}#settings_panel{font-size:1rem;border-collapse:collapse;width:95%}#settings_panel a{border:1px solid #f2f2f2}#settings_panel .row{display:table-row;border-bottom:1px solid #f2f2f2}#settings_panel .variable{display:table-cell;width:60%;padding:.5rem .5rem}#settings_panel .variable div{display:block}#settings_panel .variable .desc{font-size:.7em;color:grey;padding:.2rem 0}#settings_panel .value{display:table-cell;vertical-align:middle;padding-left:1rem}.narrow_page_content li{font-size:.9rem;margin:.4rem 0}.narrow_page_content{width:60%}.force_small_font{font-size:small!important}.key{font-family:monospace;padding:1px 6px;background:linear-gradient(to bottom,#f0f0f0,#fcfcfc);border:1px solid #e0e0e0;white-space:nowrap;color:#303030;border-bottom-width:2px;border-radius:3px;font-size:1.2em}.iw-contextMenu{box-shadow:0 2px 3px rgba(0,0,0,.1)!important;border:1px solid #c8c7cc!important;border-radius:11px!important;display:none;z-index:1000000132;max-width:300px!important;width:auto!important}.TnITTtw-dark-mode .iw-contextMenu,.TnITTtw-dark-mode.iw-contextMenu,.dark-mode .iw-contextMenu{border-color:#747473!important}.iw-cm-menu{background:#fff!important;color:#000!important;margin:0!important;padding:0!important;overflow:visible!important}.TnITTtw-dark-mode .iw-cm-menu,.TnITTtw-dark-mode.iw-cm-menu,.dark-mode .iw-cm-menu{background:#525251!important;color:#fff!important}.iw-cm-menu li{font-family:-apple-system,BlinkMacSystemFont,'Helvetica Neue',Helvetica,Arial,Ubuntu,sans-serif!important;list-style:none!important;padding:10px!important;padding-right:20px!important;border-bottom:1px solid #c8c7cc!important;font-weight:400!important;cursor:pointer!important;position:relative!important;font-size:14px!important;margin:0!important;line-height:inherit!important;border-radius:0!important;display:block!important}.TnITTtw-dark-mode .iw-cm-menu li,.dark-mode .iw-cm-menu li{border-bottom-color:#747473!important}.iw-cm-menu li:first-child{border-top-left-radius:11px!important;border-top-right-radius:11px!important}.iw-cm-menu li:last-child{border-bottom-left-radius:11px!important;border-bottom-right-radius:11px!important;border-bottom:none!important}.iw-mOverlay{position:absolute!important;width:100%!important;height:100%!important;top:0!important;left:0!important;background:#fff!important;opacity:.5!important}.iw-contextMenu li.iw-mDisable{opacity:.3!important;cursor:default!important}.iw-mSelected{background-color:#f6f6f6!important}.TnITTtw-dark-mode .iw-mSelected,.dark-mode .iw-mSelected{background-color:#676766!important}.iw-cm-arrow-right{width:0!important;height:0!important;border-top:5px solid transparent!important;border-bottom:5px solid transparent!important;border-left:5px solid #000!important;position:absolute!important;right:5px!important;top:50%!important;margin-top:-5px!important}.TnITTtw-dark-mode .iw-cm-arrow-right,.dark-mode .iw-cm-arrow-right{border-left-color:#fff!important}@-webkit-keyframes load4{0%,100%{box-shadow:0 -3em 0 .2em,2em -2em 0 0,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 0}12.5%{box-shadow:0 -3em 0 0,2em -2em 0 .2em,3em 0 0 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em 0 0,3em 0 0 .2em,2em 2em 0 0,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 0,2em 2em 0 .2em,0 3em 0 0,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 0,0 3em 0 .2em,-2em 2em 0 0,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 0,-2em 2em 0 .2em,-3em 0 0 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 .2em,-2em -2em 0 0}87.5%{box-shadow:0 -3em 0 0,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 0,-2em -2em 0 .2em}}@keyframes load4{0%,100%{box-shadow:0 -3em 0 .2em,2em -2em 0 0,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 0}12.5%{box-shadow:0 -3em 0 0,2em -2em 0 .2em,3em 0 0 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em 0 0,3em 0 0 .2em,2em 2em 0 0,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 0,2em 2em 0 .2em,0 3em 0 0,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 0,0 3em 0 .2em,-2em 2em 0 0,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 0,-2em 2em 0 .2em,-3em 0 0 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 .2em,-2em -2em 0 0}87.5%{box-shadow:0 -3em 0 0,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 0,-2em -2em 0 .2em}}
        </style>
    </head>

    <body onload="_via_init()" onresize="_via_update_ui_components()">
        <svg style="display: none" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <defs>
                <symbol id="via_logo">
                    <!-- Logo designed by Abhishek Dutta <adutta@robots.ox.ac.uk>, May 2018 -->
                    <title>VGG Image Annotator Logo</title>
                    <rect width="400" height="160" x="0" y="0" fill="#212121"></rect>

                    <text x="56" y="130" font-family="Serif" font-size="100" fill="white">V</text>
                    <text x="180" y="130" font-family="Serif" font-size="100" fill="white">I</text>
                    <text x="270" y="130" font-family="Serif" font-size="100" fill="white">A</text>

                    <rect width="80" height="100" x="52" y="40" stroke="yellow" fill="none" stroke-width="2"></rect>
                    <text x="72" y="30" font-family="&#39;Comic Sans MS&#39;, cursive, sans-serif" font-size="18" fill="yellow">VGG</text>

                    <rect width="50" height="100" x="175" y="45" stroke="yellow" fill="none" stroke-width="2"></rect>
                    <text x="175" y="35" font-family="&#39;Comic Sans MS&#39;, cursive, sans-serif" font-size="18" fill="yellow">Image</text>

                    <rect width="80" height="100" x="265" y="40" stroke="yellow" fill="none" stroke-width="2"></rect>
                    <text x="265" y="30" font-family="&#39;Comic Sans MS&#39;, cursive, sans-serif" font-size="18" fill="yellow">Annotator</text>
                </symbol>
                <symbol id="shape_rectangle">
                    <title>Rectangular region shape</title>
                    <rect width="20" height="12" x="6" y="10" stroke-width="2"></rect>
                </symbol>
                <symbol id="shape_circle">
                    <title>Circular region shape</title>
                    <circle r="10" cx="16" cy="16" stroke-width="2"></circle>
                </symbol>
                <symbol id="shape_ellipse">
                    <title>Elliptical region shape</title>
                    <ellipse rx="12" ry="8" cx="16" cy="16" stroke-width="2"></ellipse>
                </symbol>
                <symbol id="shape_polygon">
                    <title>Polygon region shape</title>
                    <path d="M 15.25,2.2372 3.625,11.6122 6,29.9872 l 20.75,-9.625 2.375,-14.75 z" stroke-width="2"></path>
                </symbol>
                <symbol id="shape_point">
                    <title>Point region shape</title>
                    <circle r="3" cx="16" cy="16" stroke-width="2"></circle>
                </symbol>
                <symbol id="shape_polyline">
                    <title>Polyline region shape</title>
                    <path d="M 2,12 10,24 18,12 24,18" stroke-width="2"></path>
                    <circle r="1" cx="2" cy="12" stroke-width="2"></circle>
                    <circle r="1" cx="10" cy="24" stroke-width="2"></circle>
                    <circle r="1" cx="18" cy="12" stroke-width="2"></circle>
                    <circle r="1" cx="24" cy="18" stroke-width="2"></circle>
                </symbol>

                <!-- Material icons downloaded from https://material.io/icons -->
                <symbol id="icon_settings">
                    <path
                        d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"
                    ></path>
                </symbol>
                <symbol id="icon_save">
                    <path
                        d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"
                    ></path>
                </symbol>
                <symbol id="icon_open">
                    <path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"></path>
                </symbol>
                <symbol id="icon_gridon">
                    <path
                        d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 20H4v-4h4v4zm0-6H4v-4h4v4zm0-6H4V4h4v4zm6 12h-4v-4h4v4zm0-6h-4v-4h4v4zm0-6h-4V4h4v4zm6 12h-4v-4h4v4zm0-6h-4v-4h4v4zm0-6h-4V4h4v4z"
                    ></path>
                </symbol>
                <symbol id="icon_gridoff">
                    <path
                        d="M8 4v1.45l2 2V4h4v4h-3.45l2 2H14v1.45l2 2V10h4v4h-3.45l2 2H20v1.45l2 2V4c0-1.1-.9-2-2-2H4.55l2 2H8zm8 0h4v4h-4V4zM1.27 1.27L0 2.55l2 2V20c0 1.1.9 2 2 2h15.46l2 2 1.27-1.27L1.27 1.27zM10 12.55L11.45 14H10v-1.45zm-6-6L5.45 8H4V6.55zM8 20H4v-4h4v4zm0-6H4v-4h3.45l.55.55V14zm6 6h-4v-4h3.45l.55.54V20zm2 0v-1.46L17.46 20H16z"
                    ></path>
                </symbol>
                <symbol id="icon_next">
                    <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path>
                </symbol>
                <symbol id="icon_prev">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                </symbol>
                <symbol id="icon_list">
                    <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"></path>
                </symbol>
                <symbol id="icon_zoomin">
                    <path
                        d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                    ></path>
                    <path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z"></path>
                </symbol>
                <symbol id="icon_zoomout">
                    <path
                        d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14zM7 9h5v1H7z"
                    ></path>
                </symbol>
                <symbol id="icon_copy">
                    <path
                        d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"
                    ></path>
                </symbol>
                <symbol id="icon_paste">
                    <path
                        d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"
                    ></path>
                </symbol>
                <symbol id="icon_pasten">
                    <path
                        d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"
                    ></path>
                    <text x="8" y="18">n</text>
                </symbol>
                <symbol id="icon_pasteundo">
                    <path
                        d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z"
                    ></path>
                    <text x="8" y="18">x</text>
                </symbol>
                <symbol id="icon_selectall">
                    <path
                        d="M3 5h2V3c-1.1 0-2 .9-2 2zm0 8h2v-2H3v2zm4 8h2v-2H7v2zM3 9h2V7H3v2zm10-6h-2v2h2V3zm6 0v2h2c0-1.1-.9-2-2-2zM5 21v-2H3c0 1.1.9 2 2 2zm-2-4h2v-2H3v2zM9 3H7v2h2V3zm2 18h2v-2h-2v2zm8-8h2v-2h-2v2zm0 8c1.1 0 2-.9 2-2h-2v2zm0-12h2V7h-2v2zm0 8h2v-2h-2v2zm-4 4h2v-2h-2v2zm0-16h2V3h-2v2zM7 17h10V7H7v10zm2-8h6v6H9V9z"
                    ></path>
                </symbol>
                <symbol id="icon_close">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
                </symbol>
                <symbol id="icon_insertcomment">
                    <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"></path>
                </symbol>
                <symbol id="icon_checkbox">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                </symbol>
                <symbol id="icon_fileupload">
                    <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"></path>
                </symbol>
                <symbol id="icon_filedownload">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path>
                </symbol>
            </defs>
        </svg>

        <div id="user_input_panel"></div>

        <div id="message_panel" style="display: none">
            <div id="message_panel_content" class="content">First copy some regions!</div>
        </div>

        <div id="annotation_editor_panel">
            <div class="button_panel">
                <span
                    class="text_button active"
                    onclick="edit_region_metadata_in_annotation_editor()"
                    id="button_edit_region_metadata"
                    title="Manual annotations of regions"
                    >Region Annotations</span
                >
                <span
                    class="text_button"
                    onclick="edit_file_metadata_in_annotation_editor()"
                    id="button_edit_file_metadata"
                    title="Manual annotations of a file"
                    >File Annotations</span
                >

                <span
                    class="button"
                    style="float: right; margin-right: 0.2rem"
                    onclick="annotation_editor_toggle_all_regions_editor()"
                    title="Close this window of annotation editor"
                    >×</span
                >
                <span
                    class="button"
                    style="float: right; margin-right: 0.2rem"
                    onclick="annotation_editor_increase_panel_height()"
                    title="Increase the height of this panel"
                    >↑</span
                >
                <span
                    class="button"
                    style="float: right; margin-right: 0.2rem"
                    onclick="annotation_editor_decrease_panel_height()"
                    title="Decrease the height of this panel"
                    >↓</span
                >
                <span
                    class="button"
                    style="float: right; margin-right: 0.2rem"
                    onclick="annotation_editor_increase_content_size()"
                    title="Increase size of contents in annotation editor"
                    >+</span
                >
                <span
                    class="button"
                    style="float: right; margin-right: 0.2rem"
                    onclick="annotation_editor_decrease_content_size()"
                    title="Decrease size of contents in annotation editor"
                    >−</span
                >
            </div>
        </div>

        <div class="top_panel" id="ui_top_panel">
            <!-- menu bar -->
            <div class="menubar">
                <ul>
                    <li onclick="show_home_panel()" style="cursor: pointer">Home</li>
                    <li>
                        Project
                        <ul>
                            <li onclick="project_open_select_project_file()" title="Load a VIA project (from a JSON file)">Load</li>
                            <li onclick="project_save_with_confirm()" title="Save this VIA project (as a JSON file)">Save</li>
                            <li onclick="settings_panel_toggle()" title="Show/edit project settings">Settings</li>
                            <li class="submenu_divider"></li>
                            <li onclick="sel_local_images()" title="Add images locally stored in this computer">Add local files</li>
                            <li
                                onclick="project_file_add_url_with_input()"
                                title="Add images from a web URL (e.g. http://www.robots.ox.ac.uk/~vgg/software/via/images/swan.jpg)"
                            >
                                Add files from URL
                            </li>
                            <li
                                onclick="project_file_add_abs_path_with_input()"
                                title="Add images using absolute path of file (e.g. /home/abhishek/image1.jpg)"
                            >
                                Add file using absolute path
                            </li>
                            <li
                                onclick="sel_local_data_file(&#39;files_url&#39;)"
                                title="Add images from a list of web url or absolute path stored in a text file (one url or path per line)"
                            >
                                Add url or path from text file
                            </li>
                            <li onclick="project_file_remove_with_confirm()" title="Remove selected file (i.e. file currently being shown)">Remove file</li>
                            <li class="submenu_divider"></li>
                            <li onclick="sel_local_data_file(&#39;attributes&#39;)" title="Import region and file attributes from a JSON file">
                                Import region/file attributes
                            </li>
                            <li onclick="project_save_attributes()" title="Export region and file attributes to a JSON file">Export region/file attributes</li>
                        </ul>
                    </li>

                    <li>
                        Annotation
                        <ul>
                            <li onclick="download_all_region_data(&#39;csv&#39;)" title="Export annotations to a CSV file">Export Annotations (as csv)</li>
                            <li onclick="download_all_region_data(&#39;json&#39;)" title="Export annotaitons to a JSON file">Export Annotations (as json)</li>
                            <li
                                onclick="download_all_region_data(&#39;coco&#39;, &#39;json&#39;)"
                                title="Export annotaitons to COCO (http://cocodataset.org) format"
                            >
                                Export Annotations (COCO format)
                            </li>
                            <li onclick="" class="submenu_divider"></li>
                            <li onclick="sel_local_data_file(&#39;annotations&#39;)" title="Import annotations from a CSV file">
                                Import Annotations (from csv)
                            </li>
                            <li onclick="sel_local_data_file(&#39;annotations&#39;)" title="Import annotations from a JSON file">
                                Import Annotations (from json)
                            </li>
                            <li
                                onclick="sel_local_data_file(&#39;annotations_coco&#39;)"
                                title="Import annotations from a COCO (http://cocodataset.org) formatted JSON file"
                            >
                                Import Annotations (COCO format)
                            </li>

                            <li class="submenu_divider"></li>
                            <li onclick="show_annotation_data()" title="Show a preview of annotations (opens in a new browser windows)">Preview Annotations</li>
                            <li onclick="download_as_image()" title="Download an image containing the annotations">Download as Image</li>
                        </ul>
                    </li>

                    <li>
                        View
                        <ul>
                            <li onclick="image_grid_toggle()" title="Toggle between single image view and image grid view">Toggle image grid view</li>
                            <li onclick="leftsidebar_toggle()" title="Show or hide the sidebar shown in left hand side">Toggle left sidebar</li>
                            <li onclick="toggle_img_fn_list_visibility()" title="Show or hide a panel to update annotations corresponding to file and region">
                                Toggle image filename list
                            </li>
                            <li class="submenu_divider"></li>
                            <li onclick="toggle_attributes_editor()" title="Show or hide a panel to update file and region attributes">
                                Toggle attributes editor
                            </li>
                            <li
                                onclick="annotation_editor_toggle_all_regions_editor()"
                                title="Show or hide a panel to update annotations corresponding to file and region"
                            >
                                Toggle annotation editor (Space)
                            </li>
                            <li class="submenu_divider"></li>
                            <li onclick="toggle_region_boundary_visibility()" title="Show or hide the region boundaries">Show/hide region boundaries (b)</li>
                            <li onclick="toggle_region_id_visibility()" title="Show or hide the region id labels">Show/hide region labels (l)</li>
                            <li onclick="toggle_region_info_visibility()" title="Show or hide the image coordinates">Show/hide region info.</li>
                        </ul>
                    </li>

                </ul>
            </div>
            <!-- end of menubar -->

            <!-- Shortcut toolbar -->
            <div class="toolbar">
                <svg onclick="project_open_select_project_file()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_open"></use>
                    <title>Open Project</title>
                </svg>
                <svg onclick="project_save_with_confirm()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_save"></use>
                    <title>Save Project</title>
                </svg>
                <svg onclick="settings_panel_toggle()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_settings"></use>
                    <title>Update Project Settings</title>
                </svg>
                <!--
        <svg onclick="" viewbox="0 0 24 24"><use xlink:href="#icon_checkbox"></use><title>Locate Files</title></svg>
        -->

                <svg onclick="sel_local_data_file(&#39;annotations&#39;)" style="margin-left: 1rem" viewBox="0 0 24 24">
                    <use xlink:href="#icon_fileupload"></use>
                    <title>Import Annotations from CSV</title>
                </svg>
                <svg onclick="download_all_region_data(&#39;csv&#39;)" viewBox="0 0 24 24">
                    <use xlink:href="#icon_filedownload"></use>
                    <title>Download Annotations as CSV</title>
                </svg>

                <svg onclick="image_grid_toggle()" id="toolbar_image_grid_toggle" style="margin-left: 1rem" viewBox="0 0 24 24">
                    <use xlink:href="#icon_gridon"></use>
                    <title>Switch to Image Grid View</title>
                </svg>
                <svg onclick="annotation_editor_toggle_all_regions_editor()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_insertcomment"></use>
                    <title>Toggle Annotation Editor</title>
                </svg>

                <svg onclick="move_to_prev_image()" style="margin-left: 1rem" viewBox="0 0 24 24">
                    <use xlink:href="#icon_prev"></use>
                    <title>Previous</title>
                </svg>
                <svg onclick="toggle_img_fn_list_visibility()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_list"></use>
                    <title>Toggle Filename List</title>
                </svg>
                <svg onclick="move_to_next_image()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_next"></use>
                    <title>Next</title>
                </svg>

                <svg onclick="zoom_in()" style="margin-left: 1rem" viewBox="0 0 24 24">
                    <use xlink:href="#icon_zoomin"></use>
                    <title>Zoom In</title>
                </svg>
                <svg onclick="zoom_out()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_zoomout"></use>
                    <title>Zoom Out</title>
                </svg>

                <svg onclick="sel_all_regions()" viewBox="0 0 24 24" style="margin-left: 1rem">
                    <use xlink:href="#icon_selectall"></use>
                    <title>Select All Regions</title>
                </svg>
                <svg onclick="copy_sel_regions()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_copy"></use>
                    <title>Copy Regions</title>
                </svg>
                <svg onclick="paste_sel_regions_in_current_image()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_paste"></use>
                    <title>Paste Regions</title>
                </svg>
                <svg onclick="paste_to_multiple_images_with_confirm()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_pasten"></use>
                    <title>Paste Region in Multiple Images</title>
                </svg>
                <svg onclick="del_sel_regions_with_confirm()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_pasteundo"></use>
                    <title>Undo Regions Pasted in Multiple Images</title>
                </svg>
                <svg onclick="del_sel_regions()" viewBox="0 0 24 24">
                    <use xlink:href="#icon_close"></use>
                    <title>Delete Region</title>
                </svg>
            </div>
            <!-- end of shortcut toolbar -->
            <input type="file" id="invisible_file_input" name="files[]" style="display: none" accept=".json" />
        </div>
        <!-- endof #top_panel -->

        <!-- Middle Panel contains a left-sidebar and image display areas -->
        <div class="middle_panel">
            <!-- this panel contains a button to shows the left side bar -->
            <div id="leftsidebar_collapse_panel">
                <span class="text_button" onclick="leftsidebar_toggle()" title="Show left sidebar">▸</span>
            </div>

            <div id="leftsidebar" style="display: table-cell; width: 18rem">
                <div class="leftsidebar_accordion_panel show" style="float: right; border: 2px solid #f2f2f2">
                    <span class="text_button" onclick="leftsidebar_decrease_width()" title="Reduce width of this toolbar panel">←</span>
                    <span class="text_button" onclick="leftsidebar_increase_width()" title="Increase width of this toolbar panel">→</span>
                    <span class="text_button" onclick="leftsidebar_toggle()" title="Show/hide this toolbar panel">◂</span>
                </div>

                <button class="leftsidebar_accordion active">Region Shape</button>
                <div class="leftsidebar_accordion_panel show">
                    <ul class="region_shape">
                        <li id="region_shape_rect" class="" onclick="select_region_shape(&#39;rect&#39;)" title="Rectangle (Shortcut key 1)">
                            <svg height="32" viewBox="0 0 32 32"><use xlink:href="#shape_rectangle"></use></svg>
                        </li>
                        <li id="region_shape_circle" onclick="select_region_shape(&#39;circle&#39;)" title="Circle (Shortcut key 2)" class="">
                            <svg height="32" viewBox="0 0 32 32"><use xlink:href="#shape_circle"></use></svg>
                        </li>
                        <li id="region_shape_ellipse" onclick="select_region_shape(&#39;ellipse&#39;)" title="Ellipse (Shortcut key 3)" class="">
                            <svg height="32" viewBox="0 0 32 32"><use xlink:href="#shape_ellipse"></use></svg>
                        </li>
                        <li id="region_shape_polygon" onclick="select_region_shape(&#39;polygon&#39;)" title="Polygon (Shortcut key 4)" class="selected">
                            <svg height="32" viewBox="0 0 32 32"><use xlink:href="#shape_polygon"></use></svg>
                        </li>
                        <li id="region_shape_point" onclick="select_region_shape(&#39;point&#39;)" title="Point (Shortcut key 5)">
                            <svg height="32" viewBox="0 0 32 32"><use xlink:href="#shape_point"></use></svg>
                        </li>
                        <li id="region_shape_polyline" onclick="select_region_shape(&#39;polyline&#39;)" title="Polyline (Shortcut key 6)">
                            <svg height="32" viewBox="0 0 32 32"><use xlink:href="#shape_polyline"></use></svg>
                        </li>
                    </ul>
                    <div id="region_info" class="display_none">&nbsp;</div>
                </div>

                <!-- Project -->
                <button class="leftsidebar_accordion active" id="project_panel_title">Project</button>
                <div class="leftsidebar_accordion_panel show" id="img_fn_list_panel">
                    <div id="project_info_panel">
                        <div class="row">
                            <span class="col"><label for="project_name">Name: </label></span>
                            <span class="col"
                                ><input type="text" value="" onchange="project_on_name_update(this)" id="project_name" title="VIA project name" class=""
                            /></span>
                        </div>
                    </div>
                    <div id="project_tools_panel">
                        <div class="button_panel" style="margin: 0.1rem 0">
                            <select
                                style="width: 48%"
                                id="filelist_preset_filters_list"
                                onchange="img_fn_list_onpresetfilter_select()"
                                title="Filter file list using predefined filters"
                            >
                                <option value="all">All files</option>
                                <option value="files_without_region">Show files without regions</option>
                                <option value="files_missing_region_annotations">Show files missing region annotations</option>
                                <option value="files_missing_file_annotations">Show files missing file annotations</option>
                                <option value="files_error_loading">Files that could not be loaded</option>
                                <option value="regex">Regular Expression</option>
                            </select>
                            <input
                                style="width: 50%"
                                type="text"
                                placeholder="regular expression"
                                oninput="img_fn_list_onregex()"
                                id="img_fn_list_regex"
                                title="Filter using regular expression"
                                class=""
                            />
                        </div>
                    </div>
                    <div id="img_fn_list" style="display: block"><ul></ul></div>
                    <p></p>
                    <div class="button_panel">
                        <span class="button" onclick="sel_local_images()" title="Add new file from local disk">Add Files</span>
                        <span class="button" onclick="project_file_add_url_with_input()" title="Add new file using URL">Add URL</span>
                        <span
                            class="button"
                            onclick="project_file_remove_with_confirm()"
                            title="Remove selected file (i.e. file currently being shown) from project"
                            >Remove</span
                        >
                    </div>
                    <p></p>
                </div>

                <!-- Attributes -->
                <button class="leftsidebar_accordion active" id="attributes_editor_panel_title">Attributes</button>
                <div class="leftsidebar_accordion_panel show" id="attributes_editor_panel">
                    <div class="button_panel" style="padding: 1rem 0">
                        <span
                            class="text_button active"
                            onclick="show_region_attributes_update_panel()"
                            id="button_show_region_attributes"
                            title="Show region attributes"
                            >Region Attributes</span
                        >
                        <span class="text_button" onclick="show_file_attributes_update_panel()" id="button_show_file_attributes" title="Show file attributes"
                            >File Attributes</span
                        >
                    </div>
                    <div id="attributes_update_panel">
                        <div class="button_panel">
                            <input style="width: 70%" type="text" placeholder="attribute name" id="user_input_attribute_id" value="" />
                            <span id="button_add_new_attribute" class="button" onclick="add_new_attribute_from_user_input()" title="Add new attribute">+</span>
                            <span id="button_del_attribute" class="button" onclick="delete_existing_attribute_with_confirm()" title="Delete existing attribute"
                                >−</span
                            >
                        </div>
                        <div class="button_panel" style="margin: 0.1rem 0">
                            <select
                                style="width: 100%"
                                id="attributes_name_list"
                                onchange="update_current_attribute_id(this)"
                                title="List of existing attributes"
                            ></select>
                        </div>
                        <div id="attribute_properties"></div>
                        <div id="attribute_options"></div>
                        <p style="text-align: center">
                            <span
                                class="text_button"
                                title="Show a spreadsheet like editor for all manual annotations"
                                onclick="annotation_editor_toggle_all_regions_editor()"
                                >Toggle Annotation Editor</span
                            >
                        </p>
                    </div>
                </div>

                <button class="leftsidebar_accordion active">Keyboard Shortcuts</button>
                <div class="leftsidebar_accordion_panel show">
                    <div style="display: block; text-align: center; padding: 1rem">Available only on image focus</div>
                    <table>
                        <tbody>
                            <tr>
                                <td style="width: 8em">
                                    <span class="key">←</span>&nbsp;<span class="key">↑</span>&nbsp;<span class="key">→</span>&nbsp;<span class="key">↓</span>
                                </td>
                                <td>Move selected region by 1 px (Shift to jump)</td>
                            </tr>
                            <tr>
                                <td><span class="key">a</span></td>
                                <td>Select all regions</td>
                            </tr>

                            <tr>
                                <td><span class="key">c</span></td>
                                <td>Copy selected regions</td>
                            </tr>
                            <tr>
                                <td><span class="key">v</span></td>
                                <td>Paste selected regions</td>
                            </tr>
                            <tr>
                                <td><span class="key">d</span></td>
                                <td>Delete selected regions</td>
                            </tr>
                            <tr>
                                <td><span class="key">Ctrl</span> + Wheel</td>
                                <td>Zoom in/out (mouse cursor is over image)</td>
                            </tr>
                            <tr>
                                <td><span class="key">l</span></td>
                                <td>Toggle region label</td>
                            </tr>
                            <tr>
                                <td><span class="key">b</span></td>
                                <td>Toggle region boundary</td>
                            </tr>
                            <tr>
                                <td><span class="key">Enter</span></td>
                                <td>Finish drawing polyshape</td>
                            </tr>
                            <tr>
                                <td><span class="key">Backspace</span></td>
                                <td>Delete last polyshape vertex</td>
                            </tr>
                        </tbody>
                    </table>

                    <div style="display: block; text-align: center; padding: 1rem">Always Available</div>
                    <table>
                        <tbody>
                            <tr>
                                <td style="width: 8em"><span class="key">←</span>&nbsp;<span class="key">→</span></td>
                                <td>Move to next/previous image</td>
                            </tr>
                            <tr>
                                <td><span class="key">+</span>&nbsp;<span class="key">-</span>&nbsp;<span class="key">=</span></td>
                                <td>Zoom in/out/reset</td>
                            </tr>
                            <tr>
                                <td><span class="key">↑</span></td>
                                <td>Update region label</td>
                            </tr>
                            <tr>
                                <td><span class="key">↓</span></td>
                                <td>Update region colour</td>
                            </tr>
                            <tr>
                                <td><span class="key">Spacebar</span></td>
                                <td>Toggle annotation editor (Ctrl to toggle on image editor)</td>
                            </tr>
                            <tr>
                                <td><span class="key">Home</span> / <span class="key">h</span></td>
                                <td>Jump to first image</td>
                            </tr>
                            <tr>
                                <td><span class="key">End</span> / <span class="key">e</span></td>
                                <td>Jump to last image</td>
                            </tr>
                            <tr>
                                <td><span class="key">PgUp</span> / <span class="key">u</span></td>
                                <td>Jump several images</td>
                            </tr>
                            <tr>
                                <td><span class="key">PgDown</span> / <span class="key">d</span></td>
                                <td>Jump several images</td>
                            </tr>

                            <tr>
                                <td><span class="key">Esc</span></td>
                                <td>Cancel ongoing task</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- end of leftsidebar -->

            <!-- Main display area: contains image canvas, ... -->
            <div id="display_area">
                <div id="image_panel" class="display_area_content display_none">
                    <!-- buffer images using <img> element will be added here -->

                    <!-- @todo: in future versions, this canvas will be replaced by a <svg> element -->
                    <canvas id="region_canvas" width="1" height="1" tabindex="1"
                        >Sorry, your browser does not support HTML5 Canvas functionality which is required for this application.</canvas
                    >
                    <!-- here, a child div with id="annotation_editor" is added by javascript -->
                </div>
                <div id="image_grid_panel" class="display_area_content display_none">
                    <div id="image_grid_group_panel">
                        <span class="tool"
                            >Group by&nbsp;
                            <select id="image_grid_toolbar_group_by_select" onchange="image_grid_toolbar_onchange_group_by_select(this)"></select
                        ></span>
                    </div>

                    <div id="image_grid_toolbar">
                        <span>Selected</span>
                        <span id="image_grid_group_by_sel_img_count">0</span>
                        <span>of</span>
                        <span id="image_grid_group_by_img_count">0</span>
                        <span>images in current group, show</span>

                        <span>
                            <select id="image_grid_show_image_policy" onchange="image_grid_onchange_show_image_policy(this)">
                                <option value="all">all images (paginated)</option>
                                <option value="first_mid_last">only first, middle and last image</option>
                                <option value="even_indexed">even indexed images (i.e. 0,2,4,...)</option>
                                <option value="odd_indexed">odd indexed images (i.e. 1,3,5,...)</option>
                                <option value="gap5">images 1, 5, 10, 15,...</option>
                                <option value="gap25">images 1, 25, 50, 75, ...</option>
                                <option value="gap50">images 1, 50, 100, 150, ...</option>
                            </select>
                        </span>

                        <div id="image_grid_nav"></div>
                    </div>

                    <div id="image_grid_content" style="height: 793px">
                        <div id="image_grid_content_img"></div>
                        <svg xmlns:xlink="http://www.w3.org/2000/svg" id="image_grid_content_rshape"></svg>
                    </div>

                    <div id="image_grid_info"></div>
                </div>
                <!-- end of image grid panel -->

                <div id="settings_panel" class="display_area_content display_none">
                    <h2>Settings</h2>
                    <div class="row">
                        <div class="variable">
                            <div class="name">Project Name</div>
                        </div>

                        <div class="value">
                            <input type="text" id="_via_settings.project.name" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="variable">
                            <div class="name">Default Path</div>
                            <div class="desc">
                                If all images in your project are saved in a single folder, set the default path to the location of this folder. The VIA
                                application will load images from this folder by default. Note: a default path of <code>"./"</code> indicates that the folder
                                containing <code>via.html</code> application file also contains the images in this project. For example:
                                <code>/datasets/VOC2012/JPEGImages/</code> or <code>C:\Documents\data\</code>&nbsp;<strong
                                    >(note the trailing <code>/</code> and <code>\</code></strong
                                >)
                            </div>
                        </div>

                        <div class="value">
                            <input type="text" id="_via_settings.core.default_filepath" placeholder="/datasets/pascal/voc2012/VOCdevkit/VOC2012/JPEGImages/" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="variable">
                            <div class="name">Search Path List</div>
                            <div class="desc">
                                If you define multiple paths, all these folders will be searched to find images in this project. We do not recommend this
                                approach as it is computationally expensive to search for images in multiple folders.
                                <ol id="_via_settings.core.filepath"></ol>
                            </div>
                        </div>

                        <div class="value">
                            <input type="text" id="settings_input_new_filepath" placeholder="/datasets/pascal/voc2012/VOCdevkit/VOC2012/JPEGImages" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="variable">
                            <div class="name">Region Label</div>
                            <div class="desc">
                                By default, each region in an image is labelled using the region-id. Here, you can select a more descriptive labelling of
                                regions.
                            </div>
                        </div>

                        <div class="value">
                            <select id="_via_settings.ui.image.region_label"></select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="variable">
                            <div class="name">Region Colour</div>
                            <div class="desc">
                                By default, each region is drawn using a single colour. Using this setting, you can assign a unique colour to regions grouped
                                according to a region attribute.
                            </div>
                        </div>

                        <div class="value">
                            <select id="_via_settings.ui.image.region_color"></select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="variable">
                            <div class="name">Region Label Font</div>
                            <div class="desc">Font size and font family for showing region labels.</div>
                        </div>

                        <div class="value">
                            <input id="_via_settings.ui.image.region_label_font" placeholder="12px Arial" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="variable">
                            <div class="name">Preload Buffer Size</div>
                            <div class="desc">
                                Images are preloaded in buffer to allow smoother navigation of next/prev images. A large buffer size may slow down the overall
                                browser performance. To disable preloading, set buffer size to 0.
                            </div>
                        </div>
                        <div class="value">
                            <input type="text" id="_via_settings.core.buffer_size" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="variable">
                            <div class="name">On-image Annotation Editor</div>
                            <div class="desc">
                                When a single region is selected, the on-image annotation editor is gets activated which the user to update annotations of this
                                region. By default, this on-image annotation editor is placed near the selected region.
                            </div>
                        </div>

                        <div class="value">
                            <select id="_via_settings.ui.image.on_image_annotation_editor_placement">
                                <option value="NEAR_REGION">close to selected region</option>
                                <option value="IMAGE_BOTTOM">at the bottom of image being annotated</option>
                                <option value="DISABLE">DISABLE on-image annotation editor</option>
                            </select>
                        </div>
                    </div>

                    <div class="row" style="border: none">
                        <button onclick="settings_save()" value="save_settings" style="margin-top: 2rem">Save</button>
                        <button onclick="settings_panel_toggle()" value="cancel_settings" style="margin-left: 2rem">Cancel</button>
                    </div>
                </div>
                <!-- end of settings panel -->

                <div id="page_404" class="display_area_content display_none narrow_page_content">
                    <h2>File Not Found</h2>
                    <p>Filename: <span style="font-family: Mono" id="page_404_filename"></span></p>

                    <p>
                        We recommend that you update the default path in
                        <span class="text_button" title="Show Project Settings" onclick="settings_panel_toggle()">project settings</span> to the folder which
                        contains this image.
                    </p>

                    <p>
                        A temporary fix is to use
                        <span class="text_button" title="Load or Add Images" onclick="sel_local_images()">browser's file selector</span> to manually locate and
                        add this file. We do not recommend this approach because it requires you to repeat this process every time your load this project in the
                        VIA application.
                    </p>
                </div>
                <!-- end of file not found panel -->

                <div id="page_start_info" class="display_area_content narrow_page_content">
                    <ul>
                        <li>
                            <span class="text_button" title="Load or Add Images" onclick="sel_local_images()">이미지 선택하세요.</span>
                            <span
                                class="text_button"
                                title="Add images from a web URL (e.g. http://www.robots.ox.ac.uk/~vgg/software/via/images/swan.jpg)"
                                onclick="project_file_add_url_with_input()"
                                >URL로 추가하기</span
                            >
                            <span
                                class="text_button"
                                title="Add images using absolute path of file (e.g. /home/abhishek/image1.jpg)"
                                onclick="project_file_add_abs_path_with_input()"
                                >절대경로로 추가하기</span
                            >
                        </li>
                        <!-- <li>
                            Use <span class="text_button" title="Toggle attributes editor panel" onclick="toggle_attributes_editor()">attribute editor</span> to
                            define attributes (e.g. name) and
                            <span class="text_button" title="Toggle annotations editor panel" onclick="annotation_editor_toggle_all_regions_editor()"
                                >annotation editor</span
                            >
                            to describe each region (e.g. cat) using these attributes.
                        </li>
                        <li>
                            Remember to <span class="text_button" onclick="project_save_with_confirm()">save</span> your project before closing this application
                            so that you can <span class="text_button" onclick="project_open_select_project_file()">load</span> it later to continue annotation.
                        </li>
                        <li>
                            For help, see the
                            <span class="text_button" onclick="set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.PAGE_GETTING_STARTED)"
                                >Getting Started</span
                            >
                            page and pre-loaded demo: <a href="http://www.robots.ox.ac.uk/~vgg/software/via/via_demo.html">image annotation</a> and
                            <a href="http://www.robots.ox.ac.uk/~vgg/software/via/via_face_demo.html">face annotation</a>.
                        </li> -->
                    </ul>
                </div>

                <div id="page_getting_started" class="display_area_content display_none narrow_page_content">
                    <p>
                        A more detailed user guide (with screenshots and descriptions) is
                        <a href="http://www.robots.ox.ac.uk/~vgg/software/via/docs/user_guide.html">available here</a>.
                    </p>
                    <ol>
                        <li>
                            <strong>Load Images</strong>: The first step is to load all the images that you wish to annotate. There are multiple ways to add
                            images to a VIA project. Choose the method that suits your use case.
                            <ul>
                                <li>
                                    Method 1: Selecting local files using browser's file selector
                                    <ol>
                                        <li>
                                            Click
                                            <span class="text_button" title="Load or Add Images" onclick="sel_local_images()"
                                                ><code>Project → Add local files</code></span
                                            >
                                        </li>
                                        <li>Select desired images and click <code>Open</code></li>
                                    </ol>
                                </li>
                                <li>
                                    Method 2: Adding files from URL or absolute path
                                    <ol>
                                        <li>
                                            Click
                                            <span
                                                class="text_button"
                                                title="Add images from a web URL (e.g. http://www.robots.ox.ac.uk/~vgg/software/via/images/swan.jpg)"
                                                onclick="project_file_add_url_with_input()"
                                                ><code>Project → Add files from URL</code></span
                                            >
                                        </li>
                                        <li>Enter URL and click <code>OK</code></li>
                                    </ol>
                                </li>
                                <li>
                                    Method 3: Adding files from list of url or absolute path stored in text file
                                    <ol>
                                        <li>Create a text file containing URL and absolute path (one per line)</li>
                                        <li>
                                            Click
                                            <span
                                                class="text_button"
                                                title="Add images from a list of web url or absolute path stored in a text file (one url or path per line)"
                                                onclick="sel_local_data_file(&#39;files_url&#39;)"
                                                ><code>Project → Add url or path from text file</code></span
                                            >
                                        </li>
                                        <li>Select the text file and click <code>Open</code></li>
                                    </ol>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <strong>Draw Regions</strong>: Select a region shape (<span class="text_button" onclick="select_region_shape(&#39;rect&#39;)"
                                >rectangle</span
                            >, <span class="text_button" onclick="select_region_shape(&#39;circle&#39;)">circle</span>,
                            <span class="text_button" onclick="select_region_shape(&#39;ellipse&#39;)">ellipse</span>,
                            <span class="text_button" onclick="select_region_shape(&#39;polygon&#39;)">polygon</span>,
                            <span class="text_button" onclick="select_region_shape(&#39;point&#39;)">point</span>,
                            <span class="text_button" onclick="select_region_shape(&#39;polyline&#39;)">polyline</span>) from the left sidebar and draw regions
                            as follows:

                            <ul>
                                <li>
                                    Rectangle, Circle and Ellipse
                                    <ul>
                                        <li>Press left mouse button, drag mouse cursor and release mouse button.</li>
                                        <li>
                                            To define a point inside an existing region, click inside the region to select it (if not already selected), now
                                            press left mouse button, drag and release to draw region inside existing region.
                                        </li>
                                        <li>
                                            To select, click inside the region. If the click point contains multiple regions, then clicking multiple times at
                                            that location shuffles selection through those regions.
                                        </li>
                                    </ul>
                                </li>
                            </ul>

                            <ul>
                                <li>
                                    Point
                                    <ul>
                                        <li>Click to define points.</li>
                                        <li>
                                            To draw a region inside existing region, click inside the region to select it (if not already selected), now click
                                            again to define the point.
                                        </li>
                                        <li>To select, click on (or near) the existing point.</li>
                                    </ul>
                                </li>
                            </ul>

                            <ul>
                                <li>
                                    Polygon and Polyline
                                    <ul>
                                        <li>Click to define vertices.</li>
                                        <li>Press <strong>[Enter]</strong> to finish drawing the region or press [Esc] to cancel.</li>
                                        <li>
                                            If the first vertex needs to be defined inside an existing region, click inside the region to select it (if not
                                            already selected), now click again to define the vertex.
                                        </li>
                                        <li>
                                            To select, click inside the region. If the click point contains multiple regions, then clicking multiple times at
                                            that location shuffles selection through those regions.
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>

                        <li>
                            <strong>Create Annotations</strong>: For a more detailed description of this step, see
                            <a href="http://www.robots.ox.ac.uk/~vgg/software/via/docs/creating_annotations.html">Creating Annotations : VIA User Guide</a>.
                            Click the
                            <span class="text_button" onclick="annotation_editor_toggle_all_regions_editor()"
                                ><code>View → Toggle attributes editor</code></span
                            >
                            to show attributes editor panel in left sidebar and add the desired file or region attributes (e.g. name). Now click
                            <span class="text_button" onclick="annotation_editor_toggle_all_regions_editor()"
                                ><code>View → Toggle annotations editor</code></span
                            >
                            to show the annotation editor panel in the bottom side. Update the annotations for each region.
                        </li>
                        <li>
                            <strong>Export Annotations</strong>: To export the annotations in json or csv format, click
                            <span class="text_button" onclick="download_all_region_data(&#39;csv&#39;)"><code>Annotation → Export annotations</code></span> in
                            top menubar.
                        </li>
                        <li>
                            <strong>Save Project</strong>: To save the project, click
                            <span class="text_button" onclick="project_save_with_confirm()"><code>Project → Save</code></span> in top menubar.
                        </li>
                    </ol>
                </div>

                <div id="page_load_ongoing" class="display_area_content narrow_page_content display_none">
                    <div style="text-align: center">
                        <a href="http://www.robots.ox.ac.uk/~vgg/software/via/">
                            <svg height="160" viewBox="0 0 400 160" style="background-color: #212121">
                                <use xlink:href="#via_logo"></use>
                            </svg>
                        </a>
                        <div style="margin-top: 4rem">Loading ...</div>
                    </div>
                </div>

            </div>
            <!-- end of display_area -->
        </div>
        <!-- end of middle_panel -->

        <!-- this vertical spacer is needed to allow scrollbar to show
         items like Keyboard Shortcut hidden under the attributes panel -->
        <div style="width: 100%; height: 40px" id="vertical_space"></div>

        <!-- <script src="via.js"></script> -->
        <script>
"use strict";var _via_current_image_filename,_via_current_image,_via_current_image_width,_via_current_image_height,_via_reg_ctx,_via_canvas_width,_via_canvas_height,_via_region_click_x,_via_region_click_y,_via_paste_to_multiple_images_input,_via_message_clear_timer,VIA_VERSION="2.0.10",VIA_NAME="VGG Image Annotator",VIA_SHORT_NAME="VIA",VIA_REGION_SHAPE={RECT:"rect",CIRCLE:"circle",ELLIPSE:"ellipse",POLYGON:"polygon",POINT:"point",POLYLINE:"polyline"},VIA_ATTRIBUTE_TYPE={TEXT:"text",CHECKBOX:"checkbox",RADIO:"radio",IMAGE:"image",DROPDOWN:"dropdown"},VIA_DISPLAY_AREA_CONTENT_NAME={IMAGE:"image_panel",IMAGE_GRID:"image_grid_panel",SETTINGS:"settings_panel",PAGE_404:"page_404",PAGE_GETTING_STARTED:"page_getting_started",PAGE_ABOUT:"page_about",PAGE_START_INFO:"page_start_info",PAGE_LICENSE:"page_license"},VIA_ANNOTATION_EDITOR_MODE={SINGLE_REGION:"single_region",ALL_REGIONS:"all_regions"},VIA_ANNOTATION_EDITOR_PLACEMENT={NEAR_REGION:"NEAR_REGION",IMAGE_BOTTOM:"IMAGE_BOTTOM",DISABLE:"DISABLE"},VIA_REGION_EDGE_TOL=5,VIA_REGION_CONTROL_POINT_SIZE=2,VIA_POLYGON_VERTEX_MATCH_TOL=5,VIA_REGION_MIN_DIM=3,VIA_MOUSE_CLICK_TOL=2,VIA_ELLIPSE_EDGE_TOL=.2,VIA_THETA_TOL=Math.PI/18,VIA_POLYGON_RESIZE_VERTEX_OFFSET=100,VIA_CANVAS_DEFAULT_ZOOM_LEVEL_INDEX=3,VIA_CANVAS_ZOOM_LEVELS=[.25,.5,.75,1,1.5,2,2.5,3,4,5,6,7,8,9,10],VIA_REGION_COLOR_LIST=["#E69F00","#56B4E9","#009E73","#D55E00","#CC79A7","#F0E442","#ffffff"],VIA_REGION_SHAPES_POINTS_RADIUS=3,VIA_REGION_POINT_RADIUS=3,VIA_REGION_POINT_RADIUS_DEFAULT=3,VIA_THEME_REGION_BOUNDARY_WIDTH=3,VIA_THEME_BOUNDARY_LINE_COLOR="black",VIA_THEME_BOUNDARY_FILL_COLOR="yellow",VIA_THEME_SEL_REGION_FILL_COLOR="#808080",VIA_THEME_SEL_REGION_FILL_BOUNDARY_COLOR="yellow",VIA_THEME_SEL_REGION_OPACITY=.5,VIA_THEME_MESSAGE_TIMEOUT_MS=6e3,VIA_THEME_CONTROL_POINT_COLOR="#ff0000",VIA_CSV_SEP=",",VIA_CSV_QUOTE_CHAR='"',VIA_CSV_KEYVAL_SEP=":",_via_img_metadata={},_via_img_src={},_via_img_fileref={},_via_img_count=0,_via_canvas_regions=[],_via_canvas_scale=1,_via_image_id="",_via_image_index=-1,_via_img_stat={},_via_is_all_img_stat_read_ongoing=!1,_via_img_stat_current_img_index=!1,_via_display_area=document.getElementById("display_area"),_via_img_panel=document.getElementById("image_panel"),_via_reg_canvas=document.getElementById("region_canvas"),_via_canvas_zoom_level_index=VIA_CANVAS_DEFAULT_ZOOM_LEVEL_INDEX,_via_canvas_scale_without_zoom=1,_via_is_user_drawing_region=!1,_via_current_image_loaded=!1,_via_is_window_resized=!1,_via_is_user_resizing_region=!1,_via_is_user_moving_region=!1,_via_is_user_drawing_polygon=!1,_via_is_region_selected=!1,_via_is_all_region_selected=!1,_via_is_loaded_img_list_visible=!1,_via_is_attributes_panel_visible=!1,_via_is_reg_attr_panel_visible=!1,_via_is_file_attr_panel_visible=!1,_via_is_canvas_zoomed=!1,_via_is_loading_current_image=!1,_via_is_region_id_visible=!0,_via_is_region_boundary_visible=!0,_via_is_region_info_visible=!1,_via_is_ctrl_pressed=!1,_via_is_debug_mode=!1,_via_current_shape=VIA_REGION_SHAPE.RECT,_via_current_polygon_region_id=-1,_via_user_sel_region_id=-1,_via_click_x0=0,_via_click_y0=0,_via_click_x1=0,_via_click_y1=0,_via_region_edge=[-1,-1],_via_current_x=0,_via_current_y=0,_via_region_selected_flag=[],_via_copied_image_regions=[],_via_attribute_being_updated="region",_via_attributes={region:{},file:{}},_via_current_attribute_id="",_via_canvas_regions_group_color={},_via_user_input_ok_handler=null,_via_user_input_cancel_handler=null,_via_user_input_data={},_via_annotaion_editor_panel=document.getElementById("annotation_editor_panel"),_via_metadata_being_updated="region",_via_annotation_editor_mode=VIA_ANNOTATION_EDITOR_MODE.SINGLE_REGION,_via_is_local_storage_available=!1,_via_is_save_ongoing=!1,_via_image_id_list=[],_via_image_filename_list=[],_via_image_load_error=[],_via_image_filepath_resolved=[],_via_image_filepath_id_list=[],_via_reload_img_fn_list_table=!0,_via_img_fn_list_img_index_list=[],_via_img_fn_list_html=[],image_grid_panel=document.getElementById("image_grid_panel"),_via_display_area_content_name="",_via_display_area_content_name_prev="",_via_image_grid_requires_update=!1,_via_image_grid_content_overflow=!1,_via_image_grid_load_ongoing=!1,_via_image_grid_page_first_index=0,_via_image_grid_page_last_index=-1,_via_image_grid_selected_img_index_list=[],_via_image_grid_page_img_index_list=[],_via_image_grid_visible_img_index_list=[],_via_image_grid_mousedown_img_index=-1,_via_image_grid_mouseup_img_index=-1,_via_image_grid_img_index_list=[],_via_image_grid_region_index_list=[],_via_image_grid_group={},_via_image_grid_group_var=[],_via_image_grid_group_show_all=!1,_via_image_grid_stack_prev_page=[],VIA_IMG_PRELOAD_INDICES=[1,-1,2,3,-2,4],VIA_IMG_PRELOAD_COUNT=4,_via_buffer_preload_img_index=-1,_via_buffer_img_index_list=[],_via_buffer_img_shown_timestamp=[],_via_preload_img_promise_list=[],_via_settings={ui:{}};_via_settings.ui.annotation_editor_height=25,_via_settings.ui.annotation_editor_fontsize=.8,_via_settings.ui.leftsidebar_width=18,_via_settings.ui.image_grid={},_via_settings.ui.image_grid.img_height=80,_via_settings.ui.image_grid.rshape_fill="none",_via_settings.ui.image_grid.rshape_fill_opacity=.3,_via_settings.ui.image_grid.rshape_stroke="yellow",_via_settings.ui.image_grid.rshape_stroke_width=2,_via_settings.ui.image_grid.show_region_shape=!0,_via_settings.ui.image_grid.show_image_policy="all",_via_settings.ui.image={},_via_settings.ui.image.region_label="__via_region_id__",_via_settings.ui.image.region_color="__via_default_region_color__",_via_settings.ui.image.region_label_font="10px Sans",_via_settings.ui.image.on_image_annotation_editor_placement=VIA_ANNOTATION_EDITOR_PLACEMENT.NEAR_REGION,_via_settings.core={},_via_settings.core.buffer_size=4*VIA_IMG_PRELOAD_COUNT+2,_via_settings.core.filepath={},_via_settings.core.default_filepath="";var invisible_file_input=document.getElementById("invisible_file_input"),display_area=document.getElementById("display_area"),ui_top_panel=document.getElementById("ui_top_panel"),image_panel=document.getElementById("image_panel"),img_buffer_now=document.getElementById("img_buffer_now"),annotation_list_snippet=document.getElementById("annotation_list_snippet"),annotation_textarea=document.getElementById("annotation_textarea"),img_fn_list_panel=document.getElementById("img_fn_list_panel"),img_fn_list=document.getElementById("img_fn_list"),attributes_panel=document.getElementById("attributes_panel"),leftsidebar=document.getElementById("leftsidebar"),BBOX_LINE_WIDTH=4,BBOX_SELECTED_OPACITY=.3,BBOX_BOUNDARY_FILL_COLOR_ANNOTATED="#f2f2f2",BBOX_BOUNDARY_FILL_COLOR_NEW="#aaeeff",BBOX_BOUNDARY_LINE_COLOR="#1a1a1a",BBOX_SELECTED_FILL_COLOR="#ffffff",VIA_ANNOTATION_EDITOR_HEIGHT_CHANGE=5,VIA_ANNOTATION_EDITOR_FONTSIZE_CHANGE=.1,VIA_IMAGE_GRID_IMG_HEIGHT_CHANGE=20,VIA_LEFTSIDEBAR_WIDTH_CHANGE=1,VIA_POLYGON_SEGMENT_SUBTENDED_ANGLE=5,VIA_FLOAT_PRECISION=3,VIA_COCO_EXPORT_RSHAPE=["rect","circle","ellipse","polygon","point"],VIA_COCO_EXPORT_ATTRIBUTE_TYPE=[VIA_ATTRIBUTE_TYPE.DROPDOWN,VIA_ATTRIBUTE_TYPE.RADIO];function file_metadata(_,e){this.filename=_,this.size=e,this.regions=[],this.file_attributes={}}function file_region(){this.shape_attributes={},this.region_attributes={}}function _via_init(){console.log(VIA_NAME),show_message(VIA_NAME+" ("+VIA_SHORT_NAME+") version "+VIA_VERSION+". Ready !",2*VIA_THEME_MESSAGE_TIMEOUT_MS),_via_is_debug_mode&&(document.getElementById("ui_top_panel").innerHTML+="<span>DEBUG MODE</span>"),document.getElementById("img_fn_list").style.display="block",document.getElementById("leftsidebar").style.display="table-cell",project_init_default_project(),_via_init_reg_canvas_context(),_via_init_keyboard_handlers(),_via_init_mouse_handlers(),image_grid_init(),show_single_image_view(),init_leftsidebar_accordion(),attribute_update_panel_set_active_button(),annotation_editor_set_active_button(),init_message_panel(),"function"==typeof _via_load_submodules&&(console.log("Loading VIA submodule"),setTimeout(async function(){await _via_load_submodules()},100))}function _via_init_reg_canvas_context(){_via_reg_ctx=_via_reg_canvas.getContext("2d")}function _via_init_keyboard_handlers(){window.addEventListener("keydown",_via_window_keydown_handler,!1),_via_reg_canvas.addEventListener("keydown",_via_reg_canvas_keydown_handler,!1),_via_reg_canvas.addEventListener("keyup",_via_reg_canvas_keyup_handler,!1)}function _via_init_mouse_handlers(){_via_reg_canvas.addEventListener("dblclick",_via_reg_canvas_dblclick_handler,!1),_via_reg_canvas.addEventListener("mousedown",_via_reg_canvas_mousedown_handler,!1),_via_reg_canvas.addEventListener("mouseup",_via_reg_canvas_mouseup_handler,!1),_via_reg_canvas.addEventListener("mouseover",_via_reg_canvas_mouseover_handler,!1),_via_reg_canvas.addEventListener("mousemove",_via_reg_canvas_mousemove_handler,!1),_via_reg_canvas.addEventListener("wheel",_via_reg_canvas_mouse_wheel_listener,!1),_via_reg_canvas.addEventListener("touchstart",_via_reg_canvas_mousedown_handler,!1),_via_reg_canvas.addEventListener("touchend",_via_reg_canvas_mouseup_handler,!1),_via_reg_canvas.addEventListener("touchmove",_via_reg_canvas_mousemove_handler,!1)}function download_as_image(){if(_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE){var _=document.createElement("canvas");_.width=_via_reg_canvas.width,_.height=_via_reg_canvas.height;var e=_.getContext("2d");e.drawImage(_via_current_image,0,0,_via_reg_canvas.width,_via_reg_canvas.height),e.drawImage(_via_reg_canvas,0,0);var i="image/jpeg";if(_via_current_image.src.startsWith("data:")){var t=_via_current_image.src.indexOf(":",0),a=_via_current_image.src.indexOf(";",t);i=_via_current_image.src.substring(t+1,a)}var n=_.toDataURL(i);n.replace(i,"image/octet-stream");var r=document.createElement("a");r.href=n,r.target="_blank",r.download=_via_current_image_filename;var s=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});r.dispatchEvent(s)}else show_message("This functionality is only available in single image view mode")}function clear_display_area(){var _,e=document.getElementsByClassName("display_area_content");for(_=0;_<e.length;++_)e[_].classList.add("display_none")}function is_content_name_valid(_){var e;for(e in VIA_DISPLAY_AREA_CONTENT_NAME)if(VIA_DISPLAY_AREA_CONTENT_NAME[e]===_)return!0;return!1}function show_home_panel(){show_single_image_view()}function set_display_area_content(_){is_content_name_valid(_)&&(_via_display_area_content_name_prev=_via_display_area_content_name,clear_display_area(),document.getElementById(_).classList.remove("display_none"),_via_display_area_content_name=_)}function show_single_image_view(){if(_via_current_image_loaded){img_fn_list_clear_all_style(),_via_show_img(_via_image_index),set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE),annotation_editor_update_content();var _=document.getElementById("toolbar_image_grid_toggle");_.firstChild.setAttribute("xlink:href","#icon_gridon"),_.childNodes[1].innerHTML="Switch to Image Grid View"}else set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.PAGE_START_INFO)}function show_image_grid_view(){if(_via_current_image_loaded){img_fn_list_clear_all_style(),set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID),image_grid_toolbar_update_group_by_select(),0===_via_image_grid_group_var.length&&image_grid_show_all_project_images(),annotation_editor_update_content();var _=document.getElementById("toolbar_image_grid_toggle");_.firstChild.setAttribute("xlink:href","#icon_gridoff"),_.childNodes[1].innerHTML="Switch to Single Image View"}else set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.PAGE_START_INFO)}function sel_local_images(){invisible_file_input&&(invisible_file_input.setAttribute("multiple","multiple"),invisible_file_input.accept=".jpg,.jpeg,.png,.bmp",invisible_file_input.onchange=project_file_add_local,invisible_file_input.click())}function download_all_region_data(_,e){void 0===e&&(e=_),pack_via_metadata(_).then(function(i){var t=new Blob(i,{type:"text/"+e+";charset=utf-8"}),a="via_export";void 0!==_via_settings&&_via_settings.hasOwnProperty("project")&&""!==_via_settings.project.name&&(a=_via_settings.project.name),"csv"===e&&"json"===e||(a+="_"+_+"."+e),save_data_to_local_file(t,a)}.bind(this),function(_){show_message("Failed to download data: ["+_+"]")}.bind(this))}function sel_local_data_file(_){if(invisible_file_input){switch(_){case"annotations":invisible_file_input.accept=".csv,.json",invisible_file_input.onchange=import_annotations_from_file;break;case"annotations_coco":invisible_file_input.accept=".json",invisible_file_input.onchange=load_coco_annotations_json_file;break;case"files_url":invisible_file_input.accept="",invisible_file_input.onchange=import_files_url_from_file;break;case"attributes":invisible_file_input.accept="json",invisible_file_input.onchange=project_import_attributes_from_file;break;default:return void console.log("sel_local_data_file() : unknown type "+_)}invisible_file_input.removeAttribute("multiple"),invisible_file_input.click()}}function import_files_url_from_file(_){var e,i=_.target.files;for(e=0;e<i.length;++e)load_text_file(i[e],import_files_url_from_csv)}function import_annotations_from_file(_){var e,i,t=_.target.files;for(e=0;e<t.length;++e)switch((i=t[e]).type){case"":show_message("File type for "+i.name+" cannot be determined! Assuming text/plain.");case"text/plain":case"application/vnd.ms-excel":case"text/csv":load_text_file(i,import_annotations_from_csv);break;case"text/json":case"application/json":load_text_file(i,import_annotations_from_json);break;default:show_message("Annotations cannot be imported from file of type "+i.type)}}function load_coco_annotations_json_file(_){load_text_file(_.target.files[0],import_coco_annotations_from_json)}function import_annotations_from_csv(_){return new Promise(function(e,i){""!==_&&void 0!==_||i();var t=0,a=0,n=0,r=new RegExp("\n|\r|\r\n","g"),s=_.split(r),o=parse_csv_header_line(s[0]);if(!o.is_header)return show_message("Header line missing in the CSV file"),void i();var g,l=s.length,d="";for(g=1;g<l;++g)if("\n"!==s[g].charAt(0)&&""!==s[g].charAt(0)){var v=parse_csv_line(s[g]);if(v.length===o.csv_column_count){var c=v[o.filename_index],u=v[o.size_index],m=_via_get_image_id(c,u);if(_via_img_metadata.hasOwnProperty(m)||(m=project_add_new_file(c,u),""===_via_settings.core.default_filepath?_via_img_src[m]=c:_via_file_resolve_file_to_default_filepath(m),n+=1,""===d&&(d=m)),'"{}"'!==v[o.file_attr_index]){var p=v[o.file_attr_index],h=json_str_to_map(p=unescape_from_csv(p=remove_prefix_suffix_quotes(p)));for(var f in h)_via_img_metadata[m].file_attributes[f]=h[f],_via_attributes.file.hasOwnProperty(f)||(_via_attributes.file[f]={type:"text"})}var b=new file_region;if('"{}"'!==v[o.region_shape_attr_index]){var E=v[o.region_shape_attr_index];h=json_str_to_map(E=unescape_from_csv(E=remove_prefix_suffix_quotes(E)));for(var f in h)b.shape_attributes[f]=h[f]}if('"{}"'!==v[o.region_attr_index]){var I=v[o.region_attr_index];h=json_str_to_map(I=unescape_from_csv(I=remove_prefix_suffix_quotes(I)));for(var f in h)b.region_attributes[f]=h[f],_via_attributes.region.hasOwnProperty(f)||(_via_attributes.region[f]={type:"text"})}(Object.keys(b.shape_attributes).length>0||Object.keys(b.region_attributes).length>0)&&(_via_img_metadata[m].regions.push(b),t+=1)}else a+=1}(show_message("Import Summary : ["+n+"] new files, ["+t+"] regions, ["+a+"] malformed csv lines."),n&&update_img_fn_list(),_via_current_image_loaded)?t&&(update_attributes_update_panel(),annotation_editor_update_content(),_via_load_canvas_regions(),_via_redraw_reg_canvas(),_via_reg_canvas.focus()):n&&_via_show_img(_via_image_id_list.indexOf(d));e([n,t,a])})}function parse_csv_header_line(_){return"#filename,file_size,file_attributes,region_count,region_id,region_shape_attributes,region_attributes"===_||"filename,file_size,file_attributes,region_count,region_id,region_shape_attributes,region_attributes"===_?{is_header:!0,filename_index:0,size_index:1,file_attr_index:2,region_shape_attr_index:5,region_attr_index:6,csv_column_count:7}:{is_header:!1}}function import_coco_annotations_from_json(_){return new Promise(function(e,i){if(""!==_&&void 0!==_){var t=JSON.parse(_);if(t.hasOwnProperty("info")&&t.hasOwnProperty("categories")&&t.hasOwnProperty("annotations")&&t.hasOwnProperty("images")){var a={};for(var n in t.categories){var r=t.categories[n].supercategory,s=t.categories[n].id,o=t.categories[n].name;_via_attributes.region.hasOwnProperty(r)||(_via_attributes.region[r]={type:VIA_ATTRIBUTE_TYPE.RADIO,description:'coco["categories"]['+n+"]="+JSON.stringify(t.categories[n]),options:{},default_options:{}}),_via_attributes.region[r].options[s]=o,a[s]=r}for(var g in _via_attributes.region)Object.keys(_via_attributes.region[g].options).length>5&&(_via_attributes.region[g].type=VIA_ATTRIBUTE_TYPE.DROPDOWN);var l={};for(var d in t.annotations){var v=t.annotations[d].image_id;l.hasOwnProperty(v)||(l[v]=[]),l[v].push(d)}_via_img_metadata={},_via_image_id_list=[],_via_image_filename_list=[],_via_img_count=0;var c=0;for(var u in t.images){var m,p=t.images[u].id;if(m=t.images[u].hasOwnProperty("coco_url")&&""!==t.images[u].coco_url?t.images[u].coco_url:t.images[u].file_name,_via_img_metadata[p]={filename:m,size:-1,regions:[],file_attributes:{width:t.images[u].width,height:t.images[u].height}},_via_image_id_list.push(p),_via_image_filename_list.push(m),_via_img_count+=1,l.hasOwnProperty(p))for(var n in l[p]){for(var h=t.annotations[l[p][n]],f=polygon_to_bbox(h.segmentation),b=!0,E=0;n<h.bbox.length;++E)if(h.bbox[E]!==f[E]){b=!1;break}var I={shape_attributes:{},region_attributes:{}},A=a[h.category_id],y=h.category_id.toString();if(I.region_attributes[A]=y,8===h.segmentation[0].length&&b)I.shape_attributes={name:"rect",x:h.bbox[0],y:h.bbox[1],width:h.bbox[2],height:h.bbox[3]};else{I.shape_attributes={name:"polygon",all_points_x:[],all_points_y:[]};for(E=0;E<h.segmentation[0].length;E+=2)I.shape_attributes.all_points_x.push(h.segmentation[0][E]),I.shape_attributes.all_points_y.push(h.segmentation[0][E+1])}_via_img_metadata[p].regions.push(I),c+=1}}show_message("Import Summary : ["+_via_img_count+"] new files, ["+c+"] regions."),_via_img_count&&update_img_fn_list(),_via_current_image_loaded?c&&(update_attributes_update_panel(),annotation_editor_update_content(),_via_load_canvas_regions(),_via_redraw_reg_canvas(),_via_reg_canvas.focus()):_via_img_count&&_via_show_img(0),e([_via_img_count,c,0])}else show_message("File does not contain valid annotations in COCO format.")}else show_message("Empty file")})}function import_annotations_from_json(_){return new Promise(function(e,i){if(""!==_&&void 0!==_){var t=JSON.parse(_),a=0,n=0;for(var r in t){for(var s in _via_img_metadata.hasOwnProperty(r)||(project_add_new_file(t[r].filename,t[r].size,r),""===_via_settings.core.default_filepath?_via_img_src[r]=t[r].filename:_via_file_resolve_file_to_default_filepath(r),n+=1),t[r].file_attributes)""!==s&&(_via_img_metadata[r].file_attributes[s]=t[r].file_attributes[s],_via_attributes.file.hasOwnProperty(s)||(_via_attributes.file[s]={type:"text"}));var o=t[r].regions;for(var g in o){var l=new file_region;for(var d in o[g].shape_attributes)l.shape_attributes[d]=o[g].shape_attributes[d];for(var v in o[g].region_attributes)""!==v&&(l.region_attributes[v]=o[g].region_attributes[v],_via_attributes.region.hasOwnProperty(v)||(_via_attributes.region[v]={type:"text"}));(Object.keys(l.shape_attributes).length>0||Object.keys(l.region_attributes).length>0)&&(_via_img_metadata[r].regions.push(l),a+=1)}}show_message("Import Summary : ["+n+"] new files, ["+a+"] regions, [0] malformed entries."),n&&update_img_fn_list(),_via_current_image_loaded?a&&(update_attributes_update_panel(),annotation_editor_update_content(),_via_load_canvas_regions(),_via_redraw_reg_canvas(),_via_reg_canvas.focus()):n&&_via_show_img(0),e([n,a,0])}})}function parse_csv_line(_,e){if(void 0===_||0===_.length)return[];void 0===e&&(e=",");for(var i=!1,t=0,a=[],n=0;n<_.length;)_.charAt(n)===e?i?n+=1:(a.push(_.substr(t,n-t)),t=n+1,n+=1):'"'===_.charAt(n)?i?'"'===_.charAt(n+1)?n+=2:(i=!1,n+=1):(i=!0,t=n,n+=1):n+=1;return a.push(_.substr(t)),a}function json_str_to_map(_){return void 0===_||0===_.length?{}:JSON.parse(_)}function map_to_json(_){var e=[];for(var i in _){var t=_[i],a=JSON.stringify(i);a+=VIA_CSV_KEYVAL_SEP,a+=JSON.stringify(t),e.push(a)}return"{"+e.join(VIA_CSV_SEP)+"}"}function escape_for_csv(_){return _.replace(/["]/g,'""')}function unescape_from_csv(_){return _.replace(/""/g,'"')}function remove_prefix_suffix_quotes(_){return'"'===_.charAt(0)&&'"'===_.charAt(_.length-1)?_.substr(1,_.length-2):_}function clone_image_region(_){var e=new file_region;for(var i in _.shape_attributes)e.shape_attributes[i]=clone_value(_.shape_attributes[i]);for(var i in _.region_attributes)e.region_attributes[i]=clone_value(_.region_attributes[i]);return e}function clone_value(_){if("object"==typeof _){if(Array.isArray(_))return _.slice(0);var e={};for(var i in _)_.hasOwnProperty(i)&&(e[i]=clone_value(_[i]));return e}return _}function _via_get_image_id(_,e){return void 0===e?_:_+e}function load_text_file(_,e){if(_){var i=new FileReader;i.addEventListener("progress",function(e){show_message("Loading data from file : "+_.name+" ... ")},!1),i.addEventListener("error",function(){show_message("Error loading data text file :  "+_.name+" !"),e("")},!1),i.addEventListener("load",function(){e(i.result)},!1),i.readAsText(_,"utf-8")}}function import_files_url_from_csv(_){return new Promise(function(e,i){""!==_&&void 0!==_||i();var t,a,n=0,r=new RegExp("\n|\r|\r\n","g"),s=_.split(r),o=s.length,g="";for(t=0;t<o;++t)"\n"!==s[t].charAt(0)&&""!==s[t].charAt(0)?(a=project_file_add_url(s[t]),""===g&&(g=a),n+=1):1;(show_message("Added "+n+" files to project"),n)&&(_via_show_img(_via_image_id_list.indexOf(g)),update_img_fn_list())})}function pack_via_metadata(_){return new Promise(function(e,i){if("csv"===_){var t=[];for(var a in t.push("filename,file_size,file_attributes,region_count,region_id,region_shape_attributes,region_attributes"),_via_img_metadata){var n=map_to_json(_via_img_metadata[a].file_attributes);n=escape_for_csv(n);var r="\n"+_via_img_metadata[a].filename;r+=","+_via_img_metadata[a].size,r+=',"'+n+'"';var s=_via_img_metadata[a].regions;if(0!==s.length)for(var o=0;o<s.length;++o){var g=[];g.push(r),g.push(s.length),g.push(o);var l=map_to_json(s[o].shape_attributes);l='"'+escape_for_csv(l)+'"',g.push(l);var d=map_to_json(s[o].region_attributes);d='"'+escape_for_csv(d)+'"',g.push(d),t.push(g.join(VIA_CSV_SEP))}else t.push(r+',0,0,"{}","{}"')}e(t)}"coco"===_?img_stat_set_all().then(function(_){var i=export_project_to_coco_format();e([i])}.bind(this),function(_){i(_)}.bind(this)):e([JSON.stringify(_via_img_metadata)])}.bind(this))}function export_project_to_coco_format(){var _={info:{},images:[],annotations:[],licenses:[],categories:[]};_.info={year:(new Date).getFullYear(),version:"1.0",description:"VIA project exported to COCO format using VGG Image Annotator (http://www.robots.ox.ac.uk/~vgg/software/via/)",contributor:"",url:"http://www.robots.ox.ac.uk/~vgg/software/via/",date_created:(new Date).toString()},_.licenses=[{id:0,name:"Unknown License",url:""}];var e=0,i=!1;for(var t in _via_img_metadata)if(Number.isNaN(parseInt(t))){i=!0;break}if(i){var a=[];for(var n in _via_attributes)if(VIA_COCO_EXPORT_ATTRIBUTE_TYPE.includes(_via_attributes[n].type))for(var r in _via_attributes[n].options){if(a.includes(r)||Number.isNaN(parseInt(r))){i=!0;break}a.push(i)}}var s={},o=1;for(var n in _via_attributes.region)if(VIA_COCO_EXPORT_ATTRIBUTE_TYPE.includes(_via_attributes.region[n].type))for(var r in _via_attributes.region[n].options){var g;i?(g=o,o+=1):g=parseInt(r),_.categories.push({supercategory:n,id:g,name:_via_attributes.region[n].options[r]}),s[r]=g}var l=1,d=1;for(var v in _via_image_id_list){t=_via_image_id_list[v];var c,u=_via_settings.core.default_filepath+_via_img_metadata[t].filename;for(var m in _via_img_fileref[t]instanceof File&&(u=_via_img_fileref[t].filename),i?(c=d,d+=1):c=parseInt(t),_.images.push({id:c,width:_via_img_stat[v][0],height:_via_img_stat[v][1],file_name:_via_img_metadata[t].filename,license:0,flickr_url:u,coco_url:u,date_captured:""}),_via_img_metadata[t].regions){var p=_via_img_metadata[t].regions[m];if(VIA_COCO_EXPORT_RSHAPE.includes(p.shape_attributes.name)){var h=via_region_shape_to_coco_annotation(p.shape_attributes);h.id=l,h.image_id=c;Object.keys(p.region_attributes);for(var f in p.region_attributes){var b=p.region_attributes[f];s.hasOwnProperty(b)?(h.category_id=s[b],_.annotations.push(h),l+=1):e+=1}}else e+=1}}return show_message("Skipped "+e+" annotations. COCO format only supports the following attribute types: "+JSON.stringify(VIA_COCO_EXPORT_ATTRIBUTE_TYPE)+" and region shapes: "+JSON.stringify(VIA_COCO_EXPORT_RSHAPE)),[JSON.stringify(_)]}function via_region_shape_to_coco_annotation(_){var e={segmentation:[[]],area:[],bbox:[],iscrowd:0};switch(_.name){case"rect":var i=_.x,t=_.y,a=i+(h=parseInt(_.width)),n=t+(f=parseInt(_.height));e.segmentation[0]=[i,t,a,t,a,n,i,n],e.area=h*f,e.bbox=[i,t,h,f];break;case"point":var r=_.cx,s=_.cy;e.keypoints=[r,s,2],e.num_keypoints=1;break;case"circle":c=_.r,u=_.r;for(var o=Math.PI/180,g=0;g<360;g+=VIA_POLYGON_SEGMENT_SUBTENDED_ANGLE){var l=g*o,d=_.cx+c*Math.cos(l),v=_.cy+u*Math.sin(l);e.segmentation[0].push(fixfloat(d),fixfloat(v))}e.bbox=polygon_to_bbox(e.segmentation[0]),e.area=e.bbox[2]*e.bbox[3];break;case"ellipse":var c,u;c=_.rx,u=_.ry;var m=0;_.hasOwnProperty("theta")&&(m=_.theta);for(o=Math.PI/180,g=0;g<360;g+=VIA_POLYGON_SEGMENT_SUBTENDED_ANGLE){l=g*o,d=_.cx+c*Math.cos(l)*Math.cos(m)-u*Math.sin(l)*Math.sin(m),v=_.cy+c*Math.cos(l)*Math.sin(m)+u*Math.sin(l)*Math.cos(m);e.segmentation[0].push(fixfloat(d),fixfloat(v))}e.bbox=polygon_to_bbox(e.segmentation[0]),e.area=e.bbox[2]*e.bbox[3];break;case"polygon":e.segmentation[0]=[];i=1/0,t=1/0,a=-1/0,n=-1/0;for(var p in _.all_points_x)e.segmentation[0].push(_.all_points_x[p]),e.segmentation[0].push(_.all_points_y[p]),_.all_points_x[p]<i&&(i=_.all_points_x[p]),_.all_points_y[p]<t&&(t=_.all_points_y[p]),_.all_points_x[p]>a&&(a=_.all_points_x[p]),_.all_points_y[p]>n&&(n=_.all_points_y[p]);var h=a-i,f=n-t;e.bbox=[i,t,h,f],e.area=h*f}return e}function save_data_to_local_file(_,e){var i=document.createElement("a");i.href=URL.createObjectURL(_),i.download=e;var t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});i.dispatchEvent(t)}function init_message_panel(){var _=document.getElementById("message_panel");_.addEventListener("mousedown",function(){this.style.display="none"},!1),_.addEventListener("mouseover",function(){clearTimeout(_via_message_clear_timer)},!1)}function show_message(_,e){_via_message_clear_timer&&clearTimeout(_via_message_clear_timer);var i=e;void 0===e&&(i=VIA_THEME_MESSAGE_TIMEOUT_MS),document.getElementById("message_panel_content").innerHTML=_,document.getElementById("message_panel").style.display="block",_via_message_clear_timer=setTimeout(function(){document.getElementById("message_panel").style.display="none"},i)}function _via_regions_group_color_init(){_via_canvas_regions_group_color={};var _=_via_settings.ui.image.region_color;if("__via_default_region_color__"!==_){for(var e,i=0;i<_via_img_metadata[_via_image_id].regions.length;++i)e=_via_img_metadata[_via_image_id].regions[i].region_attributes[_],_via_canvas_regions_group_color[e]=1;var t=0;for(e in _via_canvas_regions_group_color)_via_canvas_regions_group_color[e]=VIA_REGION_COLOR_LIST[t%VIA_REGION_COLOR_LIST.length],t+=1}}function _via_load_canvas_regions(){_via_regions_group_color_init();var _=_via_img_metadata[_via_image_id].regions;_via_canvas_regions=[];for(var e=0;e<_.length;++e){var i=new file_region;for(var t in _[e].shape_attributes)i.shape_attributes[t]=_[e].shape_attributes[t];switch(_via_canvas_regions.push(i),_via_canvas_regions[e].shape_attributes.name){case VIA_REGION_SHAPE.RECT:var a=_[e].shape_attributes.x/_via_canvas_scale,n=_[e].shape_attributes.y/_via_canvas_scale,r=_[e].shape_attributes.width/_via_canvas_scale,s=_[e].shape_attributes.height/_via_canvas_scale;_via_canvas_regions[e].shape_attributes.x=Math.round(a),_via_canvas_regions[e].shape_attributes.y=Math.round(n),_via_canvas_regions[e].shape_attributes.width=Math.round(r),_via_canvas_regions[e].shape_attributes.height=Math.round(s);break;case VIA_REGION_SHAPE.CIRCLE:var o=_[e].shape_attributes.cx/_via_canvas_scale,g=_[e].shape_attributes.cy/_via_canvas_scale,l=_[e].shape_attributes.r/_via_canvas_scale;_via_canvas_regions[e].shape_attributes.cx=Math.round(o),_via_canvas_regions[e].shape_attributes.cy=Math.round(g),_via_canvas_regions[e].shape_attributes.r=Math.round(l);break;case VIA_REGION_SHAPE.ELLIPSE:o=_[e].shape_attributes.cx/_via_canvas_scale,g=_[e].shape_attributes.cy/_via_canvas_scale;var d=_[e].shape_attributes.rx/_via_canvas_scale,v=_[e].shape_attributes.ry/_via_canvas_scale,c=_[e].shape_attributes.theta;_via_canvas_regions[e].shape_attributes.cx=Math.round(o),_via_canvas_regions[e].shape_attributes.cy=Math.round(g),_via_canvas_regions[e].shape_attributes.rx=Math.round(d),_via_canvas_regions[e].shape_attributes.ry=Math.round(v),_via_canvas_regions[e].shape_attributes.theta=c;break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:for(var u=_[e].shape_attributes.all_points_x.slice(0),m=_[e].shape_attributes.all_points_y.slice(0),p=0;p<u.length;++p)u[p]=Math.round(u[p]/_via_canvas_scale),m[p]=Math.round(m[p]/_via_canvas_scale);_via_canvas_regions[e].shape_attributes.all_points_x=u,_via_canvas_regions[e].shape_attributes.all_points_y=m;break;case VIA_REGION_SHAPE.POINT:o=_[e].shape_attributes.cx/_via_canvas_scale,g=_[e].shape_attributes.cy/_via_canvas_scale;_via_canvas_regions[e].shape_attributes.cx=Math.round(o),_via_canvas_regions[e].shape_attributes.cy=Math.round(g)}}}function select_region_shape(_){for(var e in VIA_REGION_SHAPE){document.getElementById("region_shape_"+VIA_REGION_SHAPE[e]).classList.remove("selected")}switch(_via_current_shape=_,document.getElementById("region_shape_"+_via_current_shape).classList.add("selected"),_via_current_shape){case VIA_REGION_SHAPE.RECT:case VIA_REGION_SHAPE.CIRCLE:case VIA_REGION_SHAPE.ELLIPSE:show_message("Press single click and drag mouse to draw "+_via_current_shape+" region");break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:_via_is_user_drawing_polygon=!1,_via_current_polygon_region_id=-1,show_message("[Single Click] to define polygon/polyline vertices, [Backspace] to delete last vertex, [Enter] to finish, [Esc] to cancel drawing.");break;case VIA_REGION_SHAPE.POINT:show_message("Press single click to define points (or landmarks)");break;default:show_message("Unknown shape selected!")}}function set_all_canvas_size(_,e){_via_reg_canvas.height=e,_via_reg_canvas.width=_,image_panel.style.height=e+"px",image_panel.style.width=_+"px"}function set_all_canvas_scale(_){_via_reg_ctx.scale(_,_)}function show_all_canvas(){image_panel.style.display="inline-block"}function hide_all_canvas(){image_panel.style.display="none"}function jump_to_image(_){if(!(_via_img_count<=0))switch(_via_display_area_content_name){case VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID:_>=0&&_<_via_img_count&&(show_single_image_view(),_via_show_img(_));break;default:_>=0&&_<_via_img_count&&_via_show_img(_)}}function count_missing_region_attr(_){for(var e=0,i=Object.keys(_via_region_attributes).length,t=0;t<_via_img_metadata[_].regions.length;++t){e+=i-Object.keys(_via_img_metadata[_].regions[t].region_attributes).length}return e}function count_missing_file_attr(_){return Object.keys(_via_file_attributes).length-Object.keys(_via_img_metadata[_].file_attributes).length}function toggle_all_regions_selection(_){var e,i=_via_img_metadata[_via_image_id].regions.length;for(_via_region_selected_flag=[],e=0;e<i;++e)_via_region_selected_flag[e]=_;_via_is_all_region_selected=_,annotation_editor_hide(),_via_annotation_editor_mode===VIA_ANNOTATION_EDITOR_MODE.ALL_REGIONS&&annotation_editor_clear_row_highlight()}function select_only_region(_){toggle_all_regions_selection(!1),set_region_select_state(_,!0),_via_is_region_selected=!0,_via_is_all_region_selected=!1,_via_user_sel_region_id=_}function set_region_select_state(_,e){_via_region_selected_flag[_]=e}function show_annotation_data(){pack_via_metadata("csv").then(function(_){var e="<pre>"+_.join("")+"</pre>";window.open("","Annotations (preview) ","toolbar=no,menubar=no,location=no,resizable=yes,scrollbars=yes,status=no,width=800,height=600").document.body.innerHTML=e}.bind(this),function(_){show_message("Failed to collect annotation data!")}.bind(this))}function _via_reg_canvas_dblclick_handler(_){_.stopPropagation()}function _via_reg_canvas_mousedown_handler(_){_.stopPropagation(),_via_click_x0=_.offsetX,_via_click_y0=_.offsetY,_via_region_edge=is_on_region_corner(_via_click_x0,_via_click_y0);var e=is_inside_region(_via_click_x0,_via_click_y0);_via_is_region_selected?_via_region_edge[1]>0?_via_is_user_resizing_region||(_via_region_edge[0]!==_via_user_sel_region_id&&(_via_user_sel_region_id=_via_region_edge[0]),_via_is_user_resizing_region=!0):(is_inside_this_region(_via_click_x0,_via_click_y0,_via_user_sel_region_id)&&(_via_is_user_moving_region||(_via_is_user_moving_region=!0,_via_region_click_x=_via_click_x0,_via_region_click_y=_via_click_y0)),-1===e&&(_via_is_user_drawing_region=!0,_via_is_region_selected=!1,_via_user_sel_region_id=-1,toggle_all_regions_selection(!1))):-1===e?_via_current_shape!==VIA_REGION_SHAPE.POLYGON&&_via_current_shape!==VIA_REGION_SHAPE.POLYLINE&&_via_current_shape!==VIA_REGION_SHAPE.POINT&&(_via_is_user_drawing_region=!0):_via_is_user_drawing_region=!0}function _via_reg_canvas_mouseup_handler(_){_.stopPropagation(),_via_click_x1=_.offsetX,_via_click_y1=_.offsetY;var e=Math.abs(_via_click_x1-_via_click_x0),i=Math.abs(_via_click_y1-_via_click_y0);if(_via_is_user_moving_region){_via_is_user_moving_region=!1,_via_reg_canvas.style.cursor="default";var t=Math.round(_via_click_x1-_via_region_click_x),a=Math.round(_via_click_y1-_via_region_click_y);if(Math.abs(t)>VIA_MOUSE_CLICK_TOL||Math.abs(a)>VIA_MOUSE_CLICK_TOL)_via_move_selected_regions(t,a);else{var n=is_inside_region(_via_click_x0,_via_click_y0,!0);if(n>=0&&n!==_via_user_sel_region_id)_via_user_sel_region_id=n,_via_is_region_selected=!0,_via_is_user_moving_region=!1,_.shiftKey||toggle_all_regions_selection(!1),set_region_select_state(n,!0),annotation_editor_show();else{switch(toggle_all_regions_selection(!1),_via_is_region_selected=!1,_via_current_shape){case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:_via_is_user_drawing_polygon=!0,(D=new file_region).shape_attributes.name=_via_current_shape,D.shape_attributes.all_points_x=[Math.round(_via_click_x0)],D.shape_attributes.all_points_y=[Math.round(_via_click_y0)];var r=_via_canvas_regions.push(D);_via_current_polygon_region_id=r-1;break;case VIA_REGION_SHAPE.POINT:(H=new file_region).shape_attributes.name=VIA_REGION_SHAPE.POINT,H.shape_attributes.cx=Math.round(_via_click_x0*_via_canvas_scale),H.shape_attributes.cy=Math.round(_via_click_y0*_via_canvas_scale),_via_img_metadata[_via_image_id].regions.push(H),(C=new file_region).shape_attributes.name=VIA_REGION_SHAPE.POINT,C.shape_attributes.cx=Math.round(_via_click_x0),C.shape_attributes.cy=Math.round(_via_click_y0),_via_canvas_regions.push(C)}annotation_editor_update_content()}}return _via_redraw_reg_canvas(),void _via_reg_canvas.focus()}if(_via_is_user_resizing_region){_via_is_user_resizing_region=!1,_via_reg_canvas.style.cursor="default";var s=_via_region_edge[0],o=_via_img_metadata[_via_image_id].regions[s].shape_attributes;switch((G=_via_canvas_regions[s].shape_attributes).name){case VIA_REGION_SHAPE.RECT:var g=[G.x,G.y,0,0];g[2]=g[0]+G.width,g[3]=g[1]+G.height;var l=_via_current_x,d=_via_current_y,v=!1;_via_is_ctrl_pressed&&(v=!0),rect_update_corner(_via_region_edge[1],g,l,d,v),rect_standardize_coordinates(g);var c=Math.abs(g[2]-g[0]),u=Math.abs(g[3]-g[1]);o.x=Math.round(g[0]*_via_canvas_scale),o.y=Math.round(g[1]*_via_canvas_scale),o.width=Math.round(c*_via_canvas_scale),o.height=Math.round(u*_via_canvas_scale),G.x=Math.round(o.x/_via_canvas_scale),G.y=Math.round(o.y/_via_canvas_scale),G.width=Math.round(o.width/_via_canvas_scale),G.height=Math.round(o.height/_via_canvas_scale);break;case VIA_REGION_SHAPE.CIRCLE:var m=Math.abs(G.cx-_via_current_x),p=Math.abs(G.cy-_via_current_y),h=Math.sqrt(m*m+p*p);o.r=fixfloat(h*_via_canvas_scale),G.r=Math.round(o.r/_via_canvas_scale);break;case VIA_REGION_SHAPE.ELLIPSE:var f=G.rx,b=G.ry,E=G.theta;m=Math.abs(G.cx-_via_current_x),p=Math.abs(G.cy-_via_current_y);switch(_via_region_edge[1]){case 5:b=Math.sqrt(m*m+p*p),E=Math.atan2(-(_via_current_x-G.cx),_via_current_y-G.cy);break;case 6:f=Math.sqrt(m*m+p*p),E=Math.atan2(_via_current_y-G.cy,_via_current_x-G.cx);break;default:f=m,b=p,E=0}o.rx=fixfloat(f*_via_canvas_scale),o.ry=fixfloat(b*_via_canvas_scale),o.theta=fixfloat(E),G.rx=Math.round(o.rx/_via_canvas_scale),G.ry=Math.round(o.ry/_via_canvas_scale),G.theta=fixfloat(E);break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:var I=_via_region_edge[1]-VIA_POLYGON_RESIZE_VERTEX_OFFSET;if(_.ctrlKey){var A=(e_=_via_canvas_regions[_via_user_sel_region_id].shape_attributes).name;if(is_on_polygon_vertex(e_.all_points_x,e_.all_points_y,_via_current_x,_via_current_y)===_via_region_edge[1])_via_polygon_del_vertex(s,I)&&show_message("Deleted vertex "+I+" from region");else{var y=is_on_polygon_edge(e_.all_points_x,e_.all_points_y,_via_current_x,_via_current_y);if(y===_via_region_edge[1]){var O=y-VIA_POLYGON_RESIZE_VERTEX_OFFSET,w=Math.round(_via_click_x1),x=Math.round(_via_click_y1),N=Math.round(w*_via_canvas_scale),T=Math.round(x*_via_canvas_scale);w=Math.round(N/_via_canvas_scale),x=Math.round(T/_via_canvas_scale),_via_canvas_regions[s].shape_attributes.all_points_x.splice(O+1,0,w),_via_canvas_regions[s].shape_attributes.all_points_y.splice(O+1,0,x),_via_img_metadata[_via_image_id].regions[s].shape_attributes.all_points_x.splice(O+1,0,N),_via_img_metadata[_via_image_id].regions[s].shape_attributes.all_points_y.splice(O+1,0,T),show_message("Added 1 new vertex to "+A+" region")}}}else{var R=Math.round(_via_current_x*_via_canvas_scale),L=Math.round(_via_current_y*_via_canvas_scale);o.all_points_x[I]=R,o.all_points_y[I]=L,G.all_points_x[I]=Math.round(R/_via_canvas_scale),G.all_points_y[I]=Math.round(L/_via_canvas_scale)}}return _via_redraw_reg_canvas(),void _via_reg_canvas.focus()}if(e<VIA_MOUSE_CLICK_TOL||i<VIA_MOUSE_CLICK_TOL){if(_via_is_user_drawing_polygon){w=Math.round(_via_click_x1),x=Math.round(_via_click_y1);var M=_via_canvas_regions[_via_current_polygon_region_id].shape_attributes.all_points_x.length,P=_via_canvas_regions[_via_current_polygon_region_id].shape_attributes.all_points_x[M-1],k=_via_canvas_regions[_via_current_polygon_region_id].shape_attributes.all_points_y[M-1];w===P&&x===k||(_via_canvas_regions[_via_current_polygon_region_id].shape_attributes.all_points_x.push(w),_via_canvas_regions[_via_current_polygon_region_id].shape_attributes.all_points_y.push(x))}else{if((s=is_inside_region(_via_click_x0,_via_click_y0))>=0){var G;if(_via_user_sel_region_id=s,_via_is_region_selected=!0,_via_is_user_moving_region=!1,_via_is_user_drawing_region=!1,_.shiftKey||(annotation_editor_clear_row_highlight(),toggle_all_regions_selection(!1)),set_region_select_state(s,!0),_.shiftKey?annotation_editor_hide():annotation_editor_show(),_via_is_region_info_visible)switch((G=_via_canvas_regions[s].shape_attributes).name){case VIA_REGION_SHAPE.RECT:break;case VIA_REGION_SHAPE.CIRCLE:var V=document.getElementById("region_info"),S=_via_canvas_regions[_via_user_sel_region_id].shape_attributes;V.innerHTML+=", Radius:"+S.r;break;case VIA_REGION_SHAPE.ELLIPSE:V=document.getElementById("region_info"),S=_via_canvas_regions[_via_user_sel_region_id].shape_attributes;V.innerHTML+=", X-radius:"+S.rx+", Y-radius:"+S.ry;break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:}show_message("Region selected. If you intended to draw a region, click again inside the selected region to start drawing a region.")}else if(_via_is_user_drawing_region)_via_is_user_drawing_region=!1,_via_is_region_selected=!1,toggle_all_regions_selection(!1),annotation_editor_hide();else switch(_via_current_shape){case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:var D;_via_is_user_drawing_polygon=!0,(D=new file_region).shape_attributes.name=_via_current_shape,D.shape_attributes.all_points_x=[Math.round(_via_click_x0)],D.shape_attributes.all_points_y=[Math.round(_via_click_y0)];r=_via_canvas_regions.push(D);_via_current_polygon_region_id=r-1;break;case VIA_REGION_SHAPE.POINT:var H,C;(H=new file_region).shape_attributes.name=VIA_REGION_SHAPE.POINT,H.shape_attributes.cx=Math.round(_via_click_x0*_via_canvas_scale),H.shape_attributes.cy=Math.round(_via_click_y0*_via_canvas_scale),_via_img_metadata[_via_image_id].regions.push(H),(C=new file_region).shape_attributes.name=VIA_REGION_SHAPE.POINT,C.shape_attributes.cx=Math.round(_via_click_x0),C.shape_attributes.cy=Math.round(_via_click_y0),_via_canvas_regions.push(C),annotation_editor_update_content()}}return _via_redraw_reg_canvas(),void _via_reg_canvas.focus()}if(_via_is_user_drawing_region){_via_is_user_drawing_region=!1;var B=_via_click_x0,j=_via_click_y0,Y=_via_click_x1,z=_via_click_y1,U=new file_region,F=new file_region,W=Math.abs(Y-B),X=Math.abs(z-j),q=!1;if(W>VIA_REGION_MIN_DIM&&X>VIA_REGION_MIN_DIM){switch(_via_current_shape){case VIA_REGION_SHAPE.RECT:_via_click_x0<_via_click_x1?(B=_via_click_x0,Y=_via_click_x1):(B=_via_click_x1,Y=_via_click_x0),_via_click_y0<_via_click_y1?(j=_via_click_y0,z=_via_click_y1):(j=_via_click_y1,z=_via_click_y0);var J=Math.round(B*_via_canvas_scale),Z=Math.round(j*_via_canvas_scale),K=Math.round(W*_via_canvas_scale),Q=Math.round(X*_via_canvas_scale);U.shape_attributes.name="rect",U.shape_attributes.x=J,U.shape_attributes.y=Z,U.shape_attributes.width=K,U.shape_attributes.height=Q,F.shape_attributes.name="rect",F.shape_attributes.x=Math.round(J/_via_canvas_scale),F.shape_attributes.y=Math.round(Z/_via_canvas_scale),F.shape_attributes.width=Math.round(K/_via_canvas_scale),F.shape_attributes.height=Math.round(Q/_via_canvas_scale),q=!0;break;case VIA_REGION_SHAPE.CIRCLE:var $=Math.round(B*_via_canvas_scale),__=Math.round(j*_via_canvas_scale),e_=Math.round(Math.sqrt(W*W+X*X)*_via_canvas_scale);U.shape_attributes.name="circle",U.shape_attributes.cx=$,U.shape_attributes.cy=__,U.shape_attributes.r=e_,F.shape_attributes.name="circle",F.shape_attributes.cx=Math.round($/_via_canvas_scale),F.shape_attributes.cy=Math.round(__/_via_canvas_scale),F.shape_attributes.r=Math.round(e_/_via_canvas_scale),q=!0;break;case VIA_REGION_SHAPE.ELLIPSE:$=Math.round(B*_via_canvas_scale),__=Math.round(j*_via_canvas_scale);var i_=Math.round(W*_via_canvas_scale),t_=Math.round(X*_via_canvas_scale);U.shape_attributes.name="ellipse",U.shape_attributes.cx=$,U.shape_attributes.cy=__,U.shape_attributes.rx=i_,U.shape_attributes.ry=t_,U.shape_attributes.theta=0,F.shape_attributes.name="ellipse",F.shape_attributes.cx=Math.round($/_via_canvas_scale),F.shape_attributes.cy=Math.round(__/_via_canvas_scale),F.shape_attributes.rx=Math.round(i_/_via_canvas_scale),F.shape_attributes.ry=Math.round(t_/_via_canvas_scale),F.shape_attributes.theta=0,q=!0;break;case VIA_REGION_SHAPE.POINT:case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:}if(q){var a_=_via_img_metadata[_via_image_id].regions.push(U),n_=_via_canvas_regions.push(F);a_!==n_&&console.log("_via_img_metadata.regions["+a_+"] and _via_canvas_regions["+n_+"] count mismatch");var r_=a_-1;set_region_annotations_to_default_value(r_),select_only_region(r_),_via_annotation_editor_mode===VIA_ANNOTATION_EDITOR_MODE.ALL_REGIONS&&"region"===_via_metadata_being_updated&&(annotation_editor_add_row(r_),annotation_editor_scroll_to_row(r_),annotation_editor_clear_row_highlight(),annotation_editor_highlight_row(r_)),annotation_editor_show()}_via_redraw_reg_canvas(),_via_reg_canvas.focus()}else show_message("Prevented accidental addition of a very small region.")}else;}function _via_reg_canvas_mouseover_handler(_){_via_redraw_reg_canvas(),_via_reg_canvas.focus()}function _via_reg_canvas_mousemove_handler(_){if(_via_current_image_loaded){if(_via_current_x=_.offsetX,_via_current_y=_.offsetY,null!=(t=document.getElementById("region_info"))&&_via_is_region_info_visible){var e=Math.round(_via_current_x*_via_canvas_scale),i=Math.round(_via_current_y*_via_canvas_scale);t.innerHTML="X:"+e+", Y:"+i}if(_via_is_region_selected){if(null!=t&&_via_is_region_info_visible&&-1!==_via_user_sel_region_id)switch(_via_canvas_regions[_via_user_sel_region_id].shape_attributes.name){case VIA_REGION_SHAPE.RECT:break;case VIA_REGION_SHAPE.CIRCLE:var t=document.getElementById("region_info"),a=_via_canvas_regions[_via_user_sel_region_id].shape_attributes;t.innerHTML+=", Radius:"+a.r;break;case VIA_REGION_SHAPE.ELLIPSE:t=document.getElementById("region_info"),a=_via_canvas_regions[_via_user_sel_region_id].shape_attributes;t.innerHTML+=", X-radius:"+a.rx+", Y-radius:"+a.ry;break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:}if(_via_is_user_resizing_region)annotation_editor_hide();else if((_via_region_edge=is_on_region_corner(_via_current_x,_via_current_y))[0]===_via_user_sel_region_id){switch(_via_region_edge[1]){case 1:case 3:_via_reg_canvas.style.cursor="nwse-resize";break;case 2:case 4:_via_reg_canvas.style.cursor="nesw-resize";break;case 5:case 7:_via_reg_canvas.style.cursor="ns-resize";break;case 6:case 8:_via_reg_canvas.style.cursor="ew-resize";break;case 5:_via_reg_canvas.style.cursor="n-resize";break;case 6:_via_reg_canvas.style.cursor="e-resize";break;default:_via_reg_canvas.style.cursor="default"}_via_region_edge[1]>=VIA_POLYGON_RESIZE_VERTEX_OFFSET&&(_via_reg_canvas.style.cursor="crosshair",show_message("To move vertex, simply drag the vertex. To add vertex, press [Ctrl] key and click on the edge. To delete vertex, press [Ctrl] key and click on vertex."))}else{var n=is_inside_this_region(_via_current_x,_via_current_y,_via_user_sel_region_id);_via_reg_canvas.style.cursor=n?"move":"default"}}if(_via_is_user_drawing_region){_via_canvas_regions.length?_via_redraw_reg_canvas():_via_reg_ctx.clearRect(0,0,_via_reg_canvas.width,_via_reg_canvas.height);var r=_via_click_x0,s=_via_click_y0,o=Math.round(Math.abs(_via_current_x-_via_click_x0)),g=Math.round(Math.abs(_via_current_y-_via_click_y0));switch(_via_reg_ctx.strokeStyle=VIA_THEME_BOUNDARY_FILL_COLOR,_via_current_shape){case VIA_REGION_SHAPE.RECT:_via_click_x0<_via_current_x?_via_click_y0<_via_current_y?(r=_via_click_x0,s=_via_click_y0):(r=_via_click_x0,s=_via_current_y):_via_click_y0<_via_current_y?(r=_via_current_x,s=_via_click_y0):(r=_via_current_x,s=_via_current_y),_via_draw_rect_region(r,s,o,g,!1),null!=t&&_via_is_region_info_visible&&(t.innerHTML+=", W:"+o+", H:"+g);break;case VIA_REGION_SHAPE.CIRCLE:var l=Math.round(Math.sqrt(o*o+g*g));_via_draw_circle_region(r,s,l,!1),null!=t&&_via_is_region_info_visible&&(t.innerHTML+=", Radius:"+l);break;case VIA_REGION_SHAPE.ELLIPSE:_via_draw_ellipse_region(r,s,o,g,0,!1),null!=t&&_via_is_region_info_visible&&(t.innerHTML+=", X-radius:"+fixfloat(o)+", Y-radius:"+fixfloat(g));break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:}_via_reg_canvas.focus()}if(_via_is_user_resizing_region){_via_canvas_regions.length?_via_redraw_reg_canvas():_via_reg_ctx.clearRect(0,0,_via_reg_canvas.width,_via_reg_canvas.height);var d=_via_region_edge[0];switch((a=_via_canvas_regions[d].shape_attributes).name){case VIA_REGION_SHAPE.RECT:var v=[a.x,a.y,0,0];v[2]=v[0]+a.width,v[3]=v[1]+a.height;var c=_via_current_x,u=_via_current_y,m=!1;_via_is_ctrl_pressed&&(m=!0),rect_update_corner(_via_region_edge[1],v,c,u,m),rect_standardize_coordinates(v);var p=Math.abs(v[2]-v[0]),h=Math.abs(v[3]-v[1]);_via_draw_rect_region(v[0],v[1],p,h,!0),null!=t&&_via_is_region_info_visible&&(t.innerHTML+=", W:"+p+", H:"+h);break;case VIA_REGION_SHAPE.CIRCLE:o=Math.abs(a.cx-_via_current_x),g=Math.abs(a.cy-_via_current_y);var f=Math.sqrt(o*o+g*g);if(_via_draw_circle_region(a.cx,a.cy,f,!0),null!=t&&_via_is_region_info_visible){var b=t.innerHTML.split(",");t.innerHTML="",t.innerHTML+=b[0]+","+b[1]+", Radius:"+Math.round(f)}break;case VIA_REGION_SHAPE.ELLIPSE:var E=a.rx,I=a.ry,A=a.theta;o=Math.abs(a.cx-_via_current_x),g=Math.abs(a.cy-_via_current_y);switch(_via_region_edge[1]){case 5:I=Math.sqrt(o*o+g*g),A=Math.atan2(-(_via_current_x-a.cx),_via_current_y-a.cy);break;case 6:E=Math.sqrt(o*o+g*g),A=Math.atan2(_via_current_y-a.cy,_via_current_x-a.cx);break;default:E=o,I=g,A=0}if(_via_draw_ellipse_region(a.cx,a.cy,E,I,A,!0),null!=t&&_via_is_region_info_visible){b=t.innerHTML.split(",");t.innerHTML="",t.innerHTML=b[0]+","+b[1]+", X-radius:"+fixfloat(E)+", Y-radius:"+fixfloat(I)}break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:var y=a.all_points_x.slice(0),O=a.all_points_y.slice(0),w=_via_region_edge[1]-VIA_POLYGON_RESIZE_VERTEX_OFFSET;y[w]=_via_current_x,O[w]=_via_current_y,_via_draw_polygon_region(y,O,!0,a.name),null!=t&&_via_is_region_info_visible&&(t.innerHTML+=", Vertices:"+a.all_points_x.length)}_via_reg_canvas.focus()}if(_via_is_user_moving_region){_via_canvas_regions.length?_via_redraw_reg_canvas():_via_reg_ctx.clearRect(0,0,_via_reg_canvas.width,_via_reg_canvas.height);var x=_via_current_x-_via_region_click_x,N=_via_current_y-_via_region_click_y;switch((a=_via_canvas_regions[_via_user_sel_region_id].shape_attributes).name){case VIA_REGION_SHAPE.RECT:_via_draw_rect_region(a.x+x,a.y+N,a.width,a.height,!0),null!=t&&_via_is_region_info_visible&&(t.innerHTML+=", W:"+a.width+", H:"+a.height);break;case VIA_REGION_SHAPE.CIRCLE:_via_draw_circle_region(a.cx+x,a.cy+N,a.r,!0);break;case VIA_REGION_SHAPE.ELLIPSE:void 0===a.theta&&(a.theta=0),_via_draw_ellipse_region(a.cx+x,a.cy+N,a.rx,a.ry,a.theta,!0);break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:y=a.all_points_x.slice(0),O=a.all_points_y.slice(0);for(var T=0;T<y.length;++T)y[T]+=x,O[T]+=N;_via_draw_polygon_region(y,O,!0,a.name),null!=t&&_via_is_region_info_visible&&(t.innerHTML+=", Vertices:"+a.all_points_x.length);break;case VIA_REGION_SHAPE.POINT:_via_draw_point_region(a.cx+x,a.cy+N,!0)}return _via_reg_canvas.focus(),void annotation_editor_hide()}if(_via_is_user_drawing_polygon){_via_redraw_reg_canvas();var R=(a=_via_canvas_regions[_via_current_polygon_region_id].shape_attributes).all_points_x,L=a.all_points_y,M=R.length;if(M>0)_via_draw_polygon_region([R.slice(M-1),_via_current_x],[L.slice(M-1),_via_current_y],!1,a.name);null!=t&&_via_is_region_info_visible&&(t.innerHTML+=", Vertices:"+M)}}}function _via_move_selected_regions(_,e){var i,t;for(t=_via_region_selected_flag.length,i=0;i<t;++i)_via_region_selected_flag[i]&&_via_move_region(i,_,e)}function _via_validate_move_region(_,e,i){switch(i.name){case VIA_REGION_SHAPE.RECT:if(_<0||e<0)return show_message("Region moved beyond image boundary. Resetting."),!1;if(e+i.height>_via_current_image_height||_+i.width>_via_current_image_width)return show_message("Region moved beyond image boundary. Resetting."),!1;case VIA_REGION_SHAPE.CIRCLE:case VIA_REGION_SHAPE.ELLIPSE:case VIA_REGION_SHAPE.POINT:case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:if(_<0||e<0||_>_via_current_image_width||e>_via_current_image_height)return show_message("Region moved beyond image boundary. Resetting."),!1}return!0}function _via_move_region(_,e,i){var t=_via_img_metadata[_via_image_id].regions[_].shape_attributes,a=_via_canvas_regions[_].shape_attributes;switch(a.name){case VIA_REGION_SHAPE.RECT:var n=t.x+Math.round(e*_via_canvas_scale),r=t.y+Math.round(i*_via_canvas_scale);if(!_via_validate_move_region(n,r,t))break;t.x=n,t.y=r,a.x=Math.round(t.x/_via_canvas_scale),a.y=Math.round(t.y/_via_canvas_scale);break;case VIA_REGION_SHAPE.CIRCLE:case VIA_REGION_SHAPE.ELLIPSE:case VIA_REGION_SHAPE.POINT:var s=t.cx+Math.round(e*_via_canvas_scale),o=t.cy+Math.round(i*_via_canvas_scale);if(!_via_validate_move_region(s,o,t))break;t.cx=s,t.cy=o,a.cx=Math.round(t.cx/_via_canvas_scale),a.cy=Math.round(t.cy/_via_canvas_scale);break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:for(var g=t.all_points_x,l=t.all_points_y,d=a.all_points_x,v=a.all_points_y,c=Object.assign({},g),u=Object.assign({},l),m=0;m<g.length;++m){if(!_via_validate_move_region(g[m]+Math.round(e*_via_canvas_scale),l[m]+Math.round(i*_via_canvas_scale),t)){g=c,l=u;break}}for(m=0;m<g.length;++m)g[m]=g[m]+Math.round(e*_via_canvas_scale),l[m]=l[m]+Math.round(i*_via_canvas_scale);for(m=0;m<d.length;++m)d[m]=Math.round(g[m]/_via_canvas_scale),v[m]=Math.round(l[m]/_via_canvas_scale)}}function _via_polygon_del_vertex(_,e){var i=_via_canvas_regions[_].shape_attributes,t=i.all_points_x.length,a=i.name;return a!==VIA_REGION_SHAPE.POLYGON&&a!==VIA_REGION_SHAPE.POLYLINE?(show_message("Vertices can only be deleted from polygon/polyline."),!1):t<=3&&a===VIA_REGION_SHAPE.POLYGON?(show_message("Failed to delete vertex because a polygon must have at least 3 vertices."),!1):t<=2&&a===VIA_REGION_SHAPE.POLYLINE?(show_message("Failed to delete vertex because a polyline must have at least 2 vertices."),!1):(_via_canvas_regions[_].shape_attributes.all_points_x.splice(e,1),_via_canvas_regions[_].shape_attributes.all_points_y.splice(e,1),_via_img_metadata[_via_image_id].regions[_].shape_attributes.all_points_x.splice(e,1),_via_img_metadata[_via_image_id].regions[_].shape_attributes.all_points_y.splice(e,1),!0)}function _via_redraw_reg_canvas(){_via_current_image_loaded&&(_via_reg_ctx.clearRect(0,0,_via_reg_canvas.width,_via_reg_canvas.height),_via_canvas_regions.length>0&&(_via_is_region_boundary_visible&&draw_all_regions(),_via_is_region_id_visible&&draw_all_region_id()))}function _via_clear_reg_canvas(){_via_reg_ctx.clearRect(0,0,_via_reg_canvas.width,_via_reg_canvas.height)}function draw_all_regions(){for(var _,e,i,t=_via_settings.ui.image.region_color,a=0;a<_via_canvas_regions.length;++a)switch(_=_via_canvas_regions[a].shape_attributes,e=_via_region_selected_flag[a],_via_reg_ctx.strokeStyle=VIA_THEME_BOUNDARY_FILL_COLOR,_via_is_user_drawing_polygon||"__via_default_region_color__"===t||(i=_via_img_metadata[_via_image_id].regions[a].region_attributes[t],_via_canvas_regions_group_color.hasOwnProperty(i)&&(_via_reg_ctx.strokeStyle=_via_canvas_regions_group_color[i])),_.name){case VIA_REGION_SHAPE.RECT:_via_draw_rect_region(_.x,_.y,_.width,_.height,e);break;case VIA_REGION_SHAPE.CIRCLE:_via_draw_circle_region(_.cx,_.cy,_.r,e);break;case VIA_REGION_SHAPE.ELLIPSE:void 0===_.theta&&(_.theta=0),_via_draw_ellipse_region(_.cx,_.cy,_.rx,_.ry,_.theta,e);break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:_via_draw_polygon_region(_.all_points_x,_.all_points_y,e,_.name);break;case VIA_REGION_SHAPE.POINT:_via_draw_point_region(_.cx,_.cy,e)}}function _via_draw_control_point(_,e){_via_reg_ctx.beginPath(),_via_reg_ctx.arc(_,e,VIA_REGION_SHAPES_POINTS_RADIUS,0,2*Math.PI,!1),_via_reg_ctx.closePath(),_via_reg_ctx.fillStyle=VIA_THEME_CONTROL_POINT_COLOR,_via_reg_ctx.globalAlpha=1,_via_reg_ctx.fill()}function _via_draw_rect_region(_,e,i,t,a){a?(_via_draw_rect(_,e,i,t),_via_reg_ctx.strokeStyle=VIA_THEME_SEL_REGION_FILL_BOUNDARY_COLOR,_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/2,_via_reg_ctx.stroke(),_via_reg_ctx.fillStyle=VIA_THEME_SEL_REGION_FILL_COLOR,_via_reg_ctx.globalAlpha=VIA_THEME_SEL_REGION_OPACITY,_via_reg_ctx.fill(),_via_reg_ctx.globalAlpha=1,_via_draw_control_point(_,e),_via_draw_control_point(_+i,e+t),_via_draw_control_point(_,e+t),_via_draw_control_point(_+i,e),_via_draw_control_point(_+i/2,e),_via_draw_control_point(_+i/2,e+t),_via_draw_control_point(_,e+t/2),_via_draw_control_point(_+i,e+t/2)):(_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/2,_via_draw_rect(_,e,i,t),_via_reg_ctx.stroke(),i>VIA_THEME_REGION_BOUNDARY_WIDTH&&t>VIA_THEME_REGION_BOUNDARY_WIDTH&&(_via_reg_ctx.strokeStyle=VIA_THEME_BOUNDARY_LINE_COLOR,_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/4,_via_draw_rect(_-VIA_THEME_REGION_BOUNDARY_WIDTH/2,e-VIA_THEME_REGION_BOUNDARY_WIDTH/2,i+VIA_THEME_REGION_BOUNDARY_WIDTH,t+VIA_THEME_REGION_BOUNDARY_WIDTH),_via_reg_ctx.stroke(),_via_draw_rect(_+VIA_THEME_REGION_BOUNDARY_WIDTH/2,e+VIA_THEME_REGION_BOUNDARY_WIDTH/2,i-VIA_THEME_REGION_BOUNDARY_WIDTH,t-VIA_THEME_REGION_BOUNDARY_WIDTH),_via_reg_ctx.stroke()))}function _via_draw_rect(_,e,i,t){_via_reg_ctx.beginPath(),_via_reg_ctx.moveTo(_,e),_via_reg_ctx.lineTo(_+i,e),_via_reg_ctx.lineTo(_+i,e+t),_via_reg_ctx.lineTo(_,e+t),_via_reg_ctx.closePath()}function _via_draw_circle_region(_,e,i,t){t?(_via_draw_circle(_,e,i),_via_reg_ctx.strokeStyle=VIA_THEME_SEL_REGION_FILL_BOUNDARY_COLOR,_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/2,_via_reg_ctx.stroke(),_via_reg_ctx.fillStyle=VIA_THEME_SEL_REGION_FILL_COLOR,_via_reg_ctx.globalAlpha=VIA_THEME_SEL_REGION_OPACITY,_via_reg_ctx.fill(),_via_reg_ctx.globalAlpha=1,_via_draw_control_point(_+i,e)):(_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/2,_via_draw_circle(_,e,i),_via_reg_ctx.stroke(),i>VIA_THEME_REGION_BOUNDARY_WIDTH&&(_via_reg_ctx.strokeStyle=VIA_THEME_BOUNDARY_LINE_COLOR,_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/4,_via_draw_circle(_,e,i-VIA_THEME_REGION_BOUNDARY_WIDTH/2),_via_reg_ctx.stroke(),_via_draw_circle(_,e,i+VIA_THEME_REGION_BOUNDARY_WIDTH/2),_via_reg_ctx.stroke()))}function _via_draw_circle(_,e,i){_via_reg_ctx.beginPath(),_via_reg_ctx.arc(_,e,i,0,2*Math.PI,!1),_via_reg_ctx.closePath()}function _via_draw_ellipse_region(_,e,i,t,a,n){n?(_via_draw_ellipse(_,e,i,t,a),_via_reg_ctx.strokeStyle=VIA_THEME_SEL_REGION_FILL_BOUNDARY_COLOR,_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/2,_via_reg_ctx.stroke(),_via_reg_ctx.fillStyle=VIA_THEME_SEL_REGION_FILL_COLOR,_via_reg_ctx.globalAlpha=VIA_THEME_SEL_REGION_OPACITY,_via_reg_ctx.fill(),_via_reg_ctx.globalAlpha=1,_via_draw_control_point(_+i*Math.cos(a),e+i*Math.sin(a)),_via_draw_control_point(_-i*Math.cos(a),e-i*Math.sin(a)),_via_draw_control_point(_+t*Math.sin(a),e-t*Math.cos(a)),_via_draw_control_point(_-t*Math.sin(a),e+t*Math.cos(a))):(_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/2,_via_draw_ellipse(_,e,i,t,a),_via_reg_ctx.stroke(),i>VIA_THEME_REGION_BOUNDARY_WIDTH&&t>VIA_THEME_REGION_BOUNDARY_WIDTH&&(_via_reg_ctx.strokeStyle=VIA_THEME_BOUNDARY_LINE_COLOR,_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/4,_via_draw_ellipse(_,e,i+VIA_THEME_REGION_BOUNDARY_WIDTH/2,t+VIA_THEME_REGION_BOUNDARY_WIDTH/2,a),_via_reg_ctx.stroke(),_via_draw_ellipse(_,e,i-VIA_THEME_REGION_BOUNDARY_WIDTH/2,t-VIA_THEME_REGION_BOUNDARY_WIDTH/2,a),_via_reg_ctx.stroke()))}function _via_draw_ellipse(_,e,i,t,a){_via_reg_ctx.save(),_via_reg_ctx.beginPath(),_via_reg_ctx.ellipse(_,e,i,t,a,0,2*Math.PI),_via_reg_ctx.restore(),_via_reg_ctx.closePath()}function _via_draw_polygon_region(_,e,i,t){if(i){_via_reg_ctx.strokeStyle=VIA_THEME_SEL_REGION_FILL_BOUNDARY_COLOR,_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/2,_via_reg_ctx.beginPath(),_via_reg_ctx.moveTo(_[0],e[0]);for(var a=1;a<_.length;++a)_via_reg_ctx.lineTo(_[a],e[a]);t===VIA_REGION_SHAPE.POLYGON&&_via_reg_ctx.lineTo(_[0],e[0]),_via_reg_ctx.stroke(),_via_reg_ctx.fillStyle=VIA_THEME_SEL_REGION_FILL_COLOR,_via_reg_ctx.globalAlpha=VIA_THEME_SEL_REGION_OPACITY,_via_reg_ctx.fill(),_via_reg_ctx.globalAlpha=1;for(a=0;a<_.length;++a)_via_draw_control_point(_[a],e[a])}else{_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/2,_via_reg_ctx.beginPath(),_via_reg_ctx.moveTo(_[0],e[0]);for(a=0;a<_.length;++a)_via_reg_ctx.lineTo(_[a],e[a]);t===VIA_REGION_SHAPE.POLYGON&&_via_reg_ctx.lineTo(_[0],e[0]),_via_reg_ctx.stroke()}}function _via_draw_point_region(_,e,i){i?(_via_draw_point(_,e,VIA_REGION_POINT_RADIUS),_via_reg_ctx.strokeStyle=VIA_THEME_SEL_REGION_FILL_BOUNDARY_COLOR,_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/2,_via_reg_ctx.stroke(),_via_reg_ctx.fillStyle=VIA_THEME_SEL_REGION_FILL_COLOR,_via_reg_ctx.globalAlpha=VIA_THEME_SEL_REGION_OPACITY,_via_reg_ctx.fill(),_via_reg_ctx.globalAlpha=1):(_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/2,_via_draw_point(_,e,VIA_REGION_POINT_RADIUS),_via_reg_ctx.stroke(),_via_reg_ctx.strokeStyle=VIA_THEME_BOUNDARY_LINE_COLOR,_via_reg_ctx.lineWidth=VIA_THEME_REGION_BOUNDARY_WIDTH/4,_via_draw_point(_,e,VIA_REGION_POINT_RADIUS-VIA_THEME_REGION_BOUNDARY_WIDTH/2),_via_reg_ctx.stroke(),_via_draw_point(_,e,VIA_REGION_POINT_RADIUS+VIA_THEME_REGION_BOUNDARY_WIDTH/2),_via_reg_ctx.stroke())}function _via_draw_point(_,e,i){_via_reg_ctx.beginPath(),_via_reg_ctx.arc(_,e,i,0,2*Math.PI,!1),_via_reg_ctx.closePath()}function draw_all_region_id(){_via_reg_ctx.shadowColor="transparent",_via_reg_ctx.font=_via_settings.ui.image.region_label_font;for(var _=0;_<_via_img_metadata[_via_image_id].regions.length;++_){var e,i=_via_canvas_regions[_],t=get_region_bounding_box(i),a=t[0],n=t[1],r=Math.abs(t[2]-t[0]),s=_via_reg_ctx.measureText("M").width,o=1.8*s,g=(_+1).toString(),l=_via_img_metadata[_via_image_id].regions[_].region_attributes[_via_settings.ui.image.region_label];_via_img_metadata[_via_image_id].regions[_].shape_attributes.name;if("__via_region_id__"!==_via_settings.ui.image.region_label)if(void 0!==l)switch(typeof l){default:case"string":g=l;break;case"object":g=Object.keys(l).join(",")}else g="undefined";var d=_via_reg_ctx.measureText(g).width;if(d>r)if("__via_region_id__"===_via_settings.ui.image.region_label)e=d+s;else{var v=Math.floor(r*g.length/d);v>1?(g=g.substr(0,v-1)+".",e=r):(g=g.substr(0,1)+".",e=2*s)}else e=d+s;i.shape_attributes.name===VIA_REGION_SHAPE.POLYGON||i.shape_attributes.name===VIA_REGION_SHAPE.POLYLINE?(a=i.shape_attributes.all_points_x[0],n=i.shape_attributes.all_points_y[0]):a-=e/2-r/2,n<o&&(n=o),_via_reg_ctx.fillStyle="black",_via_reg_ctx.globalAlpha=.8,_via_reg_ctx.fillRect(Math.floor(a),Math.floor(n-1.1*o),Math.floor(e),Math.floor(o)),_via_reg_ctx.globalAlpha=1,_via_reg_ctx.fillStyle="yellow",_via_reg_ctx.fillText(g,Math.floor(a+.4*s),Math.floor(n-.35*o))}}function get_region_bounding_box(_){var e=_.shape_attributes,i=new Array(4);switch(e.name){case"rect":i[0]=e.x,i[1]=e.y,i[2]=e.x+e.width,i[3]=e.y+e.height;break;case"circle":i[0]=e.cx-e.r,i[1]=e.cy-e.r,i[2]=e.cx+e.r,i[3]=e.cy+e.r;break;case"ellipse":let _=e.theta,l=_+Math.PI/2,d=e.rx*Math.cos(_),v=e.rx*Math.sin(_),c=e.ry*Math.cos(l),u=e.ry*Math.sin(l),m=2*Math.sqrt(d*d+c*c),p=2*Math.sqrt(v*v+u*u);i[0]=e.cx-m/2,i[1]=e.cy-p/2,i[2]=e.cx+m/2,i[3]=e.cy+p/2;break;case"polyline":case"polygon":for(var t=e.all_points_x,a=e.all_points_y,n=Number.MAX_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,s=0,o=0,g=0;g<t.length;++g)t[g]<n&&(n=t[g]),t[g]>s&&(s=t[g]),a[g]<r&&(r=a[g]),a[g]>o&&(o=a[g]);i[0]=n,i[1]=r,i[2]=s,i[3]=o;break;case"point":i[0]=e.cx-VIA_REGION_POINT_RADIUS,i[1]=e.cy-VIA_REGION_POINT_RADIUS,i[2]=e.cx+VIA_REGION_POINT_RADIUS,i[3]=e.cy+VIA_REGION_POINT_RADIUS}return i}function is_inside_region(_,e,i){var t,a,n,r=_via_canvas_regions.length;if(0===r)return-1;i?(t=r-1,a=-1,n=-1):(t=0,a=r,n=1);for(var s=t;s!==a;){if(is_inside_this_region(_,e,s))return s;s+=n}return-1}function is_inside_this_region(_,e,i){var t=_via_canvas_regions[i].shape_attributes,a=!1;switch(t.name){case VIA_REGION_SHAPE.RECT:a=is_inside_rect(t.x,t.y,t.width,t.height,_,e);break;case VIA_REGION_SHAPE.CIRCLE:a=is_inside_circle(t.cx,t.cy,t.r,_,e);break;case VIA_REGION_SHAPE.ELLIPSE:a=is_inside_ellipse(t.cx,t.cy,t.rx,t.ry,t.theta,_,e);break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:a=is_inside_polygon(t.all_points_x,t.all_points_y,_,e);break;case VIA_REGION_SHAPE.POINT:a=is_inside_point(t.cx,t.cy,_,e)}return a}function is_inside_circle(_,e,i,t,a){var n=t-_,r=a-e;return n*n+r*r<i*i}function is_inside_rect(_,e,i,t,a,n){return a>_&&a<_+i&&n>e&&n<e+t}function is_inside_ellipse(_,e,i,t,a,n,r){var s=Math.cos(-a)*(_-n)-Math.sin(-a)*(e-r),o=Math.sin(-a)*(_-n)+Math.cos(-a)*(e-r);return s*s/(i*i)+o*o/(t*t)<1}function is_inside_polygon(_,e,i,t){if(0===_.length||0===e.length)return 0;var a,n=0,r=_.length;for(a=0;a<r-1;++a){var s=is_left(_[a],e[a],_[a+1],e[a+1],i,t);e[a]<=t?e[a+1]>t&&s>0&&++n:e[a+1]<=t&&s<0&&--n}s=is_left(_[r-1],e[r-1],_[0],e[0],i,t);return e[r-1]<=t?e[0]>t&&s>0&&++n:e[0]<=t&&s<0&&--n,0===n?0:1}function is_inside_point(_,e,i,t){var a=i-_,n=t-e;return a*a+n*n<VIA_POLYGON_VERTEX_MATCH_TOL*VIA_POLYGON_VERTEX_MATCH_TOL}function is_left(_,e,i,t,a,n){return(i-_)*(n-e)-(a-_)*(t-e)}function is_on_region_corner(_,e){for(var i=[-1,-1],t=0;t<_via_canvas_regions.length;++t){var a=_via_canvas_regions[t].shape_attributes,n=!1;switch(i[0]=t,a.name){case VIA_REGION_SHAPE.RECT:n=is_on_rect_edge(a.x,a.y,a.width,a.height,_,e);break;case VIA_REGION_SHAPE.CIRCLE:n=is_on_circle_edge(a.cx,a.cy,a.r,_,e);break;case VIA_REGION_SHAPE.ELLIPSE:n=is_on_ellipse_edge(a.cx,a.cy,a.rx,a.ry,a.theta,_,e);break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:0===(n=is_on_polygon_vertex(a.all_points_x,a.all_points_y,_,e))&&(n=is_on_polygon_edge(a.all_points_x,a.all_points_y,_,e));break;case VIA_REGION_SHAPE.POINT:n=0}if(n>0)return i[1]=n,i}return i[0]=-1,i}function is_on_rect_edge(_,e,i,t,a,n){var r=Math.abs(_-a),s=Math.abs(e-n),o=Math.abs(_+i-a),g=Math.abs(e+t-n);if(r<VIA_REGION_EDGE_TOL&&s<VIA_REGION_EDGE_TOL)return 1;if(o<VIA_REGION_EDGE_TOL&&s<VIA_REGION_EDGE_TOL)return 2;if(o<VIA_REGION_EDGE_TOL&&g<VIA_REGION_EDGE_TOL)return 3;if(r<VIA_REGION_EDGE_TOL&&g<VIA_REGION_EDGE_TOL)return 4;var l=Math.abs(_+i/2-a),d=Math.abs(e+t/2-n);return l<VIA_REGION_EDGE_TOL&&s<VIA_REGION_EDGE_TOL?5:o<VIA_REGION_EDGE_TOL&&d<VIA_REGION_EDGE_TOL?6:l<VIA_REGION_EDGE_TOL&&g<VIA_REGION_EDGE_TOL?7:r<VIA_REGION_EDGE_TOL&&d<VIA_REGION_EDGE_TOL?8:0}function is_on_circle_edge(_,e,i,t,a){var n=_-t,r=e-a;if(!(Math.abs(Math.sqrt(n*n+r*r)-i)<VIA_REGION_EDGE_TOL))return 0;var s=Math.atan2(a-e,t-_);return Math.abs(s-Math.PI/2)<VIA_THETA_TOL||Math.abs(s+Math.PI/2)<VIA_THETA_TOL?5:Math.abs(s)<VIA_THETA_TOL||Math.abs(Math.abs(s)-Math.PI)<VIA_THETA_TOL?6:s>0&&s<Math.PI/2?1:s>Math.PI/2&&s<Math.PI?4:s<0&&s>-Math.PI/2?2:s<-Math.PI/2&&s>-Math.PI?3:void 0}function is_on_ellipse_edge(_,e,i,t,a,n,r){n-=_,r-=e;var s=Math.cos(-a)*n-Math.sin(-a)*r,o=Math.sin(-a)*n+Math.cos(-a)*r,g=(_-(n=s+_))/i,l=(e-(r=o+e))/t;if(!(Math.abs(Math.sqrt(g*g+l*l)-1)<VIA_ELLIPSE_EDGE_TOL))return 0;var d=Math.atan2(r-e,n-_);return Math.abs(d-Math.PI/2)<VIA_THETA_TOL||Math.abs(d+Math.PI/2)<VIA_THETA_TOL?5:Math.abs(d)<VIA_THETA_TOL||Math.abs(Math.abs(d)-Math.PI)<VIA_THETA_TOL?6:void 0}function is_on_polygon_vertex(_,e,i,t){var a,n;for(n=_.length,a=0;a<n;++a)if(Math.abs(_[a]-i)<VIA_POLYGON_VERTEX_MATCH_TOL&&Math.abs(e[a]-t)<VIA_POLYGON_VERTEX_MATCH_TOL)return VIA_POLYGON_RESIZE_VERTEX_OFFSET+a;return 0}function is_on_polygon_edge(_,e,i,t){var a,n,r,s;for(n=_.length,s=[],a=0;a<n-1;++a)r=dist_to_line(i,t,_[a],e[a],_[a+1],e[a+1]),s.push(r);r=dist_to_line(i,t,_[n-1],e[n-1],_[0],e[0]),s.push(r);var o=s[0],g=0;for(n=s.length,a=1;a<n;++a)s[a]<o&&(o=s[a],g=a);return o<VIA_POLYGON_VERTEX_MATCH_TOL?VIA_POLYGON_RESIZE_VERTEX_OFFSET+g:0}function is_point_inside_bounding_box(_,e,i,t,a,n){var r={};return i<a?(r.x1=i,r.x2=a):(r.x1=a,r.x2=i),t<n?(r.y1=t,r.y2=n):(r.y1=n,r.y2=t),_>=r.x1&&_<=r.x2&&e>=r.y1&&e<=r.y2}function dist_to_line(_,e,i,t,a,n){if(is_point_inside_bounding_box(_,e,i,t,a,n)){var r=n-t,s=a-i,o=Math.abs(r*_-s*e+a*t-n*i)/Math.sqrt(s*s+r*r);return Math.round(o)}return Number.MAX_SAFE_INTEGER}function rect_standardize_coordinates(_){if(_[0]>_[2]){var e=_[0];_[0]=_[2],_[2]=e}if(_[1]>_[3]){e=_[1];_[1]=_[3],_[3]=e}}function rect_update_corner(_,e,i,t,a){if(a)switch(_){case 1:case 3:var n=e[2]-e[0],r=(g=e[3]-e[1])/(l=Math.sqrt(n*n+g*g)),s=(d=n/l)*(v=(i-e[0])*d+(t-e[1])*r),o=r*v;i=Math.round(e[0]+s),t=Math.round(e[1]+o);break;case 2:case 4:var g,l,d,v;n=e[2]-e[0],r=(g=e[1]-e[3])/(l=Math.sqrt(n*n+g*g)),s=(d=n/l)*(v=(i-e[0])*d+(t-e[3])*r),o=r*v;i=Math.round(e[0]+s),t=Math.round(e[3]+o)}switch(_){case 1:e[0]=i,e[1]=t;break;case 3:e[2]=i,e[3]=t;break;case 2:e[2]=i,e[1]=t;break;case 4:e[0]=i,e[3]=t;break;case 5:e[1]=t;break;case 6:e[2]=i;break;case 7:e[3]=t;break;case 8:e[0]=i}}function _via_update_ui_components(){if(_via_current_image_loaded)switch(show_message("Updating user interface components."),_via_display_area_content_name){case VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID:image_grid_set_content_panel_height_fixed(),image_grid_set_content_to_current_group();break;case VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE:!_via_is_window_resized&&_via_current_image_loaded&&(_via_is_window_resized=!0,_via_show_img(_via_image_index),_via_is_canvas_zoomed&&reset_zoom_level())}}function _via_window_keydown_handler(_){_.target===document.body&&_via_handle_global_keydown_event(_)}function _via_handle_global_keydown_event(_){if(_via_current_image_loaded){if("+"===_.key)return void zoom_in();if("="===_.key)return void reset_zoom_level();if("-"===_.key)return void zoom_out()}return"ArrowRight"===_.key||"n"===_.key?(move_to_next_image(),void _.preventDefault()):"ArrowLeft"===_.key||"p"===_.key?(move_to_prev_image(),void _.preventDefault()):"ArrowUp"===_.key?(region_visualisation_update("region_label","__via_region_id__",1),void _.preventDefault()):"ArrowDown"===_.key?(region_visualisation_update("region_color","__via_default_region_color__",-1),void _.preventDefault()):"Home"===_.key?(show_first_image(),void _.preventDefault()):"End"===_.key?(show_last_image(),void _.preventDefault()):"PageDown"===_.key?(jump_to_next_image_block(),void _.preventDefault()):"PageUp"===_.key?(jump_to_prev_image_block(),void _.preventDefault()):("a"===_.key&&_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID&&image_grid_group_toggle_select_all(),"Escape"===_.key?(_.preventDefault(),_via_is_loading_current_image&&_via_cancel_current_image_loading(),_via_is_user_resizing_region&&(_via_is_user_resizing_region=!1),_via_is_region_selected&&(_via_is_region_selected=!1,_via_user_sel_region_id=-1,toggle_all_regions_selection(!1)),_via_is_user_drawing_polygon&&(_via_is_user_drawing_polygon=!1,_via_canvas_regions.splice(_via_current_polygon_region_id,1)),_via_is_user_drawing_region&&(_via_is_user_drawing_region=!1),_via_is_user_resizing_region&&(_via_is_user_resizing_region=!1),_via_is_user_moving_region&&(_via_is_user_moving_region=!1),void _via_redraw_reg_canvas()):" "===_.key?(_.ctrlKey?annotation_editor_toggle_on_image_editor():annotation_editor_toggle_all_regions_editor(),void _.preventDefault()):"F1"===_.key?(set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.PAGE_GETTING_STARTED),void _.preventDefault()):"F2"===_.key?(set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.PAGE_ABOUT),void _.preventDefault()):void 0)}function _via_reg_canvas_keyup_handler(_){"Control"===_.key&&(_via_is_ctrl_pressed=!1)}function _via_reg_canvas_keydown_handler(_){if("Control"===_.key&&(_via_is_ctrl_pressed=!0),_via_current_image_loaded){if("Enter"===_.key&&(_via_current_shape!==VIA_REGION_SHAPE.POLYLINE&&_via_current_shape!==VIA_REGION_SHAPE.POLYGON||_via_polyshape_finish_drawing()),"Backspace"===_.key&&(_via_current_shape!==VIA_REGION_SHAPE.POLYLINE&&_via_current_shape!==VIA_REGION_SHAPE.POLYGON||_via_polyshape_delete_last_vertex()),"a"===_.key)return sel_all_regions(),void _.preventDefault();if("c"===_.key)return(_via_is_region_selected||_via_is_all_region_selected)&&copy_sel_regions(),void _.preventDefault();if("v"===_.key)return paste_sel_regions_in_current_image(),void _.preventDefault();if("b"===_.key)return toggle_region_boundary_visibility(),void _.preventDefault();if("l"===_.key)return toggle_region_id_visibility(),void _.preventDefault();if("d"===_.key)return(_via_is_region_selected||_via_is_all_region_selected)&&del_sel_regions(),void _.preventDefault();if(_via_is_region_selected&&("ArrowRight"===_.key||"ArrowLeft"===_.key||"ArrowDown"===_.key||"ArrowUp"===_.key)){var e=1;_.shiftKey&&(e=10);var i=0,t=0;switch(_.key){case"ArrowLeft":i=-e;break;case"ArrowUp":t=-e;break;case"ArrowRight":i=e;break;case"ArrowDown":t=e}return _via_move_selected_regions(i,t),_via_redraw_reg_canvas(),void _.preventDefault()}}_via_handle_global_keydown_event(_)}function _via_polyshape_finish_drawing(){if(_via_is_user_drawing_polygon){var _=_via_current_polygon_region_id,e=_via_current_shape,i=_via_canvas_regions[_].shape_attributes.all_points_x.length;if(i<=2&&e===VIA_REGION_SHAPE.POLYGON)return void show_message("For a polygon, you must define at least 3 points. Press [Esc] to cancel drawing operation.!");if(i<=1&&e===VIA_REGION_SHAPE.POLYLINE)return void show_message("A polyline must have at least 2 points. Press [Esc] to cancel drawing operation.!");var t=_via_image_id;_via_current_polygon_region_id=-1,_via_is_user_drawing_polygon=!1,_via_is_user_drawing_region=!1,_via_img_metadata[t].regions[_]={},_via_polyshape_add_new_polyshape(t,e,_),select_only_region(_),set_region_annotations_to_default_value(_),annotation_editor_add_row(_),annotation_editor_scroll_to_row(_),_via_redraw_reg_canvas(),_via_reg_canvas.focus()}}function _via_polyshape_delete_last_vertex(){if(_via_is_user_drawing_polygon){var _=_via_canvas_regions[_via_current_polygon_region_id].shape_attributes.all_points_x.length;_>0&&(_via_canvas_regions[_via_current_polygon_region_id].shape_attributes.all_points_x.splice(_-1,1),_via_canvas_regions[_via_current_polygon_region_id].shape_attributes.all_points_y.splice(_-1,1),_via_redraw_reg_canvas(),_via_reg_canvas.focus())}}function _via_polyshape_add_new_polyshape(_,e,i){var t,a=_via_canvas_regions[i].shape_attributes.all_points_x.slice(0),n=_via_canvas_regions[i].shape_attributes.all_points_y.slice(0),r=[],s=[],o=a.length;for(t=0;t<o;++t)a[t]=Math.round(a[t]*_via_canvas_scale),n[t]=Math.round(n[t]*_via_canvas_scale),r[t]=Math.round(a[t]/_via_canvas_scale),s[t]=Math.round(n[t]/_via_canvas_scale);var g=new file_region;g.shape_attributes.name=e,g.shape_attributes.all_points_x=a,g.shape_attributes.all_points_y=n,_via_img_metadata[_].regions[i]=g,_===_via_image_id&&(_via_canvas_regions[i].shape_attributes.name=e,_via_canvas_regions[i].shape_attributes.all_points_x=r,_via_canvas_regions[i].shape_attributes.all_points_y=s)}function del_sel_regions(){if(_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID)if(_via_current_image_loaded){var _=0;if(_via_is_all_region_selected)_=_via_canvas_regions.length,_via_canvas_regions.splice(0),_via_img_metadata[_via_image_id].regions.splice(0);else{for(var e=[],i=0;i<_via_canvas_regions.length;++i)_via_region_selected_flag[i]&&(e.push(i),_via_region_selected_flag[i]=!1);e.sort(function(_,e){return e-_});for(i=0;i<e.length;++i)_via_canvas_regions.splice(e[i],1),_via_img_metadata[_via_image_id].regions.splice(e[i],1),_+=1;e.length&&(_via_reg_canvas.style.cursor="default")}_via_is_all_region_selected=!1,_via_is_region_selected=!1,_via_user_sel_region_id=-1,0===_via_canvas_regions.length?_via_clear_reg_canvas():_via_redraw_reg_canvas(),_via_reg_canvas.focus(),annotation_editor_show(),show_message("Deleted "+_+" selected regions")}else show_message("First load some images!")}function sel_all_regions(){_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID?_via_current_image_loaded?(toggle_all_regions_selection(!0),_via_is_all_region_selected=!0,_via_redraw_reg_canvas()):show_message("First load some images!"):image_grid_group_toggle_select_all()}function copy_sel_regions(){if(_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID)if(_via_current_image_loaded)if(_via_is_region_selected||_via_is_all_region_selected){_via_copied_image_regions.splice(0);for(var _=0;_<_via_img_metadata[_via_image_id].regions.length;++_){var e=_via_img_metadata[_via_image_id].regions[_];_via_canvas_regions[_];_via_region_selected_flag[_]&&_via_copied_image_regions.push(clone_image_region(e))}show_message("Copied "+_via_copied_image_regions.length+" selected regions. Press Ctrl + v to paste")}else show_message("Select a region first!");else show_message("First load some images!")}function paste_sel_regions_in_current_image(){if(_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID)if(_via_current_image_loaded)if(_via_copied_image_regions.length){for(var _=0,e=0;e<_via_copied_image_regions.length;++e){var i=get_region_bounding_box(_via_copied_image_regions[e]);if(i[2]<_via_current_image_width&&i[3]<_via_current_image_height){var t=clone_image_region(_via_copied_image_regions[e]);_via_img_metadata[_via_image_id].regions.push(t),_+=1}}_via_load_canvas_regions(),show_message("Pasted "+_+" regions. Discarded "+(_via_copied_image_regions.length-_)+" regions exceeding image boundary."),_via_redraw_reg_canvas(),_via_reg_canvas.focus()}else show_message("To paste a region, you first need to select a region and copy it!");else show_message("First load some images!")}function paste_to_multiple_images_with_confirm(){if(_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID)if(0!==_via_copied_image_regions.length){invoke_with_user_inputs(paste_to_multiple_images_confirmed,{region_count:{type:"text",name:"Number of copied regions",value:_via_copied_image_regions.length,disabled:!0},prev_next_count:{type:"text",name:'Copy to (count format)<br><span style="font-size:0.8rem">For example: to paste copied regions to the <i>previous 2 images</i> and <i>next 3 images</i>, type <strong>2,3</strong> in the textbox and to paste only in <i>next 5 images</i>, type <strong>0,5</strong></span>',placeholder:"2,3",disabled:!1,size:30},img_index_list:{type:"text",name:'Copy to (image index list)<br><span style="font-size:0.8rem">For example: <strong>2-5,7,9</strong> pastes the copied regions to the images with the following id <i>2,3,4,5,7,9</i> and <strong>3,8,141</strong> pastes to the images with id <i>3,8 and 141</i></span>',placeholder:"2-5,7,9",disabled:!1,size:30},regex:{type:"text",name:'Copy to filenames matching a regular expression<br><span style="font-size:0.8rem">For example: <strong>_large</strong> pastes the copied regions to all images whose filename contain the keyword <i>_large</i></span>',placeholder:"regular expression",disabled:!1,size:30},include_region_attributes:{type:"checkbox",name:"Paste also the region annotations",checked:!0}},{title:"Paste Regions to Multiple Images"})}else show_message("First copy some regions!")}function paste_to_multiple_images_confirmed(_){_via_paste_to_multiple_images_input=_;var e,i=generate_img_index_list(_),t=0;for(e=0;e<i.length;e++)t+=paste_regions(i[e]);show_message("Pasted ["+t+"] regions in "+i.length+" images"),i.includes(_via_image_index)&&(_via_load_canvas_regions(),_via_redraw_reg_canvas(),_via_reg_canvas.focus()),user_input_default_cancel_handler()}function paste_regions(_){var e=0;if(_via_copied_image_regions.length){var i,t=_via_image_id_list[_];for(i=0;i<_via_copied_image_regions.length;++i){var a=clone_image_region(_via_copied_image_regions[i]);_via_img_metadata[t].regions.push(a),e+=1}}return e}function del_sel_regions_with_confirm(){if(_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID)if(0!==_via_copied_image_regions.length){var _,e,i;_via_paste_to_multiple_images_input&&(_=_via_paste_to_multiple_images_input.prev_next_count.value,e=_via_paste_to_multiple_images_input.img_index_list.value,i=_via_paste_to_multiple_images_input.regex.value);invoke_with_user_inputs(del_sel_regions_confirmed,{region_count:{type:"text",name:"Number of regions selected",value:_via_copied_image_regions.length,disabled:!0},prev_next_count:{type:"text",name:'Delete from (count format)<br><span style="font-size:0.8rem">For example: to delete copied regions from the <i>previous 2 images</i> and <i>next 3 images</i>, type <strong>2,3</strong> in the textbox and to delete regions only in <i>next 5 images</i>, type <strong>0,5</strong></span>',placeholder:"2,3",disabled:!1,size:30,value:_},img_index_list:{type:"text",name:'Delete from (image index list)<br><span style="font-size:0.8rem">For example: <strong>2-5,7,9</strong> deletes the copied regions to the images with the following id <i>2,3,4,5,7,9</i> and <strong>3,8,141</strong> deletes regions from the images with id <i>3,8 and 141</i></span>',placeholder:"2-5,7,9",disabled:!1,size:30,value:e},regex:{type:"text",name:'Delete from filenames matching a regular expression<br><span style="font-size:0.8rem">For example: <strong>_large</strong> deletes the copied regions from all images whose filename contain the keyword <i>_large</i></span>',placeholder:"regular expression",disabled:!1,size:30,value:i}},{title:"Undo Regions Pasted to Multiple Images"})}else show_message("First copy some regions!")}function del_sel_regions_confirmed(_){user_input_default_cancel_handler();var e,i=generate_img_index_list(_),t=0;for(e=0;e<i.length;e++)t+=delete_regions(i[e]);show_message("Deleted ["+t+"] regions in "+i.length+" images"),i.includes(_via_image_index)&&(_via_load_canvas_regions(),_via_redraw_reg_canvas(),_via_reg_canvas.focus())}function delete_regions(_){var e=0;if(_via_copied_image_regions.length){var i,t=_via_image_id_list[_];for(i=0;i<_via_copied_image_regions.length;++i){var a,n=JSON.stringify(_via_copied_image_regions[i].shape_attributes);for(a=_via_img_metadata[t].regions.length-1;a>=0;--a)if(JSON.stringify(_via_img_metadata[t].regions[a].shape_attributes)===n){_via_img_metadata[t].regions.splice(a,1),e+=1;break}}}return e}function show_first_image(){_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID?_via_img_count>0&&_via_show_img(_via_img_fn_list_img_index_list[0]):_via_image_grid_group_var.length?image_grid_group_prev({value:0}):show_message('First, create groups by selecting items from "Group by" dropdown list')}function show_last_image(){if(_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID){if(_via_img_count>0){var _=_via_img_fn_list_img_index_list.length-1;_via_show_img(_via_img_fn_list_img_index_list[_])}}else _via_image_grid_group_var.length?image_grid_group_prev({value:_via_image_grid_group_var.length-1}):show_message('First, create groups by selecting items from "Group by" dropdown list')}function jump_image_block_get_count(){var _=_via_img_fn_list_img_index_list.length;return _<20?2:_<100?10:_<1e3?25:_<5e3?50:_<1e4?100:_<5e4?500:Math.round(_/50)}function jump_to_next_image_block(){if(_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID){var _=jump_image_block_get_count();if(_>1){var e=_via_image_index;if(_via_img_fn_list_img_index_list.includes(e)){var i=_via_img_fn_list_img_index_list.indexOf(e)+_;i+1>_via_img_fn_list_img_index_list.length&&(i=0),_via_show_img(_via_img_fn_list_img_index_list[i])}}else move_to_next_image()}}function jump_to_prev_image_block(){if(_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID){var _=jump_image_block_get_count();if(_>1){var e=_via_image_index;if(_via_img_fn_list_img_index_list.includes(e)){var i=_via_img_fn_list_img_index_list.indexOf(e)-_;i<0&&(i=_via_img_fn_list_img_index_list.length-1),_via_show_img(_via_img_fn_list_img_index_list[i])}}else move_to_prev_image()}}function move_to_prev_image(){if(_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID){if(_via_img_count>0){var _=_via_image_index;if(_via_img_fn_list_img_index_list.includes(_)){var e=_via_img_fn_list_img_index_list.indexOf(_)-1;-1===e&&(e=_via_img_fn_list_img_index_list.length-1),_via_show_img(_via_img_fn_list_img_index_list[e])}else 0===_via_img_fn_list_img_index_list.length?show_message("Filtered file list does not any files!"):_via_show_img(_via_img_fn_list_img_index_list[0]);"function"==typeof _via_hook_prev_image&&_via_hook_prev_image(_)}}else _via_image_grid_group_var.length?image_grid_group_prev({value:_via_image_grid_group_var.length-1}):show_message('First, create groups by selecting items from "Group by" dropdown list')}function move_to_next_image(){if(_via_display_area_content_name!==VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID){if(_via_img_count>0){var _=_via_image_index;if(_via_img_fn_list_img_index_list.includes(_)){var e=_via_img_fn_list_img_index_list.indexOf(_)+1;e===_via_img_fn_list_img_index_list.length&&(e=0),_via_show_img(_via_img_fn_list_img_index_list[e])}else 0===_via_img_fn_list_img_index_list.length?show_message("Filtered file list does not contain any files!"):_via_show_img(_via_img_fn_list_img_index_list[0]);"function"==typeof _via_hook_next_image&&_via_hook_next_image(_)}}else _via_image_grid_group_var.length?image_grid_group_next({value:_via_image_grid_group_var.length-1}):show_message('First, create groups by selecting items from "Group by" dropdown list')}function set_zoom(_){_===VIA_CANVAS_DEFAULT_ZOOM_LEVEL_INDEX?(_via_is_canvas_zoomed=!1,_via_canvas_zoom_level_index=VIA_CANVAS_DEFAULT_ZOOM_LEVEL_INDEX):(_via_is_canvas_zoomed=!0,_via_canvas_zoom_level_index=_);var e=VIA_CANVAS_ZOOM_LEVELS[_via_canvas_zoom_level_index];set_all_canvas_scale(e),set_all_canvas_size(_via_current_image.naturalWidth*e/_via_canvas_scale_without_zoom,_via_current_image.naturalHeight*e/_via_canvas_scale_without_zoom),_via_canvas_scale=_via_canvas_scale_without_zoom/e,_via_canvas_scale=_via_canvas_scale_without_zoom/e,1===e?VIA_REGION_POINT_RADIUS=VIA_REGION_POINT_RADIUS_DEFAULT:e>1&&(VIA_REGION_POINT_RADIUS=VIA_REGION_POINT_RADIUS_DEFAULT*e),_via_load_canvas_regions(),_via_redraw_reg_canvas(),_via_reg_canvas.focus(),update_vertical_space()}function reset_zoom_level(){if(_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID)return image_grid_image_size_reset(),void show_message("Zoom reset");_via_current_image_loaded?(_via_is_canvas_zoomed?(set_zoom(VIA_CANVAS_DEFAULT_ZOOM_LEVEL_INDEX),show_message("Zoom reset")):show_message("Cannot reset zoom because image zoom has not been applied!"),update_vertical_space()):show_message("First load some images!")}function zoom_in(){if(_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID)return image_grid_image_size_increase(),void show_message("Increased size of images shown in image grid");_via_current_image_loaded?_via_is_user_drawing_polygon||_via_is_user_drawing_region||(_via_canvas_zoom_level_index===VIA_CANVAS_ZOOM_LEVELS.length-1?show_message("Further zoom-in not possible"):(set_zoom(_via_canvas_zoom_level_index+1),show_message("Zoomed in to level "+VIA_CANVAS_ZOOM_LEVELS[_via_canvas_zoom_level_index]+"X"))):show_message("First load some images!")}function zoom_out(){if(_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID)return image_grid_image_size_decrease(),void show_message("Reduced size of images shown in image grid");_via_current_image_loaded?_via_is_user_drawing_polygon||_via_is_user_drawing_region||(0===_via_canvas_zoom_level_index?show_message("Further zoom-out not possible"):(set_zoom(_via_canvas_zoom_level_index-1),show_message("Zoomed out to level "+VIA_CANVAS_ZOOM_LEVELS[_via_canvas_zoom_level_index]+"X"))):show_message("First load some images!")}function toggle_region_boundary_visibility(){_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE&&(_via_is_region_boundary_visible=!_via_is_region_boundary_visible,_via_redraw_reg_canvas(),_via_reg_canvas.focus()),_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID&&(_via_settings.ui.image_grid.show_region_shape?(_via_settings.ui.image_grid.show_region_shape=!1,document.getElementById("image_grid_content_rshape").innerHTML=""):(_via_settings.ui.image_grid.show_region_shape=!0,image_grid_page_show_all_regions()))}function toggle_region_id_visibility(){_via_is_region_id_visible=!_via_is_region_id_visible,_via_redraw_reg_canvas(),_via_reg_canvas.focus()}function toggle_region_info_visibility(){var _=document.getElementById("region_info");_.classList.contains("display_none")?(_.classList.remove("display_none"),_via_is_region_info_visible=!0):(_.classList.add("display_none"),_via_is_region_info_visible=!1)}function _via_reg_canvas_mouse_wheel_listener(_){_via_current_image_loaded&&_.ctrlKey&&(_.deltaY<0?zoom_in():zoom_out(),_.preventDefault())}function region_visualisation_update(_,e,i){var t,a=[e],n=(a=a.concat(Object.keys(_via_attributes.region))).length,r=a.indexOf(_via_settings.ui.image[_]);if(-1!==r){switch((t=r+i)<0&&(t=n+t),t>=n&&(t-=n),_){case"region_label":_via_settings.ui.image.region_label=a[t],_via_redraw_reg_canvas();break;case"region_color":_via_settings.ui.image.region_color=a[t],_via_regions_group_color_init(),_via_redraw_reg_canvas()}var s=_.replace("_"," ");_via_settings.ui.image[_].startsWith("__via")?show_message(s+" cleared"):show_message(s+" set to region attribute ["+_via_settings.ui.image[_]+"]")}}function leftsidebar_toggle(){var _=document.getElementById("leftsidebar");"none"===_.style.display?(_.style.display="table-cell",document.getElementById("leftsidebar_collapse_panel").style.display="none"):(_.style.display="none",document.getElementById("leftsidebar_collapse_panel").style.display="table-cell"),_via_update_ui_components()}function leftsidebar_increase_width(){var _=document.getElementById("leftsidebar"),e=_via_settings.ui.leftsidebar_width+VIA_LEFTSIDEBAR_WIDTH_CHANGE;_.style.width=e+"rem",_via_settings.ui.leftsidebar_width=e,_via_current_image_loaded&&_via_show_img(_via_image_index)}function leftsidebar_decrease_width(){var _=document.getElementById("leftsidebar"),e=_via_settings.ui.leftsidebar_width-VIA_LEFTSIDEBAR_WIDTH_CHANGE;e>=5&&(_.style.width=e+"rem",_via_settings.ui.leftsidebar_width=e,_via_current_image_loaded&&_via_show_img(_via_image_index))}function leftsidebar_show(){document.getElementById("leftsidebar").style.display="table-cell",document.getElementById("leftsidebar_collapse_panel").style.display="none"}function init_leftsidebar_accordion(){document.getElementById("leftsidebar").style.width=_via_settings.ui.leftsidebar_width+"rem";var _,e=document.getElementsByClassName("leftsidebar_accordion");for(_=0;_<e.length;++_)e[_].addEventListener("click",function(){switch(update_vertical_space(),this.classList.toggle("active"),this.nextElementSibling.classList.toggle("show"),this.innerHTML){case"Attributes":update_attributes_update_panel();break;case"Project":update_img_fn_list()}})}function is_img_fn_list_visible(){return img_fn_list_panel.classList.contains("show")}function img_loading_spinbar(_,e){var i=document.getElementById("project_panel_title");i.innerHTML=e?'Project <span style="margin-left:1rem;" class="loading_spinbox"></span>':"Project"}function update_img_fn_list(){var _=document.getElementById("img_fn_list_regex").value,e=document.getElementById("filelist_preset_filters_list");if(""===_||null===_)if(0===e.selectedIndex){_via_img_fn_list_img_index_list=[],(_via_img_fn_list_html=[]).push("<ul>");for(var i=0;i<_via_image_filename_list.length;++i)_via_img_fn_list_html.push(img_fn_list_ith_entry_html(i)),_via_img_fn_list_img_index_list.push(i);_via_img_fn_list_html.push("</ul>"),img_fn_list.innerHTML=_via_img_fn_list_html.join(""),img_fn_list_scroll_to_current_file()}else img_fn_list_onpresetfilter_select();else img_fn_list_generate_html(_),img_fn_list.innerHTML=_via_img_fn_list_html.join(""),img_fn_list_scroll_to_current_file()}function img_fn_list_onregex(){var _=document.getElementById("img_fn_list_regex").value;img_fn_list_generate_html(_),img_fn_list.innerHTML=_via_img_fn_list_html.join(""),img_fn_list_scroll_to_current_file();var e,i=document.getElementById("filelist_preset_filters_list");if(""===_)i.selectedIndex=0;else for(e=0;e<i.options.length;++e)if("regex"===i.options[e].value){i.selectedIndex=e;break}}function img_fn_list_onpresetfilter_select(){var _=document.getElementById("filelist_preset_filters_list"),e=_.options[_.selectedIndex].value;switch(e){case"all":document.getElementById("img_fn_list_regex").value="",img_fn_list_generate_html(),img_fn_list.innerHTML=_via_img_fn_list_html.join(""),img_fn_list_scroll_to_current_file();break;case"regex":document.getElementById("img_fn_list_regex").focus();break;default:var i;for(_via_img_fn_list_img_index_list=[],(_via_img_fn_list_html=[]).push("<ul>"),i=0;i<_via_image_filename_list.length;++i){var t=_via_image_id_list[i],a=!1;switch(e){case"files_without_region":0===_via_img_metadata[t].regions.length&&(a=!0);break;case"files_missing_region_annotations":is_region_annotation_missing(t)&&(a=!0);break;case"files_missing_file_annotations":is_file_annotation_missing(t)&&(a=!0);break;case"files_error_loading":!0===_via_image_load_error[i]&&(a=!0)}a&&(_via_img_fn_list_html.push(img_fn_list_ith_entry_html(i)),_via_img_fn_list_img_index_list.push(i))}_via_img_fn_list_html.push("</ul>"),img_fn_list.innerHTML=_via_img_fn_list_html.join(""),img_fn_list_scroll_to_current_file()}}function is_region_annotation_missing(_){var e,i;for(i=0;i<_via_img_metadata[_].regions.length;++i)for(e in _via_attributes.region){if(!_via_img_metadata[_].regions[i].region_attributes.hasOwnProperty(e))return!0;if(""===_via_img_metadata[_].regions[i].region_attributes[e])return!0}return!1}function is_file_annotation_missing(_){var e;for(e in _via_attributes.file){if(!_via_img_metadata[_].file_attributes.hasOwnProperty(e))return!0;if(""===_via_img_metadata[_].file_attributes[e])return!0}return!1}function img_fn_list_ith_entry_selected(_,e){e?img_fn_list_ith_entry_add_css_class(_,"sel"):img_fn_list_ith_entry_remove_css_class(_,"sel")}function img_fn_list_ith_entry_error(_,e){e?img_fn_list_ith_entry_add_css_class(_,"error"):img_fn_list_ith_entry_remove_css_class(_,"error")}function img_fn_list_ith_entry_add_css_class(_,e){var i=document.getElementById("fl"+_);i&&!i.classList.contains(e)&&i.classList.add(e)}function img_fn_list_ith_entry_remove_css_class(_,e){var i=document.getElementById("fl"+_);i&&i.classList.contains(e)&&i.classList.remove(e)}function img_fn_list_clear_all_style(){var _,e,i,t=document.getElementById("img_fn_list").childNodes[0].childNodes,a=t.length;for(_=0;_<a;++_)if(i=t[_].classList.length)for(e=0;e<i;++e)t[_].classList.remove(t[_].classList.item(e))}function img_fn_list_clear_css_classname(_){var e,i=document.getElementById("img_fn_list").childNodes[0].childNodes,t=i.length;for(e=0;e<t;++e)i[e].classList.contains(_)&&i[e].classList.remove(_)}function img_fn_list_ith_entry_html(_){var e="",i=_via_image_filename_list[_];return is_url(i)&&(i=i.substr(0,4)+"..."+get_filename_from_url(i)),e+='<li id="fl'+_+'"',_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID?_via_image_grid_page_img_index_list.includes(_)&&(e+=' class="sel"'):_===_via_image_index&&(e+=' class="sel"'),e+=' onclick="jump_to_image('+_+')" title="'+_via_image_filename_list[_]+'">['+(_+1)+"] "+decodeURIComponent(i)+"</li>"}function img_fn_list_generate_html(_){_via_img_fn_list_img_index_list=[],(_via_img_fn_list_html=[]).push("<ul>");for(var e=0;e<_via_image_filename_list.length;++e){null!==_via_image_filename_list[e].match(_)&&(_via_img_fn_list_html.push(img_fn_list_ith_entry_html(e)),_via_img_fn_list_img_index_list.push(e))}_via_img_fn_list_html.push("</ul>")}function img_fn_list_scroll_to_current_file(){img_fn_list_scroll_to_file(_via_image_index)}function img_fn_list_scroll_to_file(_){if(_via_img_fn_list_img_index_list.includes(_)){var e=document.getElementById("fl"+_),i=img_fn_list.clientHeight-20,t=img_fn_list.scrollTop,a=img_fn_list.scrollTop+i;e.offsetTop>t?e.offsetTop>a&&(img_fn_list.scrollTop=e.offsetTop):img_fn_list.scrollTop=e.offsetTop-i}}function toggle_img_fn_list_visibility(){leftsidebar_show(),document.getElementById("img_fn_list_panel").classList.toggle("show"),document.getElementById("project_panel_title").classList.toggle("active")}function toggle_attributes_editor(){leftsidebar_show(),document.getElementById("attributes_editor_panel").classList.toggle("show"),document.getElementById("attributes_editor_panel_title").classList.toggle("active")}function update_vertical_space(){var _=document.getElementById("vertical_space"),e=document.getElementById("annotation_editor_panel");_.style.height=e.offsetHeight+40+"px"}function attribute_update_panel_set_active_button(){var _;for(_ in _via_attributes){var e="button_show_"+_+"_attributes";document.getElementById(e).classList.remove("active")}e="button_show_"+_via_attribute_being_updated+"_attributes";document.getElementById(e).classList.add("active")}function show_region_attributes_update_panel(){_via_attribute_being_updated="region";var _=Object.keys(_via_attributes.region);_via_current_attribute_id=_.length?_[0]:"",update_attributes_update_panel(),attribute_update_panel_set_active_button()}function show_file_attributes_update_panel(){_via_attribute_being_updated="file";var _=Object.keys(_via_attributes.file);_via_current_attribute_id=_.length?_[0]:"",update_attributes_update_panel(),attribute_update_panel_set_active_button()}function update_attributes_name_list(){var _,e=document.getElementById("attributes_name_list");for(_ in e.innerHTML="",_via_attributes[_via_attribute_being_updated]){var i=document.createElement("option");i.setAttribute("value",_),i.innerHTML=_,_===_via_current_attribute_id&&i.setAttribute("selected","selected"),e.appendChild(i)}}function update_attributes_update_panel(){document.getElementById("attributes_editor_panel").classList.contains("show")&&(update_attributes_name_list(),show_attribute_properties(),show_attribute_options())}function update_attribute_properties_panel(){document.getElementById("attributes_editor_panel").classList.contains("show")&&(show_attribute_properties(),show_attribute_options())}function show_attribute_properties(){var _=document.getElementById("attributes_name_list");if(document.getElementById("attribute_properties").innerHTML="",0!==_.options.length){void 0!==_via_current_attribute_id&&""!==_via_current_attribute_id||(_via_current_attribute_id=_.options[0].value);var e=_via_current_attribute_id,i=_via_attribute_being_updated,t=_via_attributes[i][e].type,a=_via_attributes[i][e].description;if(attribute_property_add_input_property("Name of attribute (appears in exported annotations)","Name",e,"attribute_name"),attribute_property_add_input_property("Description of attribute (shown to user during annotation session)","Desc.",a,"attribute_description"),"text"===t)attribute_property_add_input_property("Default value of this attribute","Def.",_via_attributes[i][e].default_value,"attribute_default_value");var n=document.createElement("div");n.setAttribute("class","property");var r=document.createElement("span");r.setAttribute("title","Attribute type (e.g. text, checkbox, radio, etc)"),r.innerHTML="Type";var s,o=document.createElement("span"),g=document.createElement("select");for(s in g.setAttribute("onchange","attribute_property_on_update(this)"),g.setAttribute("id","attribute_type"),VIA_ATTRIBUTE_TYPE){var l=VIA_ATTRIBUTE_TYPE[s],d=document.createElement("option");d.setAttribute("value",l),d.innerHTML=l,t==l&&d.setAttribute("selected","selected"),g.appendChild(d)}o.appendChild(g),n.appendChild(r),n.appendChild(o),document.getElementById("attribute_properties").appendChild(n)}}function show_attribute_options(){var _=document.getElementById("attributes_name_list");if(document.getElementById("attribute_options").innerHTML="",0!==_.options.length){var e=_.value,i=_via_attributes[_via_attribute_being_updated][e].type;switch(i){case VIA_ATTRIBUTE_TYPE.TEXT:break;case VIA_ATTRIBUTE_TYPE.IMAGE:(a=document.createElement("div")).setAttribute("class","property"),a.setAttribute("style","text-align:center"),(n=document.createElement("span")).setAttribute("style","width:25%"),n.setAttribute("title","When selected, this is the value that appears in exported annotations"),n.innerHTML="id",(r=document.createElement("span")).setAttribute("style","width:60%"),r.setAttribute("title","URL or base64 (see https://www.base64-image.de/) encoded image data that corresponds to the image shown as an option to the annotator"),r.innerHTML="image url or b64",(s=document.createElement("span")).setAttribute("title","The default value of this attribute"),s.innerHTML="def.",a.appendChild(n),a.appendChild(r),a.appendChild(s),document.getElementById("attribute_options").appendChild(a);var t=_via_attributes[_via_attribute_being_updated][e].options;for(o in t){attribute_property_add_option(e,o,t[o],_via_attributes[_via_attribute_being_updated][e].default_options[o],i)}attribute_property_add_new_entry_option(e,i);break;case VIA_ATTRIBUTE_TYPE.CHECKBOX:case VIA_ATTRIBUTE_TYPE.DROPDOWN:case VIA_ATTRIBUTE_TYPE.RADIO:var a,n,r,s;(a=document.createElement("div")).setAttribute("class","property"),a.setAttribute("style","text-align:center"),(n=document.createElement("span")).setAttribute("style","width:25%"),n.setAttribute("title","When selected, this is the value that appears in exported annotations"),n.innerHTML="id",(r=document.createElement("span")).setAttribute("style","width:60%"),r.setAttribute("title","This is the text shown as an option to the annotator"),r.innerHTML="description",(s=document.createElement("span")).setAttribute("title","The default value of this attribute"),s.innerHTML="def.",a.appendChild(n),a.appendChild(r),a.appendChild(s),document.getElementById("attribute_options").appendChild(a);var o;t=_via_attributes[_via_attribute_being_updated][e].options;for(o in t){attribute_property_add_option(e,o,t[o],_via_attributes[_via_attribute_being_updated][e].default_options[o],i)}attribute_property_add_new_entry_option(e,i);break;default:console.log("Attribute type "+i+" is unavailable")}}}function attribute_property_add_input_property(_,e,i,t){var a=document.createElement("div");a.setAttribute("class","property");var n=document.createElement("span");n.setAttribute("title",_),n.innerHTML=e;var r=document.createElement("span"),s=document.createElement("input");s.setAttribute("onchange","attribute_property_on_update(this)"),void 0!==i&&s.setAttribute("value",i),s.setAttribute("id",t),r.appendChild(s),a.appendChild(n),a.appendChild(r),document.getElementById("attribute_properties").appendChild(a)}function attribute_property_add_option(_,e,i,t,a){var n=document.createElement("div");n.setAttribute("class","property");var r=document.createElement("span"),s=document.createElement("input");s.setAttribute("type","text"),s.setAttribute("value",e),s.setAttribute("title",e),s.setAttribute("onchange","attribute_property_on_option_update(this)"),s.setAttribute("id","_via_attribute_option_id_"+e);var o=document.createElement("span"),g=document.createElement("input");if(g.setAttribute("type","text"),a===VIA_ATTRIBUTE_TYPE.IMAGE){var l=i.length+" bytes of base64 image data";g.setAttribute("value",l),g.setAttribute("title","To update, copy and paste base64 image data in this text box")}else g.setAttribute("value",i),g.setAttribute("title",i);g.setAttribute("onchange","attribute_property_on_option_update(this)"),g.setAttribute("id","_via_attribute_option_description_"+e);var d=document.createElement("span"),v=document.createElement("input");v.setAttribute("type",a),void 0!==t&&(v.checked=t),"radio"!==a&&"image"!==a&&"dropdown"!==a||(v.setAttribute("type","radio"),v.setAttribute("name",_)),v.setAttribute("onchange","attribute_property_on_option_update(this)"),v.setAttribute("id","_via_attribute_option_default_"+e),r.appendChild(s),o.appendChild(g),d.appendChild(v),n.appendChild(r),n.appendChild(o),n.appendChild(d),document.getElementById("attribute_options").appendChild(n)}function attribute_property_add_new_entry_option(_,e){var i=document.createElement("div");i.setAttribute("class","new_option_id_entry");var t=document.createElement("input");t.setAttribute("type","text"),t.setAttribute("onchange","attribute_property_on_option_add(this)"),t.setAttribute("id","_via_attribute_new_option_id"),t.setAttribute("placeholder","Add new option id"),i.appendChild(t),document.getElementById("attribute_options").appendChild(i)}function attribute_property_on_update(_){var e=get_current_attribute_id(),i=_via_attribute_being_updated,t=_.value;switch(_.id){case"attribute_name":t!==e&&(Object.defineProperty(_via_attributes[i],t,Object.getOwnPropertyDescriptor(_via_attributes[i],e)),delete _via_attributes[i][e],update_attributes_update_panel(),annotation_editor_update_content());break;case"attribute_description":_via_attributes[i][e].description=t,update_attributes_update_panel(),annotation_editor_update_content();break;case"attribute_default_value":_via_attributes[i][e].default_value=t,update_attributes_update_panel(),annotation_editor_update_content();break;case"attribute_type":var a=_via_attributes[i][e].type;if(_via_attributes[i][e].type=t,t===VIA_ATTRIBUTE_TYPE.TEXT)_via_attributes[i][e].default_value="",delete _via_attributes[i][e].options,delete _via_attributes[i][e].default_options;else{_via_attributes[i][e].hasOwnProperty("options")||(_via_attributes[i][e].options={},_via_attributes[i][e].default_options={}),_via_attributes[i][e].hasOwnProperty("default_value")&&delete _via_attributes[i][e].default_value;var n=attribute_get_unique_values(i,e);for(var r in _via_attributes[i][e].options)n.includes(r)||(_via_attributes[i][e].options[r]=r);for(var s in _via_img_metadata)for(var o in _via_img_metadata[s].regions)if(_via_img_metadata[s].regions[o].region_attributes.hasOwnProperty(e)){if(a===VIA_ATTRIBUTE_TYPE.CHECKBOX&&(t===VIA_ATTRIBUTE_TYPE.RADIO||t===VIA_ATTRIBUTE_TYPE.DROPDOWN)){var g,l=0;for(var r in _via_img_metadata[s].regions[o].region_attributes[e])_via_img_metadata[s].regions[o].region_attributes[e][r]&&(l+=1,g=r);1===l?_via_img_metadata[s].regions[o].region_attributes[e]=g:delete _via_img_metadata[s].regions[o].region_attributes[e]}if((a===VIA_ATTRIBUTE_TYPE.RADIO||a===VIA_ATTRIBUTE_TYPE.DROPDOWN)&&t===VIA_ATTRIBUTE_TYPE.CHECKBOX){var d=_via_img_metadata[s].regions[o].region_attributes[e];_via_img_metadata[s].regions[o].region_attributes[e]={},_via_img_metadata[s].regions[o].region_attributes[e][d]=!0}}}show_attribute_properties(),show_attribute_options(),annotation_editor_update_content()}}function attribute_get_unique_values(_,e){var i=[];switch(_){case"file":for(t in _via_img_metadata)_via_img_metadata[t].file_attributes.hasOwnProperty(e)&&(a=_via_img_metadata[t].file_attributes[e],i.includes(a)||i.push(a));break;case"region":var t,a,n;for(t in _via_img_metadata)for(n=0;n<_via_img_metadata[t].regions.length;++n)if(_via_img_metadata[t].regions[n].region_attributes.hasOwnProperty(e))if("object"==typeof(a=_via_img_metadata[t].regions[n].region_attributes[e]))for(var r in _via_img_metadata[t].regions[n].region_attributes[e])i.includes(r)||i.push(r);else i.includes(a)||i.push(a)}return i}function attribute_property_on_option_update(_){var e=get_current_attribute_id();if(_.id.startsWith("_via_attribute_option_id_")){var i=_.id.substr("_via_attribute_option_id_".length),t=_.value;if(i!==t){var a=attribute_property_option_id_is_valid(e,t);return void(a.is_valid?update_attribute_option_id_with_confirm(_via_attribute_being_updated,e,i,t):(_.value=i,show_message(a.message),show_attribute_properties()))}}if(_.id.startsWith("_via_attribute_option_description_")){var n=_.id.substr("_via_attribute_option_description_".length),r=_via_attributes[_via_attribute_being_updated][e].options[n],s=_.value;s!==r&&(_via_attributes[_via_attribute_being_updated][e].options[n]=s,show_attribute_properties(),annotation_editor_update_content())}if(_.id.startsWith("_via_attribute_option_default_")){var o=_.id.substr("_via_attribute_option_default_".length);if(0===Object.keys(_via_attributes[_via_attribute_being_updated][e].default_options).length)_via_attributes[_via_attribute_being_updated][e].default_options[o]=_.checked;else switch(_via_attributes[_via_attribute_being_updated][e].type){case"image":case"dropdown":case"radio":_via_attributes[_via_attribute_being_updated][e].default_options={},_via_attributes[_via_attribute_being_updated][e].default_options[o]=_.checked;break;case"checkbox":_via_attributes[_via_attribute_being_updated][e].default_options[o]=_.checked}attribute_property_on_option_default_update(_via_attribute_being_updated,e,o).then(function(){show_attribute_properties(),annotation_editor_update_content()})}}function attribute_property_on_option_default_update(_,e,i){return new Promise(function(t,a){var n,r,s;_via_attributes[_][e].type;switch(_){case"file":for(n in _via_img_metadata)_via_img_metadata[n].file_attributes.hasOwnProperty(e)||(_via_img_metadata[n].file_attributes[e]=i);break;case"region":for(n in _via_img_metadata)for(r=_via_img_metadata[n].regions.length,s=0;s<r;++s)_via_img_metadata[n].regions[s].region_attributes.hasOwnProperty(e)||(_via_img_metadata[n].regions[s].region_attributes[e]=i)}t()})}function attribute_property_on_option_add(_){if(""!==_.value&&null!==_.value&&"_via_attribute_new_option_id"===_.id){var e=get_current_attribute_id(),i=_.value,t=attribute_property_option_id_is_valid(e,i);t.is_valid?(_via_attributes[_via_attribute_being_updated][e].options[i]="",show_attribute_options(),annotation_editor_update_content()):(show_message(t.message),attribute_property_reset_new_entry_inputs())}}function attribute_property_reset_new_entry_inputs(){var _=document.getElementById("attribute_options").lastChild;_.childNodes[0]&&(_.childNodes[0].value=""),_.childNodes[1]&&(_.childNodes[1].value="")}function attribute_property_show_new_entry_inputs(_,e){var i=document.createElement("div");i.classList.add("property");var t=document.createElement("span"),a=document.createElement("input");a.setAttribute("onchange","attribute_property_on_option_add(this)"),a.setAttribute("placeholder","Add new id"),a.setAttribute("value",""),a.setAttribute("id","_via_attribute_new_option_id"),t.appendChild(a);var n=document.createElement("span"),r=document.createElement("input");r.setAttribute("onchange","attribute_property_on_option_add(this)"),r.setAttribute("placeholder","Optional description"),r.setAttribute("value",""),r.setAttribute("id","_via_attribute_new_option_description"),n.appendChild(r);var s=document.createElement("span"),o=document.createElement("input");o.setAttribute("type",e),"radio"===e&&o.setAttribute("name",_),o.setAttribute("onchange","attribute_property_on_option_add(this)"),o.setAttribute("id","_via_attribute_new_option_default"),s.appendChild(o),i.appendChild(t),i.appendChild(n),i.appendChild(s),document.getElementById("attribute_options").appendChild(i)}function attribute_property_option_id_is_valid(_,e){var i;for(i in _via_attributes[_via_attribute_being_updated][_].options)if(i===e)return{is_valid:!1,message:"Option id ["+_+"] already exists"};return e.includes("__")?{is_valid:!1,message:"Option id cannot contain two consecutive underscores"}:{is_valid:!0}}function attribute_property_id_exists(_){var e;for(e in _via_attributes[_via_attribute_being_updated])if(e===_)return!0;return!1}function delete_existing_attribute_with_confirm(){var _=document.getElementById("user_input_attribute_id").value;""!==_?attribute_property_id_exists(_)?invoke_with_user_inputs(delete_existing_attribute_confirmed,{attr_type:{type:"text",name:"Attribute Type",value:_via_attribute_being_updated,disabled:!0},attr_id:{type:"text",name:"Attribute Id",value:_,disabled:!0}},{title:"Delete "+_via_attribute_being_updated+" attribute ["+_+"]",warning:"Warning: Deleting an attribute will lead to the attribute being deleted in all the annotations. Please click OK only if you are sure."}):show_message("Attribute ["+_+"] does not exist!"):show_message("Enter the name of attribute that you wish to delete")}function delete_existing_attribute_confirmed(_){var e=_.attr_type.value,i=_.attr_id.value;delete_existing_attribute(e,i),document.getElementById("user_input_attribute_id").value="",show_message("Deleted "+e+" attribute ["+i+"]"),user_input_default_cancel_handler()}function delete_existing_attribute(_,e){if(_via_attributes[_].hasOwnProperty(e)){var i=Object.keys(_via_attributes[_]);if(1===i.length)_via_current_attribute_id="";else{var t=i.indexOf(e),a=t+1;a===i.length&&(a=t-1),_via_current_attribute_id=i[a]}delete _via_attributes[_][e],delete_region_attribute_in_all_metadata(e),update_attributes_update_panel(),annotation_editor_update_content()}}function add_new_attribute_from_user_input(){var _=document.getElementById("user_input_attribute_id").value;""!==_?attribute_property_id_exists(_)?show_message("The "+_via_attribute_being_updated+" attribute ["+_+"] already exists."):(_via_current_attribute_id=_,add_new_attribute(_),update_attributes_update_panel(),annotation_editor_update_content(),show_message("Added "+_via_attribute_being_updated+" attribute ["+_+"].")):show_message("Enter the name of attribute that you wish to delete")}function add_new_attribute(_){_via_attributes[_via_attribute_being_updated][_]={},_via_attributes[_via_attribute_being_updated][_].type="text",_via_attributes[_via_attribute_being_updated][_].description="",_via_attributes[_via_attribute_being_updated][_].default_value=""}function update_current_attribute_id(_){_via_current_attribute_id=_.options[_.selectedIndex].value,update_attribute_properties_panel()}function get_current_attribute_id(){return document.getElementById("attributes_name_list").value}function update_attribute_option_id_with_confirm(_,e,i,t){var a,n=!1;""===t||void 0===t?(a={title:"Delete an option for "+_+" attribute"},n=!0):a={title:"Rename an option for "+_+" attribute"};var r={attr_type:{type:"text",name:"Attribute Type",value:_,disabled:!0},attr_id:{type:"text",name:"Attribute Id",value:e,disabled:!0}};n?r.option_id={type:"text",name:"Attribute Option",value:i,disabled:!0}:(r.option_id={type:"text",name:"Attribute Option (old)",value:i,disabled:!0},r.new_option_id={type:"text",name:"Attribute Option (new)",value:t,disabled:!0}),invoke_with_user_inputs(update_attribute_option_id_confirmed,r,a,update_attribute_option_id_cancel)}function update_attribute_option_id_cancel(_){update_attribute_properties_panel()}function update_attribute_option_id_confirmed(_){var e,i,t=_.attr_type.value,a=_.attr_id.value,n=_.option_id.value;void 0===_.new_option_id||""===_.new_option_id?(e=!0,i=""):(e=!1,i=_.new_option_id.value),update_attribute_option(e,t,a,n,i),show_message(e?"Deleted option ["+n+"] for "+t+" attribute ["+a+"].":"Renamed option ["+n+"] to ["+i+"] for "+t+" attribute ["+a+"]."),update_attribute_properties_panel(),annotation_editor_update_content(),user_input_default_cancel_handler()}function update_attribute_option(_,e,i,t,a){switch(e){case"region":update_region_attribute_option_in_all_metadata(_,i,t,a),_||Object.defineProperty(_via_attributes[e][i].options,a,Object.getOwnPropertyDescriptor(_via_attributes[_via_attribute_being_updated][i].options,t)),delete _via_attributes.region[i].options[t];break;case"file":update_file_attribute_option_in_all_metadata(i,t),_||Object.defineProperty(_via_attributes[e][i].options,a,Object.getOwnPropertyDescriptor(_via_attributes[_via_attribute_being_updated][i].options,t)),delete _via_attributes.file[i].options[t]}}function update_file_attribute_option_in_all_metadata(_,e,i,t){var a;for(a in _via_img_metadata)_via_img_metadata[a].file_attributes.hasOwnProperty(e)&&_via_img_metadata[a].file_attributes[e].hasOwnProperty(i)&&(Object.defineProperty(_via_img_metadata[a].file_attributes[e],t,Object.getOwnPropertyDescriptor(_via_img_metadata[a].file_attributes[e],i)),delete _via_img_metadata[a].file_attributes[e][i])}function update_region_attribute_option_in_all_metadata(_,e,i,t){var a;for(a in _via_img_metadata)for(var n=0;n<_via_img_metadata[a].regions.length;++n)_via_img_metadata[a].regions[n].region_attributes.hasOwnProperty(e)&&_via_img_metadata[a].regions[n].region_attributes[e].hasOwnProperty(i)&&(Object.defineProperty(_via_img_metadata[a].regions[n].region_attributes[e],t,Object.getOwnPropertyDescriptor(_via_img_metadata[a].regions[n].region_attributes[e],i)),delete _via_img_metadata[a].regions[n].region_attributes[e][i])}function delete_region_attribute_in_all_metadata(_){var e;for(e in _via_img_metadata)for(var i=0;i<_via_img_metadata[e].regions.length;++i)_via_img_metadata[e].regions[i].region_attributes.hasOwnProperty(_)&&delete _via_img_metadata[e].regions[i].region_attributes[_]}function delete_file_attribute_option_from_all_metadata(_,e){var i;for(i in _via_img_metadata)_via_img_metadata.hasOwnProperty(i)&&delete_file_attribute_option_from_metadata(i,_,e)}function delete_file_attribute_option_from_metadata(_,e,i){_via_img_metadata[_].file_attributes.hasOwnProperty(e)&&_via_img_metadata[_].file_attributes[e].hasOwnProperty(i)&&delete _via_img_metadata[_].file_attributes[e][i]}function delete_file_attribute_from_all_metadata(_,e){for(_ in _via_img_metadata)_via_img_metadata.hasOwnProperty(_)&&_via_img_metadata[_].file_attributes.hasOwnProperty(e)&&delete _via_img_metadata[_].file_attributes[e]}function invoke_with_user_inputs(_,e,i,t){setup_user_input_panel(_,e,i,t),show_user_input_panel()}function setup_user_input_panel(_,e,i,t){_via_user_input_ok_handler=_,_via_user_input_cancel_handler=t,_via_user_input_data=e;var a=document.getElementById("user_input_panel"),n=document.createElement("div");n.setAttribute("class","content");var r,s=[];for(r in s.push('<p class="title">'+i.title+"</p>"),s.push('<div class="user_inputs">'),_via_user_input_data){s.push('<div class="row">'),s.push('<span class="cell">'+_via_user_input_data[r].name+"</span>");var o="";_via_user_input_data[r].disabled&&(o='disabled="disabled"');var g="";switch(_via_user_input_data[r].value&&(g='value="'+_via_user_input_data[r].value+'"'),_via_user_input_data[r].type){case"checkbox":g=_via_user_input_data[r].checked?'checked="checked"':"",s.push('<span class="cell"><input class="_via_user_input_variable" '+g+" "+o+' type="checkbox" id="'+r+'"></span>');break;case"text":var l="50";_via_user_input_data[r].size&&(l=_via_user_input_data[r].size);var d="";_via_user_input_data[r].placeholder&&(d=_via_user_input_data[r].placeholder),s.push('<span class="cell"><input class="_via_user_input_variable" '+g+" "+o+' size="'+l+'" placeholder="'+d+'" type="text" id="'+r+'"></span>');break;case"textarea":var v="5",c="50";_via_user_input_data[r].rows&&(v=_via_user_input_data[r].rows),_via_user_input_data[r].cols&&(c=_via_user_input_data[r].cols);d="";_via_user_input_data[r].placeholder&&(d=_via_user_input_data[r].placeholder),s.push('<span class="cell"><textarea class="_via_user_input_variable" '+o+' rows="'+v+'" cols="'+c+'" placeholder="'+d+'" id="'+r+'">'+g+"</textarea></span>")}s.push("</div>")}s.push("</div>"),i.hasOwnProperty("warning")&&s.push('<div class="warning">'+i.warning+"</div>"),s.push('<div class="user_confirm"><span class="ok"><button id="user_input_ok_button" onclick="user_input_parse_and_invoke_handler()">&nbsp;OK&nbsp;</button></span><span class="cancel"><button id="user_input_cancel_button" onclick="user_input_cancel_handler()">CANCEL</button></span></div>'),n.innerHTML=s.join(""),a.innerHTML="",a.appendChild(n)}function user_input_default_cancel_handler(){hide_user_input_panel(),_via_user_input_data={},_via_user_input_ok_handler=null,_via_user_input_cancel_handler=null}function user_input_cancel_handler(){_via_user_input_cancel_handler&&_via_user_input_cancel_handler(),user_input_default_cancel_handler()}function user_input_parse_and_invoke_handler(){var _,e=document.getElementsByClassName("_via_user_input_variable");for(_=0;_<e.length;++_){var i=e[_].id;if(_via_user_input_data.hasOwnProperty(i))switch(_via_user_input_data[i].type){case"checkbox":_via_user_input_data[i].value=e[_].checked;break;default:_via_user_input_data[i].value=e[_].value}}void 0!==_via_user_input_data.confirm?_via_user_input_data.confirm.value?_via_user_input_ok_handler(_via_user_input_data):_via_user_input_cancel_handler&&_via_user_input_cancel_handler():_via_user_input_ok_handler(_via_user_input_data),user_input_default_cancel_handler()}function show_user_input_panel(){document.getElementById("user_input_panel").style.display="block"}function hide_user_input_panel(){document.getElementById("user_input_panel").style.display="none"}function annotation_editor_show(){annotation_editor_remove();var _=document.createElement("div");if(_.setAttribute("id","annotation_editor"),_via_annotation_editor_mode===VIA_ANNOTATION_EDITOR_MODE.SINGLE_REGION){if(_via_settings.ui.image.on_image_annotation_editor_placement===VIA_ANNOTATION_EDITOR_PLACEMENT.DISABLE)return;if(_via_is_region_selected&&Object.keys(_via_attributes.region).length&&_via_attributes.region.constructor===Object){if(_.classList.add("force_small_font"),_.classList.add("display_area_content"),_via_settings.ui.image.on_image_annotation_editor_placement===VIA_ANNOTATION_EDITOR_PLACEMENT.NEAR_REGION){var e=annotation_editor_get_placement(_via_user_sel_region_id);_.style.top=e.top,_.style.left=e.left}_via_display_area.appendChild(_),annotation_editor_update_content(),update_vertical_space()}}else _via_annotaion_editor_panel.appendChild(_),annotation_editor_update_content(),update_vertical_space(),_via_is_region_selected&&(annotation_editor_scroll_to_row(_via_user_sel_region_id),annotation_editor_highlight_row(_via_user_sel_region_id))}function annotation_editor_hide(){_via_annotation_editor_mode===VIA_ANNOTATION_EDITOR_MODE.SINGLE_REGION?annotation_editor_remove():annotation_editor_clear_row_highlight()}function annotation_editor_toggle_on_image_editor(){_via_settings.ui.image.on_image_annotation_editor_placement===VIA_ANNOTATION_EDITOR_PLACEMENT.DISABLE?(_via_annotation_editor_mode=VIA_ANNOTATION_EDITOR_MODE.SINGLE_REGION,_via_settings.ui.image.on_image_annotation_editor_placement=VIA_ANNOTATION_EDITOR_PLACEMENT.NEAR_REGION,annotation_editor_show(),show_message("Enabled on image annotation editor")):(_via_settings.ui.image.on_image_annotation_editor_placement=VIA_ANNOTATION_EDITOR_PLACEMENT.DISABLE,VIA_ANNOTATION_EDITOR_MODE.ALL_REGIONS,annotation_editor_hide(),show_message("Disabled on image annotation editor"))}function annotation_editor_update_content(){return new Promise(function(_,e){var i=document.getElementById("annotation_editor");i&&(i.innerHTML="",annotation_editor_update_header_html(),annotation_editor_update_metadata_html()),_()})}function annotation_editor_get_placement(_){var e={},i=_via_canvas_regions[_].shape_attributes;switch(i.name){case"rect":e.top=i.y+i.height,e.left=i.x+i.width;break;case"circle":e.top=i.cy+i.r,e.left=i.cx;break;case"ellipse":e.top=i.cy+i.ry*Math.cos(i.theta),e.left=i.cx-i.ry*Math.sin(i.theta);break;case"polygon":case"polyline":var t=Object.keys(i.all_points_x).reduce(function(_,e){return i.all_points_x[_]>i.all_points_x[e]?_:e});e.top=Math.max(i.all_points_y[t]),e.left=Math.max(i.all_points_x[t]);break;case"point":e.top=i.cy,e.left=i.cx}return e.top=e.top+_via_img_panel.offsetTop+VIA_REGION_EDGE_TOL+"px",e.left=e.left+_via_img_panel.offsetLeft+VIA_REGION_EDGE_TOL+"px",e}function annotation_editor_remove(){var _=document.getElementById("annotation_editor");_&&_.remove()}function is_annotation_editor_visible(){return document.getElementById("annotation_editor_panel").classList.contains("display_block")}function annotation_editor_toggle_all_regions_editor(){var _=document.getElementById("annotation_editor_panel");_.classList.contains("display_block")?(_.classList.remove("display_block"),_via_annotation_editor_mode=VIA_ANNOTATION_EDITOR_MODE.SINGLE_REGION):(_via_annotation_editor_mode=VIA_ANNOTATION_EDITOR_MODE.ALL_REGIONS,_.classList.add("display_block"),_.style.height=_via_settings.ui.annotation_editor_height+"%",_.style.fontSize=_via_settings.ui.annotation_editor_fontsize+"rem",annotation_editor_show())}function annotation_editor_set_active_button(){var _;for(_ in _via_attributes){var e="button_edit_"+_+"_metadata";document.getElementById(e).classList.remove("active")}e="button_edit_"+_via_metadata_being_updated+"_metadata";document.getElementById(e).classList.add("active")}function edit_region_metadata_in_annotation_editor(){_via_metadata_being_updated="region",annotation_editor_set_active_button(),annotation_editor_update_content()}function edit_file_metadata_in_annotation_editor(){_via_metadata_being_updated="file",annotation_editor_set_active_button(),annotation_editor_update_content()}function annotation_editor_update_header_html(){var _,e,i=document.createElement("div");(i.setAttribute("class","row"),i.setAttribute("id","annotation_editor_header"),"region"===_via_metadata_being_updated)&&((_=document.createElement("span")).setAttribute("class","col"),_.innerHTML="",i.appendChild(_));"file"===_via_metadata_being_updated&&((_=document.createElement("span")).setAttribute("class","col header"),_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID?_.innerHTML="group":_.innerHTML="filename",i.appendChild(_));for(e in _via_attributes[_via_metadata_being_updated]){var t=document.createElement("span");t.setAttribute("class","col header"),t.innerHTML=e,i.appendChild(t)}var a=document.getElementById("annotation_editor");0===a.childNodes.length?a.appendChild(i):"annotation_editor_header"===a.firstChild.id?a.replaceChild(i,a.firstChild):a.insertBefore(i,a.firstChild)}function annotation_editor_update_metadata_html(){if(_via_img_count){var _=document.getElementById("annotation_editor");switch(_via_metadata_being_updated){case"region":var e;if(_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID)_.appendChild(annotation_editor_get_metadata_row_html(0));else if(_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE)if(_via_annotation_editor_mode===VIA_ANNOTATION_EDITOR_MODE.SINGLE_REGION)_.appendChild(annotation_editor_get_metadata_row_html(_via_user_sel_region_id));else for(e=0;e<_via_img_metadata[_via_image_id].regions.length;++e)_.appendChild(annotation_editor_get_metadata_row_html(e));break;case"file":_.appendChild(annotation_editor_get_metadata_row_html(0))}}}function annotation_editor_update_row(_){var e=document.getElementById("annotation_editor"),i=annotation_editor_get_metadata_row_html(_),t=document.getElementById(i.getAttribute("id"));e.replaceChild(i,t)}function annotation_editor_add_row(_){if(is_annotation_editor_visible()){var e=document.getElementById("annotation_editor"),i=annotation_editor_get_metadata_row_html(_),t=parseInt(_)-1;if(t>=0){var a="ae_"+_via_metadata_being_updated+"_"+t,n=document.getElementById(a);e.insertBefore(i,n.nextSibling)}else e.appendChild(i)}}function annotation_editor_get_metadata_row_html(_){var e,i=document.createElement("div");if(i.setAttribute("class","row"),i.setAttribute("id","ae_"+_via_metadata_being_updated+"_"+_),"region"===_via_metadata_being_updated){var t=document.createElement("span");switch(_via_display_area_content_name){case VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID:t.setAttribute("class","col"),t.innerHTML="Grouped regions in "+_via_image_grid_selected_img_index_list.length+" files";break;case VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE:t.setAttribute("class","col id"),t.innerHTML=_+1}i.appendChild(t)}if("file"===_via_metadata_being_updated){switch((t=document.createElement("span")).setAttribute("class","col"),_via_display_area_content_name){case VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID:t.innerHTML="Group of "+_via_image_grid_selected_img_index_list.length+" files";break;case VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE:t.innerHTML=_via_image_filename_list[_via_image_index]}i.appendChild(t)}for(e in _via_attributes[_via_metadata_being_updated]){var a=document.createElement("span");a.setAttribute("class","col");var n=_via_attributes[_via_metadata_being_updated][e].type,r=_via_attributes[_via_metadata_being_updated][e].desc;void 0===r&&(r="");var s=e+"__"+_,o="",g="";if(_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE)switch(_via_metadata_being_updated){case"region":_via_img_metadata[_via_image_id].regions[_].region_attributes.hasOwnProperty(e)?o=_via_img_metadata[_via_image_id].regions[_].region_attributes[e]:g="not defined yet!";case"file":_via_img_metadata[_via_image_id].file_attributes.hasOwnProperty(e)?o=_via_img_metadata[_via_image_id].file_attributes[e]:g="not defined yet!"}if(_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID){var l;switch(_via_metadata_being_updated){case"region":l=_via_get_region_metadata_stat(_via_image_grid_selected_img_index_list,e);break;case"file":l=_via_get_file_metadata_stat(_via_image_grid_selected_img_index_list,e)}switch(n){case"text":if(l.hasOwnProperty(e))if((d=Object.keys(l[e])).includes("undefined"))o="",g="includes "+l[e][void 0]+" undefined values";else switch(d.length){case 0:o="",g="not applicable";break;case 1:o=d[0],g="";break;default:o="",g=d.length+" different values: "+JSON.stringify(d).replace(/"/g,"'")}else o="",g="not defined yet!";break;case"radio":case"dropdown":case"image":if(l.hasOwnProperty(e))o=1===(d=Object.keys(l[e])).length?d[0]:"";else o="";break;case"checkbox":if(o={},l.hasOwnProperty(e)){var d,v,c,u,m,p,h=!0;for(c=(d=Object.keys(l[e])).length,v=0;v<c-1;++v)if(u=d[v],m=d[v+1],l[e][u]!==l[e][m]){h=!1;break}if(h)for(p in l[e])o[p]=!0}}}switch(n){case"text":a.innerHTML='<textarea onchange="annotation_editor_on_metadata_update(this)" onfocus="annotation_editor_on_metadata_focus(this)" title="'+r+'" placeholder="'+g+'" id="'+s+'">'+o+"</textarea>";break;case"checkbox":var f=_via_attributes[_via_metadata_being_updated][e].options;for(y in f){var b=s+"__"+y;(x=document.createElement("input")).setAttribute("type","checkbox"),x.setAttribute("value",y),x.setAttribute("id",b),x.setAttribute("onfocus","annotation_editor_on_metadata_focus(this)"),x.setAttribute("onchange","annotation_editor_on_metadata_update(this)"),""!==(N=_via_attributes[_via_metadata_being_updated][e].options[y])&&void 0!==N||(N=y),void 0!==o&&o.hasOwnProperty(y)&&(x.checked=o[y]),(I=document.createElement("label")).setAttribute("for",b),I.innerHTML=N,(A=document.createElement("span")).appendChild(x),A.appendChild(I),a.appendChild(A)}break;case"radio":for(y in _via_attributes[_via_metadata_being_updated][e].options){b=s+"__"+y;(x=document.createElement("input")).setAttribute("type","radio"),x.setAttribute("name",s),x.setAttribute("value",y),x.setAttribute("id",b),x.setAttribute("onfocus","annotation_editor_on_metadata_focus(this)"),x.setAttribute("onchange","annotation_editor_on_metadata_update(this)"),""!==(N=_via_attributes[_via_metadata_being_updated][e].options[y])&&void 0!==N||(N=y),o===y&&(x.checked=!0),(I=document.createElement("label")).setAttribute("for",b),I.innerHTML=N,(A=document.createElement("span")).appendChild(x),A.appendChild(I),a.appendChild(A)}break;case"image":for(y in _via_attributes[_via_metadata_being_updated][e].options)1;var E=document.createElement("div");E.setAttribute("class","img_options"),a.appendChild(E);for(y in _via_attributes[_via_metadata_being_updated][e].options){var I,A;b=s+"__"+y;(x=document.createElement("input")).setAttribute("type","radio"),x.setAttribute("name",s),x.setAttribute("value",y),x.setAttribute("id",b),x.setAttribute("onfocus","annotation_editor_on_metadata_focus(this)"),x.setAttribute("onchange","annotation_editor_on_metadata_update(this)"),""!==(N=_via_attributes[_via_metadata_being_updated][e].options[y])&&void 0!==N||(N=y),o===y&&(x.checked=!0),(I=document.createElement("label")).setAttribute("for",b),I.innerHTML='<img src="'+N+'"><p>'+y+"</p>",(A=document.createElement("span")).appendChild(x),A.appendChild(I),E.appendChild(A)}break;case"dropdown":var y,O=document.createElement("select");O.setAttribute("id",s),O.setAttribute("onfocus","annotation_editor_on_metadata_focus(this)"),O.setAttribute("onchange","annotation_editor_on_metadata_update(this)");var w=!1;for(y in _via_attributes[_via_metadata_being_updated][e].options){var x,N;b=s+"__"+y;(x=document.createElement("option")).setAttribute("value",y),""!==(N=_via_attributes[_via_metadata_being_updated][e].options[y])&&void 0!==N||(N=y),y===o&&(x.setAttribute("selected","selected"),w=!0),x.innerHTML=N,O.appendChild(x)}w||(O.selectedIndex="-1"),a.appendChild(O)}i.appendChild(a)}return i}function annotation_editor_scroll_to_row(_){if(is_annotation_editor_visible()){var e="ae_"+_via_metadata_being_updated+"_"+_;document.getElementById(e).scrollIntoView(!1)}}function annotation_editor_highlight_row(_){if(is_annotation_editor_visible()){var e="ae_"+_via_metadata_being_updated+"_"+_;document.getElementById(e).classList.add("highlight")}}function annotation_editor_clear_row_highlight(){if(is_annotation_editor_visible()){var _,e=document.getElementById("annotation_editor");for(_=0;_<e.childNodes.length;++_)e.childNodes[_].classList.remove("highlight")}}function annotation_editor_extract_html_id_components(_){var e=_.split("__"),i={};switch(e.length){case 3:i.attr_id=e[0],i.row_id=e[1],i.option_id=e[2];break;case 2:i.attr_id=e[0],i.row_id=e[1]}return i}function _via_get_file_metadata_stat(_,e){var i,t,a,n,r,s={};for(s[e]={},t=_.length,i=0;i<t;++i){var o;if(n=_[i],a=_via_image_id_list[n],_via_img_metadata[a].file_attributes.hasOwnProperty(e))if("object"==typeof(r=_via_img_metadata[a].file_attributes[e]))for(o in r)s[e].hasOwnProperty(o)?s[e][o]+=1:s[e][o]=1;else s[e].hasOwnProperty(r)?s[e][r]+=1:s[e][r]=1}return s}function _via_get_region_metadata_stat(_,e){var i,t,a,n,r,s,o,g={};for(g[e]={},t=_.length,i=0;i<t;++i)for(n=_[i],a=_via_image_id_list[n],o=_via_img_metadata[a].regions.length,s=0;s<o;++s){var l;if(image_grid_is_region_in_current_group(_via_img_metadata[a].regions[s].region_attributes))if("object"==typeof(r=_via_img_metadata[a].regions[s].region_attributes[e]))for(l in r)g[e].hasOwnProperty(l)?g[e][l]+=1:g[e][l]=1;else g[e].hasOwnProperty(r)?g[e][r]+=1:g[e][r]=1}return g}function annotation_editor_on_metadata_focus(_){if(_via_annotation_editor_mode===VIA_ANNOTATION_EDITOR_MODE.ALL_REGIONS){var e=annotation_editor_extract_html_id_components(_.id).row_id;toggle_all_regions_selection(!1),annotation_editor_clear_row_highlight(),set_region_select_state(e,!0),annotation_editor_scroll_to_row(e),annotation_editor_highlight_row(e),_via_redraw_reg_canvas()}}function annotation_editor_on_metadata_update(_){var e=annotation_editor_extract_html_id_components(_.id),i=[_via_image_index],t=e.row_id;_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID&&(i=_via_image_grid_selected_img_index_list.slice(0),t=-1),"file"!==_via_metadata_being_updated?"region"!==_via_metadata_being_updated||annotation_editor_update_region_metadata(i,t,e.attr_id,_.value,_.checked).then(function(_){annotation_editor_on_metadata_update_done("region",e.attr_id,_)},function(_){show_message("Failed to update region attributes! ")}):annotation_editor_update_file_metadata(i,e.attr_id,_.value,_.checked).then(function(_){annotation_editor_on_metadata_update_done("file",e.attr_id,_)},function(_){console.log(_),show_message("Failed to update file attributes! "+_)})}function annotation_editor_on_metadata_update_done(_,e,i){var t,a;show_message("Updated "+_+" attributes of "+i+" "+_+"s"),a=_via_image_grid_group_var.length;var n=!1;for(t=0;t<a;++t)if(_via_image_grid_group_var[t].type===_&&_via_image_grid_group_var[t].name===e){n=!0;break}_via_regions_group_color_init(),_via_redraw_reg_canvas(),_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID&&n&&image_grid_show_all_project_images()}function annotation_editor_update_file_metadata(_,e,i,t){return new Promise(function(a,n){var r,s,o,g;s=_.length;var l=0;for(r=0;r<s;++r)switch(g=_[r],o=_via_image_id_list[g],_via_attributes.file[e].type){case"text":case"radio":case"dropdown":case"image":_via_img_metadata[o].file_attributes[e]=i,l+=1;break;case"checkbox":var d=i;if(_via_img_metadata[o].file_attributes.hasOwnProperty(e)){if("object"!=typeof _via_img_metadata[o].file_attributes[e]){var v=_via_img_metadata[o].file_attributes[e];_via_img_metadata[o].file_attributes[e]={},Object.keys(_via_attributes.file[e].options).includes(v)&&(_via_img_metadata[o].file_attributes[e]={},_via_img_metadata[o].file_attributes[e][v]=!0)}}else _via_img_metadata[o].file_attributes[e]={};t?_via_img_metadata[o].file_attributes[e][d]=!0:delete _via_img_metadata[o].file_attributes[e][d],l+=1}a(l)})}function annotation_editor_update_region_metadata(_,e,i,t,a){return new Promise(function(n,r){var s,o,g,l;o=_.length;var d,v,c=0;if(-1===e){for(s=0;s<o;++s)for(l=_[s],g=_via_image_id_list[l],v=_via_img_metadata[g].regions.length,d=0;d<v;++d)if(image_grid_is_region_in_current_group(_via_img_metadata[g].regions[d].region_attributes))switch(_via_attributes.region[i].type){case"text":case"dropdown":case"radio":case"image":_via_img_metadata[g].regions[d].region_attributes[i]=t,c+=1;break;case"checkbox":var u=t;if(_via_img_metadata[g].regions[d].region_attributes.hasOwnProperty(i)){if("object"!=typeof _via_img_metadata[g].regions[d].region_attributes[i]){var m=_via_img_metadata[g].regions[d].region_attributes[i];_via_img_metadata[g].regions[d].region_attributes[i]={},Object.keys(_via_attributes.region[i].options).includes(m)&&(_via_img_metadata[g].regions[d].region_attributes[i][m]=!0)}}else _via_img_metadata[g].regions[d].region_attributes[i]={};a?_via_img_metadata[g].regions[d].region_attributes[i][u]=!0:delete _via_img_metadata[g].regions[d].region_attributes[i][u],c+=1}}else for(s=0;s<o;++s)switch(l=_[s],g=_via_image_id_list[l],_via_attributes.region[i].type){case"text":case"dropdown":case"radio":case"image":_via_img_metadata[g].regions[e].region_attributes[i]=t,c+=1;break;case"checkbox":u=t;if(_via_img_metadata[g].regions[e].region_attributes.hasOwnProperty(i)){if("object"!=typeof _via_img_metadata[g].regions[e].region_attributes[i]){m=_via_img_metadata[g].regions[e].region_attributes[i];_via_img_metadata[g].regions[e].region_attributes[i]={},Object.keys(_via_attributes.region[i].options).includes(m)&&(_via_img_metadata[g].regions[e].region_attributes[i][m]=!0)}}else _via_img_metadata[g].regions[e].region_attributes[i]={};a?_via_img_metadata[g].regions[e].region_attributes[i][u]=!0:delete _via_img_metadata[g].regions[e].region_attributes[i][u],c+=1}n(c)})}function set_region_annotations_to_default_value(_){var e;for(e in _via_attributes.region){switch(_via_attributes.region[e].type){case"text":void 0!==(a=_via_attributes.region[e].default_value)&&(_via_img_metadata[_via_image_id].regions[_].region_attributes[e]=a);break;case"image":case"dropdown":case"radio":_via_img_metadata[_via_image_id].regions[_].region_attributes[e]="",void 0!==(i=_via_attributes.region[e].default_options)&&(_via_img_metadata[_via_image_id].regions[_].region_attributes[e]=Object.keys(i)[0]);break;case"checkbox":var i,t;if(_via_img_metadata[_via_image_id].regions[_].region_attributes[e]={},"underfined"!=typeof(i=_via_attributes.region[e].default_options))for(t in i){var a;"underfined"!=typeof(a=i[t])&&(_via_img_metadata[_via_image_id].regions[_].region_attributes[e][t]=a)}}}}function set_file_annotations_to_default_value(_){var e;for(e in _via_attributes.file){switch(_via_attributes.file[e].type){case"text":var i=_via_attributes.file[e].default_value;_via_img_metadata[_].file_attributes[e]=i;break;case"image":case"dropdown":case"radio":_via_img_metadata[_].file_attributes[e]="";var t=_via_attributes.file[e].default_options;_via_img_metadata[_].file_attributes[e]=Object.keys(t)[0];break;case"checkbox":_via_img_metadata[_].file_attributes[e]={};var a;t=_via_attributes.file[e].default_options;for(a in t){i=t[a];_via_img_metadata[_].file_attributes[e][a]=i}}}}function annotation_editor_increase_panel_height(){var _=document.getElementById("annotation_editor_panel");_via_settings.ui.annotation_editor_height<95&&(_via_settings.ui.annotation_editor_height+=VIA_ANNOTATION_EDITOR_HEIGHT_CHANGE,_.style.height=_via_settings.ui.annotation_editor_height+"%")}function annotation_editor_decrease_panel_height(){var _=document.getElementById("annotation_editor_panel");_via_settings.ui.annotation_editor_height>10&&(_via_settings.ui.annotation_editor_height-=VIA_ANNOTATION_EDITOR_HEIGHT_CHANGE,_.style.height=_via_settings.ui.annotation_editor_height+"%")}function annotation_editor_increase_content_size(){var _=document.getElementById("annotation_editor_panel");_via_settings.ui.annotation_editor_fontsize<1.6&&(_via_settings.ui.annotation_editor_fontsize+=VIA_ANNOTATION_EDITOR_FONTSIZE_CHANGE,_.style.fontSize=_via_settings.ui.annotation_editor_fontsize+"rem")}function annotation_editor_decrease_content_size(){var _=document.getElementById("annotation_editor_panel");_via_settings.ui.annotation_editor_fontsize>.4&&(_via_settings.ui.annotation_editor_fontsize-=VIA_ANNOTATION_EDITOR_FONTSIZE_CHANGE,_.style.fontSize=_via_settings.ui.annotation_editor_fontsize+"rem")}function project_set_name(_){_via_settings.project.name=_,document.getElementById("project_name").value=_via_settings.project.name}function project_init_default_project(){_via_settings.hasOwnProperty("project")||(_via_settings.project={}),project_set_name(project_get_default_project_name())}function project_on_name_update(_){project_set_name(_.value)}function project_get_default_project_name(){const _=new Date;return"via_project_"+(_.getDate()+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][_.getMonth()]+_.getFullYear()+"_"+_.getHours()+"h"+_.getMinutes()+"m")}function project_save_with_confirm(){invoke_with_user_inputs(project_save_confirmed,{project_name:{type:"text",name:"Project Name",value:_via_settings.project.name,disabled:!1,size:30},save_annotations:{type:"checkbox",name:"Save region and file annotations (i.e. manual annotations)",checked:!0,disabled:!1},save_attributes:{type:"checkbox",name:"Save region and file attributes.",checked:!0},save_via_settings:{type:"checkbox",name:"Save VIA application settings",checked:!0}},{title:"Save Project"})}function project_save_confirmed(_){_.project_name.value!==_via_settings.project.name&&project_set_name(_.project_name.value);var e={_via_settings:_via_settings,_via_img_metadata:_via_img_metadata,_via_attributes:_via_attributes,_via_data_format_version:"2.0.10",_via_image_id_list:_via_image_id_list},i=_.project_name.value+".json";save_data_to_local_file(new Blob([JSON.stringify(e)],{type:"text/json;charset=utf-8"}),i),user_input_default_cancel_handler()}function project_open_select_project_file(){invisible_file_input&&(invisible_file_input.accept=".json",invisible_file_input.onchange=project_open,invisible_file_input.removeAttribute("multiple"),invisible_file_input.click())}function project_open(_){load_text_file(_.target.files[0],project_open_parse_json_file)}function project_open_parse_json_file(_){var e=JSON.parse(_);if(e._via_settings&&e._via_img_metadata&&e._via_attributes){for(var i in project_import_settings(e._via_settings),_via_image_id_list=[],_via_image_filename_list=[],_via_img_count=0,_via_img_metadata={},_via_img_fileref={},_via_img_src={},_via_attributes={region:{},file:{}},_via_buffer_remove_all(),_via_img_metadata={},e._via_img_metadata)"filename"in e._via_img_metadata[i]&&"size"in e._via_img_metadata[i]&&"regions"in e._via_img_metadata[i]&&"file_attributes"in e._via_img_metadata[i]?(e.hasOwnProperty("_via_image_id_list")||(_via_image_id_list.push(i),_via_image_filename_list.push(e._via_img_metadata[i].filename)),set_file_annotations_to_default_value(i),_via_img_metadata[i]=e._via_img_metadata[i],_via_img_count+=1):console.log("discarding malformed entry for "+i+": "+JSON.stringify(e._via_img_metadata[i]));if(e.hasOwnProperty("_via_image_id_list"))for(var t in _via_image_id_list=e._via_image_id_list,e._via_image_id_list){i=e._via_image_id_list[t];_via_image_filename_list.push(_via_img_metadata[i].filename)}_via_attributes=e._via_attributes,project_parse_via_attributes_from_img_metadata();var a=Object.keys(_via_attributes.file),n=Object.keys(_via_attributes.region);n.length?(_via_attribute_being_updated="region",_via_current_attribute_id=n[0]):a.length&&(_via_attribute_being_updated="file",_via_current_attribute_id=a[0]),""!==_via_settings.core.default_filepath&&_via_file_resolve_all_to_default_filepath(),show_message("Imported project ["+_via_settings.project.name+"] with "+_via_img_count+" files."),_via_img_count>0&&(_via_show_img(0),update_img_fn_list(),_via_reload_img_fn_list_table=!0)}else show_message("Cannot import project from a corrupt file!")}function project_parse_via_attributes_from_img_metadata(){var _,e,i;for(_ in _via_attributes.hasOwnProperty("file")||(_via_attributes.file={}),_via_attributes.hasOwnProperty("region")||(_via_attributes.region={}),_via_img_metadata){for(e in _via_img_metadata[_].file_attributes)_via_attributes.file.hasOwnProperty(e)||(_via_attributes.file[e]={},_via_attributes.file[e].type="text");var t;for(t=0;t<_via_img_metadata[_].regions.length;++t)for(i in _via_img_metadata[_].regions[t].region_attributes)_via_attributes.region.hasOwnProperty(i)||(_via_attributes.region[i]={},_via_attributes.region[i].type="text")}}function project_import_settings(_){var e;for(e in _){var i;if("object"==typeof _[e])for(i in _[e]){var t;if("object"==typeof _[e][i])for(t in _[e][i])_via_settings[e][i][t]=_[e][i][t];else _via_settings[e][i]=_[e][i]}else _via_settings[e]=_[e]}}function project_file_remove_with_confirm(){var _=_via_image_id_list[_via_image_index],e=_via_img_metadata[_].filename,i=_via_img_metadata[_].regions.length;invoke_with_user_inputs(project_file_remove_confirmed,{img_index:{type:"text",name:"File Id",value:_via_image_index+1,disabled:!0,size:8},filename:{type:"text",name:"Filename",value:e,disabled:!0,size:30},region_count:{type:"text",name:"Number of regions",disabled:!0,value:i,size:8}},{title:"Remove File from Project"})}function project_file_remove_confirmed(_){var e=_.img_index.value-1;project_remove_file(e),e===_via_img_count?0===_via_img_count?(_via_current_image_loaded=!1,show_home_panel()):_via_show_img(e-1):_via_show_img(e),_via_reload_img_fn_list_table=!0,update_img_fn_list(),show_message("Removed file ["+_.filename.value+"] from project"),user_input_default_cancel_handler()}function project_remove_file(_){if(_<0||_>=_via_img_count)console.log("project_remove_file(): invalid img_index "+_);else{var e=_via_image_id_list[_];_via_image_id_list.splice(_,1),_via_image_filename_list.splice(_,1);var i=_via_img_fn_list_img_index_list.indexOf(_);-1!==i&&_via_img_fn_list_img_index_list.splice(i,1),_via_buffer_remove_all(),img_fn_list_clear_css_classname("buffered"),_via_clear_reg_canvas(),delete _via_img_metadata[e],delete _via_img_src[e],delete _via_img_fileref[e],_via_img_count-=1}}function project_add_new_file(_,e,i){var t=i;return void 0===t&&(void 0===e&&(e=-1),t=_via_get_image_id(_,e)),_via_img_metadata.hasOwnProperty(t)||(_via_img_metadata[t]=new file_metadata(_,e),_via_image_id_list.push(t),_via_image_filename_list.push(_),_via_img_count+=1),t}function project_file_add_local(_){for(var e=_.target.files,i=[],t=0,a=0;a<e.length;++a){if("image"===e[a].type.substr(0,5)){var n=_via_image_filename_list.indexOf(e[a].name);if(-1===n){var r=project_add_new_file(e[a].name,e[a].size);_via_img_fileref[r]=e[a],set_file_annotations_to_default_value(r),i.push(_via_image_id_list.indexOf(r))}else{var s=_via_image_id_list[n];_via_img_fileref[s]=e[a],_via_img_metadata[s].size=e[a].size}}else t+=1}if(_via_img_metadata){var o="Loaded "+i.length+" images.";t&&(o+=" ( Discarded "+t+" non-image files! )"),show_message(o),i.length?_via_show_img(i[0]):_via_show_img(_via_image_index),update_img_fn_list()}else show_message("Please upload some image files!")}function project_file_add_abs_path_with_input(){invoke_with_user_inputs(project_file_add_abs_path_input_done,{absolute_path:{type:"text",name:"add one absolute path",placeholder:"/home/abhishek/image1.jpg",disabled:!1,size:50},absolute_path_list:{type:"textarea",name:"or, add multiple paths (one path per line)",placeholder:"/home/abhishek/image1.jpg\n/home/abhishek/image2.jpg\n/home/abhishek/image3.png",disabled:!1,rows:5,cols:80}},{title:"Add File using Absolute Path"})}function project_file_add_abs_path_input_done(_){if(""!==_.absolute_path.value){var e=_.absolute_path.value.trim(),i=project_file_add_url(e);_via_show_img(_via_image_id_list.indexOf(i)),show_message("Added file at absolute path ["+e+"]"),update_img_fn_list(),user_input_default_cancel_handler()}else{if(""!==_.absolute_path_list.value)import_files_url_from_csv(_.absolute_path_list.value)}}function project_file_add_url_with_input(){invoke_with_user_inputs(project_file_add_url_input_done,{url:{type:"text",name:"add one URL",placeholder:"http://www.robots.ox.ac.uk/~vgg/software/via/images/swan.jpg",disabled:!1,size:50},url_list:{type:"textarea",name:"or, add multiple URL (one url per line)",placeholder:"http://www.example.com/image1.jpg\nhttp://www.example.com/image2.jpg\nhttp://www.example.com/image3.png",disabled:!1,rows:5,cols:80}},{title:"Add File using URL"})}function project_file_add_url_input_done(_){if(""!==_.url.value){var e=_.url.value.trim(),i=project_file_add_url(e),t=_via_image_id_list.indexOf(i);show_message("Added file at url ["+e+"]"),update_img_fn_list(),_via_show_img(t),user_input_default_cancel_handler()}else{if(""!==_.url_list.value)import_files_url_from_csv(_.url_list.value)}}function project_file_add_url(_){if(""!==_){var e=_via_get_image_id(_,-1);if(!_via_img_metadata.hasOwnProperty(e))return e=project_add_new_file(_),_via_img_src[e]=_via_img_metadata[e].filename,set_file_annotations_to_default_value(e),e}}function project_file_add_base64(_,e){var i=_via_get_image_id(_,-1);_via_img_metadata.hasOwnProperty(i)||(i=project_add_new_file(_,-1),_via_img_src[i]=e,set_file_annotations_to_default_value(i))}function project_file_load_on_fail(_){var e=_via_image_id_list[_];_via_img_src[e]="",_via_image_load_error[_]=!0,img_fn_list_ith_entry_error(_,!0)}function project_file_load_on_success(_){_via_image_load_error[_]=!1,img_fn_list_ith_entry_error(_,!1)}function project_settings_toggle(){_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.SETTINGS?show_single_image_view():project_settings_show()}function project_settings_show(){set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.SETTINGS)}function project_filepath_add_from_input(_,e){var i=document.getElementById(_).value.trim(),t=parseInt(e.getAttribute("value"));project_filepath_add(i),_via_show_img(t)}function project_filepath_add(_){if(""!==e&&!_via_settings.core.filepath.hasOwnProperty(_)){var e,i=0;for(e in _via_settings.core.filepath)_via_settings.core.filepath[e]>i&&(i=_via_settings.core.filepath[e]);_via_settings.core.filepath[_]=i+1}}function project_filepath_del(_){_via_settings.core.filepath.hasOwnProperty(_)&&delete _via_settings.core.filepath[_]}function project_save_attributes(){save_data_to_local_file(new Blob([JSON.stringify(_via_attributes)],{type:"application/json;charset=utf-8"}),_via_settings.project.name+"_attributes.json")}function project_import_attributes_from_file(_){for(var e=_.target.files,i=0;i<e.length;++i){load_text_file(e[i],project_import_attributes_from_json)}}function project_import_attributes_from_json(_){try{var e,i=JSON.parse(_),t=0,a=0;for(e in i.file)_via_attributes.file[e]=JSON.parse(JSON.stringify(i.file[e])),t+=1;for(e in i.region)_via_attributes.region[e]=JSON.parse(JSON.stringify(i.region[e])),a+=1;if(t>0||a>0){var n=Object.keys(_via_attributes.file),r=Object.keys(_via_attributes.region);r.length?(_via_attribute_being_updated="region",_via_current_attribute_id=r[0]):n.length&&(_via_attribute_being_updated="file",_via_current_attribute_id=n[0]),attribute_update_panel_set_active_button(),update_attributes_update_panel(),annotation_editor_update_content()}show_message("Imported "+t+" file attributes and "+a+" region attributes")}catch(_){show_message("Failed to import attributes: ["+_+"]")}}function image_grid_init(){var _;(e=document.getElementById("image_grid_content")).focus(),e.addEventListener("mousedown",image_grid_mousedown_handler,!1),e.addEventListener("mouseup",image_grid_mouseup_handler,!1),e.addEventListener("dblclick",image_grid_dblclick_handler,!1),image_grid_set_content_panel_height_fixed();var e,i=(e=document.getElementById("image_grid_show_image_policy")).options.length;for(_=0;_<i;++_)if(e.options[_].value===_via_settings.ui.image_grid.show_image_policy){e.selectedIndex=_;break}}function image_grid_update(){_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID&&image_grid_set_content(_via_image_grid_img_index_list)}function image_grid_toggle(){document.getElementById("toolbar_image_grid_toggle");_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE_GRID?(image_grid_clear_all_groups(),show_single_image_view()):show_image_grid_view()}function image_grid_show_all_project_images(){var _,e,i=[];for(e=_via_img_fn_list_img_index_list.length,_=0;_<e;++_)i.push(_via_img_fn_list_img_index_list[_]);image_grid_clear_all_groups(),document.getElementById("image_grid_toolbar_group_by_select").selectedIndex=0,image_grid_set_content(i)}function image_grid_clear_all_groups(){var _,e;for(e=_via_image_grid_group_var.length,_=0;_<e;++_)image_grid_remove_html_group_panel(_via_image_grid_group_var[_]),image_grid_group_by_select_set_disabled(_via_image_grid_group_var[_].type,_via_image_grid_group_var[_].name,!1);_via_image_grid_group={},_via_image_grid_group_var=[]}function image_grid_set_content(_){if(0!==_.length&&!_via_image_grid_load_ongoing){_via_image_grid_img_index_list=_.slice(0),_via_image_grid_selected_img_index_list=_.slice(0),document.getElementById("image_grid_group_by_img_count").innerHTML=_via_image_grid_img_index_list.length,_via_image_grid_page_first_index=0,_via_image_grid_page_last_index=null,_via_image_grid_stack_prev_page=[],_via_image_grid_page_img_index_list=[],image_grid_clear_content(),image_grid_set_content_panel_height_fixed(),_via_image_grid_load_ongoing=!0;var e=_via_image_grid_img_index_list.length;switch(_via_settings.ui.image_grid.show_image_policy){case"all":_via_image_grid_page_img_index_list=_via_image_grid_img_index_list.slice(0);break;case"first_mid_last":if(e<3)for(i=0;i<e;++i)_via_image_grid_page_img_index_list.push(_via_image_grid_img_index_list[i]);else _via_image_grid_page_img_index_list.push(_via_image_grid_img_index_list[0]),_via_image_grid_page_img_index_list.push(_via_image_grid_img_index_list[Math.floor(e/2)]),_via_image_grid_page_img_index_list.push(_via_image_grid_img_index_list[e-1]);break;case"even_indexed":for(i=0;i<e;++i)i%2!=0&&_via_image_grid_page_img_index_list.push(_via_image_grid_img_index_list[i]);break;case"odd_indexed":for(i=0;i<e;++i)i%2==0&&_via_image_grid_page_img_index_list.push(_via_image_grid_img_index_list[i]);break;case"gap5":case"gap25":case"gap50":var i,t=parseInt(_via_settings.ui.image_grid.show_image_policy.substr("gap".length));for(i=0;i<e;i+=t)_via_image_grid_page_img_index_list.push(_via_image_grid_img_index_list[i])}_via_image_grid_visible_img_index_list=[],image_grid_update_sel_count_html(),annotation_editor_update_content(),image_grid_content_append_img(_via_image_grid_page_first_index),show_message("[Click] toggles selection, [Shift + Click] selects everything a image, [Click] or [Ctrl + Click] removes selection of all subsequent or preceeding images.")}}function image_grid_clear_content(){var _=document.getElementById("image_grid_content_img"),e=document.getElementById("image_grid_content_rshape");_.innerHTML="",e.innerHTML="",_via_image_grid_visible_img_index_list=[]}function image_grid_set_content_panel_height_fixed(){var _=document.getElementById("image_grid_content"),e=document.documentElement;_.style.height=e.clientHeight-5.5*ui_top_panel.offsetHeight+"px"}function image_grid_content_append_img(_){var e=_via_image_grid_page_img_index_list[_],i=image_grid_get_html_img_id(e),t=_via_image_id_list[e],a=document.createElement("img");if(_via_img_fileref[t]instanceof File){var n=new FileReader;n.addEventListener("error",function(){},!1),n.addEventListener("load",function(){a.src=n.result},!1),n.readAsDataURL(_via_img_fileref[t])}else a.src=_via_img_src[t];a.setAttribute("id",i),a.setAttribute("height",_via_settings.ui.image_grid.img_height+"px"),a.setAttribute("title","["+(e+1)+"] "+_via_img_metadata[t].filename),a.addEventListener("load",image_grid_on_img_load,!1),a.addEventListener("error",image_grid_on_img_error,!1),document.getElementById("image_grid_content_img").appendChild(a)}function image_grid_on_img_load(_){var e=_.target;project_file_load_on_success(image_grid_parse_html_img_id(e.id)),image_grid_add_img_if_possible(e)}function image_grid_on_img_error(_){var e=_.target;project_file_load_on_fail(image_grid_parse_html_img_id(e.id)),image_grid_add_img_if_possible(e)}function image_grid_add_img_if_possible(_){var e=image_grid_parse_html_img_id(_.id),i=document.getElementById("image_grid_content_img"),t=parseInt(_.offsetTop)+parseInt(_.height);if(i.clientHeight<t){document.getElementById("image_grid_content_img").removeChild(_),_via_settings.ui.image_grid.show_region_shape&&image_grid_page_show_all_regions(),_via_image_grid_load_ongoing=!1;var a=_via_image_grid_page_img_index_list.indexOf(e);_via_image_grid_page_last_index=a;var n=document.getElementById("image_grid_nav");(o=[]).push("<span>Showing&nbsp;"+(_via_image_grid_page_first_index+1)+" to "+(_via_image_grid_page_last_index-1+1)+"&nbsp;:</span>"),_via_image_grid_stack_prev_page.length?o.push('<span class="text_button" onclick="image_grid_page_prev()">Prev</span>'):o.push("<span>Prev</span>"),o.push('<span class="text_button" onclick="image_grid_page_next()">Next</span'),n.innerHTML=o.join("")}else{var r=_via_image_grid_page_img_index_list.indexOf(e),s=r+1;if(_via_image_grid_visible_img_index_list.push(e),-1!==_via_image_grid_selected_img_index_list.indexOf(e)||image_grid_update_img_select(e,"unselect"),s!==_via_image_grid_page_img_index_list.length)if(_via_image_grid_load_ongoing)image_grid_content_append_img(r+1);else{_via_image_grid_page_last_index=_via_image_grid_page_first_index;n=document.getElementById("image_grid_nav");(o=[]).push("<span>Cancelled&nbsp;:</span>"),_via_image_grid_stack_prev_page.length?o.push('<span class="text_button" onclick="image_grid_page_prev()">Prev</span>'):o.push("<span>Prev</span>"),o.push('<span class="text_button" onclick="image_grid_page_next()">Next</span'),n.innerHTML=o.join("")}else{a=_via_image_grid_page_img_index_list.indexOf(e);_via_image_grid_page_last_index=a,_via_settings.ui.image_grid.show_region_shape&&image_grid_page_show_all_regions(),_via_image_grid_load_ongoing=!1;var o;n=document.getElementById("image_grid_nav");(o=[]).push("<span>Showing&nbsp;"+(_via_image_grid_page_first_index+1)+" to "+(_via_image_grid_page_last_index+1)+" (end)&nbsp;</span>"),_via_image_grid_stack_prev_page.length?o.push('<span class="text_button" onclick="image_grid_page_prev()">Prev</span>'):o.push("<span>Prev</span>"),o.push("<span>Next</span"),n.innerHTML=o.join("")}}}function image_grid_onchange_show_image_policy(_){_via_settings.ui.image_grid.show_image_policy=_.options[_.selectedIndex].value,image_grid_set_content(_via_image_grid_img_index_list)}function image_grid_page_show_all_regions(){var _=[];if(_via_settings.ui.image_grid.show_region_shape){var e,i=document.getElementById("image_grid_content_img"),t=i.childNodes.length;for(e=0;e<t;++e){var a=image_grid_parse_html_img_id(i.childNodes[e].id),n=[];n.push(parseInt(i.childNodes[e].width)),n.push(parseInt(i.childNodes[e].height)),n.push(parseInt(i.childNodes[e].naturalWidth)),n.push(parseInt(i.childNodes[e].naturalHeight)),n.push(parseInt(i.childNodes[e].offsetLeft)+parseInt(i.childNodes[e].clientLeft)),n.push(parseInt(i.childNodes[e].offsetTop)+parseInt(i.childNodes[e].clientTop));var r=image_grid_show_region_shape(a,n);_.push(r)}}}function image_grid_is_region_in_current_group(_){var e,i;if(0===(i=_via_image_grid_group_var.length))return!0;for(e=0;e<i;++e)if("region"===_via_image_grid_group_var[e].type){var t=_via_image_grid_group_var[e].values[_via_image_grid_group_var[e].current_value_index];if(_[_via_image_grid_group_var[e].name]!=t)return!1}return!0}function image_grid_show_region_shape(_,e){return new Promise(function(i,t){var a,n=_via_image_id_list[_],r=image_grid_get_html_img_id(_),s=_via_img_metadata[n].regions.length;for(a=0;a<s;++a)if(image_grid_is_region_in_current_group(_via_img_metadata[n].regions[a].region_attributes)){var o,g=_via_img_metadata[n].regions[a].shape_attributes;switch(g.name){case VIA_REGION_SHAPE.RECT:o=[g.x,g.y,g.x+g.width,g.y+g.height];break;case VIA_REGION_SHAPE.CIRCLE:o=[g.cx,g.cy,g.cx+g.r,g.cy+g.r];break;case VIA_REGION_SHAPE.ELLIPSE:o=[g.cx,g.cy,g.cx+g.rx,g.cy+g.ry];break;case VIA_REGION_SHAPE.POLYLINE:case VIA_REGION_SHAPE.POLYGON:var l;for(o=[],l=0;l<g.all_points_x.length;++l)o.push(g.all_points_x[l]),o.push(g.all_points_y[l]);break;case VIA_REGION_SHAPE.POINT:o=[g.cx,g.cy]}var d=e[1]/e[3],v=e[4],c=e[5],u=new _via_region(g.name,a,o,d,v,c).get_svg_element();u.setAttribute("id",image_grid_get_html_region_id(_,a)),u.setAttribute("class",r),u.setAttribute("fill",_via_settings.ui.image_grid.rshape_fill),u.setAttribute("stroke",_via_settings.ui.image_grid.rshape_stroke),u.setAttribute("stroke-width",_via_settings.ui.image_grid.rshape_stroke_width),document.getElementById("image_grid_content_rshape").appendChild(u)}})}function image_grid_image_size_increase(){var _=_via_settings.ui.image_grid.img_height+VIA_IMAGE_GRID_IMG_HEIGHT_CHANGE;_via_settings.ui.image_grid.img_height=_,_via_image_grid_page_last_index=null,image_grid_update()}function image_grid_image_size_decrease(){var _=_via_settings.ui.image_grid.img_height-VIA_IMAGE_GRID_IMG_HEIGHT_CHANGE;_>1&&(_via_settings.ui.image_grid.img_height=_,_via_image_grid_page_last_index=null,image_grid_update())}function image_grid_image_size_reset(){var _=_via_settings.ui.image_grid.img_height;_>1&&(_via_settings.ui.image_grid.img_height=_,_via_image_grid_page_last_index=null,image_grid_update())}function image_grid_mousedown_handler(_){_.preventDefault(),_via_image_grid_mousedown_img_index=image_grid_parse_html_img_id(_.target.id)}function image_grid_mouseup_handler(_){_.preventDefault();var e=_via_image_grid_mouseup_img_index;if(_via_image_grid_mouseup_img_index=image_grid_parse_html_img_id(_.target.id),isNaN(_via_image_grid_mousedown_img_index)||isNaN(_via_image_grid_mouseup_img_index))return e=_via_image_grid_img_index_list[0],void image_grid_group_select_none();var i=_via_image_grid_img_index_list.indexOf(_via_image_grid_mousedown_img_index),t=_via_image_grid_img_index_list.indexOf(_via_image_grid_mouseup_img_index),a=-1,n=-1,r="select";if(i===t?_.shiftKey?(a=_via_image_grid_img_index_list.indexOf(e)+1,n=t+1):(n=(a=i)+1,r="toggle"):(i<t?(a=i,n=t+1):(a=t+1,n=i),r="toggle"),!(a>n)){var s;for(s=a;s<n;++s)image_grid_update_img_select(_via_image_grid_img_index_list[s],r);image_grid_update_sel_count_html(),annotation_editor_update_content()}}function image_grid_update_sel_count_html(){document.getElementById("image_grid_group_by_sel_img_count").innerHTML=_via_image_grid_selected_img_index_list.length}function image_grid_update_img_select(_,e){var i=image_grid_get_html_img_id(_),t=-1!==_via_image_grid_selected_img_index_list.indexOf(_);switch("toggle"===e&&(e=t?"unselect":"select"),e){case"select":t||_via_image_grid_selected_img_index_list.push(_),-1!==_via_image_grid_visible_img_index_list.indexOf(_)&&document.getElementById(i).classList.remove("not_sel");break;case"unselect":if(t){var a=_via_image_grid_selected_img_index_list.indexOf(_);_via_image_grid_selected_img_index_list.splice(a,1)}-1!==_via_image_grid_visible_img_index_list.indexOf(_)&&document.getElementById(i).classList.add("not_sel")}}function image_grid_group_select_all(){image_grid_group_set_all_selection_state("select"),image_grid_update_sel_count_html(),annotation_editor_update_content(),show_message("Selected all images in the current group")}function image_grid_group_select_none(){image_grid_group_set_all_selection_state("unselect"),image_grid_update_sel_count_html(),annotation_editor_update_content(),show_message("Removed selection of all images in the current group")}function image_grid_group_set_all_selection_state(_){var e;for(e=0;e<_via_image_grid_img_index_list.length;++e)image_grid_update_img_select(_via_image_grid_img_index_list[e],_)}function image_grid_group_toggle_select_all(){_via_image_grid_selected_img_index_list.length===_via_image_grid_img_index_list.length?image_grid_group_select_none():image_grid_group_select_all()}function image_grid_parse_html_img_id(_){var e=_.substr(2);return parseInt(e)}function image_grid_get_html_img_id(_){return"im"+_}function image_grid_parse_html_region_id(_){var e=_.split("_");return 2===e.length?{img_index:parseInt(e[0].substr(2)),region_id:parseInt(e[1].substr(2))}:(console.log("image_grid_parse_html_region_id(): invalid html_region_id"),{})}function image_grid_get_html_region_id(_,e){return image_grid_get_html_img_id(_)+"_rs"+e}function image_grid_dblclick_handler(_){_via_image_index=image_grid_parse_html_img_id(_.target.id),show_single_image_view()}function image_grid_toolbar_update_group_by_select(){var _=document.getElementById("image_grid_toolbar_group_by_select");_.innerHTML="";var e,i,t=document.createElement("option");for(e in t.setAttribute("value",""),t.setAttribute("selected","selected"),t.innerHTML="All Images",_.appendChild(t),_via_attributes.file){(t=document.createElement("option")).setAttribute("value",image_grid_toolbar_group_by_select_get_html_id("file",e)),t.innerHTML="[file] "+e,_.appendChild(t)}for(i in _via_attributes.region){(t=document.createElement("option")).setAttribute("value",image_grid_toolbar_group_by_select_get_html_id("region",i)),t.innerHTML="[region] "+i,_.appendChild(t)}}function image_grid_toolbar_group_by_select_get_html_id(_,e){return"file"===_?"f_"+e:"region"===_?"r_"+e:void 0}function image_grid_toolbar_group_by_select_parse_html_id(_){return _.startsWith("f_")?{attr_type:"file",attr_name:_.substr(2)}:_.startsWith("r_")?{attr_type:"region",attr_name:_.substr(2)}:void 0}function image_grid_toolbar_onchange_group_by_select(_){if(""!==_.options[_.selectedIndex].value){var e=image_grid_toolbar_group_by_select_parse_html_id(_.options[_.selectedIndex].value),i=e.attr_type,t=e.attr_name;image_grid_group_by(i,t),image_grid_group_by_select_set_disabled(i,t,!0),_.blur()}else image_grid_show_all_project_images()}function image_grid_remove_html_group_panel(_){var e=document.getElementById("group_toolbar_"+_.group_index);document.getElementById("image_grid_group_panel").removeChild(e)}function image_grid_add_html_group_panel(_){var e=document.createElement("div");e.classList.add("image_grid_group_toolbar"),e.setAttribute("id","group_toolbar_"+_.group_index);var i=document.createElement("span");i.classList.add("text_button"),i.setAttribute("onclick","image_grid_remove_group_by(this)"),i.innerHTML="&times;",e.appendChild(i);var t=document.createElement("button");t.innerHTML="<",t.setAttribute("value",_.group_index),t.setAttribute("onclick","image_grid_group_prev(this)"),e.appendChild(t);var a,n,r=document.createElement("select");r.setAttribute("id",image_grid_group_select_get_html_id(_.group_index)),r.setAttribute("onchange","image_grid_group_value_onchange(this)");var s=_.values.length,o=_.values[_.current_value_index];for(a=0;a<s;++a){n=_.values[a];var g=document.createElement("option");g.setAttribute("value",n),g.innerHTML=a+1+"/"+s+": "+_.name+" = "+n,n===o&&g.setAttribute("selected","selected"),r.appendChild(g)}e.appendChild(r);var l=document.createElement("button");l.innerHTML=">",l.setAttribute("value",_.group_index),l.setAttribute("onclick","image_grid_group_next(this)"),e.appendChild(l),document.getElementById("image_grid_group_panel").appendChild(e)}function image_grid_group_panel_set_selected_value(_){document.getElementById(image_grid_group_select_get_html_id(_)).selectedIndex=_via_image_grid_group_var[_].current_value_index}function image_grid_group_panel_set_options(_){var e,i,t=document.getElementById(image_grid_group_select_get_html_id(_));t.innerHTML="";var a=_via_image_grid_group_var[_].values.length,n=_via_image_grid_group_var[_].name,r=_via_image_grid_group_var[_].values[_via_image_grid_group_var[_].current_value_index];for(e=0;e<a;++e){i=_via_image_grid_group_var[_].values[e];var s=document.createElement("option");s.setAttribute("value",i),s.innerHTML=e+1+"/"+a+": "+n+" = "+i,i===r&&s.setAttribute("selected","selected"),t.appendChild(s)}}function image_grid_group_select_get_html_id(_){return"gi_"+_}function image_grid_group_select_parse_html_id(_){return parseInt(_.substr(3))}function image_grid_group_by_select_set_disabled(_,e,i){var t,a=document.getElementById("image_grid_toolbar_group_by_select"),n=image_grid_toolbar_group_by_select_get_html_id(_,e),r=a.options.length;for(t=0;t<r;++t)if(n===a.options[t].value){i?a.options[t].setAttribute("disabled","disabled"):a.options[t].removeAttribute("disabled");break}}function image_grid_remove_group_by(_){var e=parseInt(_.parentNode.id.substr("group_toolbar_".length));if(0===e)image_grid_show_all_project_images();else{image_grid_group_by_merge(_via_image_grid_group,0,e);var i,t=_via_image_grid_group_var.length;_=document.getElementById("image_grid_group_panel");for(i=e;i<t;++i)image_grid_remove_html_group_panel(_via_image_grid_group_var[i]),image_grid_group_by_select_set_disabled(_via_image_grid_group_var[i].type,_via_image_grid_group_var[i].name,!1);_via_image_grid_group_var.splice(e),image_grid_set_content_to_current_group()}}function image_grid_group_by(_,e){if(0===Object.keys(_via_image_grid_group).length){var i=[],t=_via_img_fn_list_img_index_list.length;for(n=0;n<t;++n)i.push(_via_img_fn_list_img_index_list[n]);_via_image_grid_group=image_grid_split_array_to_group(i,_,e);var a=Object.keys(_via_image_grid_group);(_via_image_grid_group_var=[]).push({type:_,name:e,current_value_index:0,values:a,group_index:0}),image_grid_add_html_group_panel(_via_image_grid_group_var[0])}else{var n;image_grid_group_split_all_arrays(_via_image_grid_group,_,e);var r=_via_image_grid_group;for(t=_via_image_grid_group_var.length,n=0;n<t;++n)r=r[_via_image_grid_group_var[n].values[_via_image_grid_group_var[n].current_value_index]];a=Object.keys(r);var s=_via_image_grid_group_var.length;_via_image_grid_group_var.push({type:_,name:e,current_value_index:0,values:a,group_index:s}),image_grid_add_html_group_panel(_via_image_grid_group_var[s])}image_grid_set_content_to_current_group()}function image_grid_group_by_merge(_,e,i){var t;if(e===i)return image_grid_group_by_collapse(_);for(t in _)_[t]=image_grid_group_by_merge(_[t],e+1,i)}function image_grid_group_by_collapse(_){var e,i=[];for(e in _)i=Array.isArray(_[e])?i.concat(_[e]):i.concat(image_grid_group_by_collapse(_[e]));return i}function image_grid_group_split_all_arrays(_,e,i){if(Array.isArray(_))return image_grid_split_array_to_group(_,e,i);var t;for(t in _)Array.isArray(_[t])?_[t]=image_grid_split_array_to_group(_[t],e,i):image_grid_group_split_all_arrays(_[t],e,i)}function image_grid_split_array_to_group(_,e,i){var t,a,n,r,s={},o=_.length;switch(e){case"file":for(n=0;n<o;++n)t=_[n],a=_via_image_id_list[t],_via_img_metadata[a].file_attributes.hasOwnProperty(i)&&(r=_via_img_metadata[a].file_attributes[i],s.hasOwnProperty(r)||(s[r]=[]),s[r].push(t));break;case"region":var g,l;for(n=0;n<o;++n)for(t=_[n],a=_via_image_id_list[t],l=_via_img_metadata[a].regions.length,g=0;g<l;++g)if(_via_img_metadata[a].regions[g].region_attributes.hasOwnProperty(i)){if(r=_via_img_metadata[a].regions[g].region_attributes[i],s.hasOwnProperty(r)||(s[r]=[]),s[r].includes(t))continue;s[r].push(t)}}return s}function image_grid_group_next(_){var e=parseInt(_.value),i=_via_image_grid_group_var[e].values.length,t=_via_image_grid_group_var[e].current_value_index+1;if(t>=i)if(0===e)image_grid_jump_to_group(e,t-=i);else{for(var a=e-1,n=_via_image_grid_group_var[a].current_value_index,r=n+1;0!==a&&r>=_via_image_grid_group_var[a].values.length;)r=(n=_via_image_grid_group_var[a=e-1].current_value_index)+1;r>=_via_image_grid_group_var[a].values.length&&(r=0),image_grid_jump_to_group(a,r)}else image_grid_jump_to_group(e,t);image_grid_set_content_to_current_group()}function image_grid_group_prev(_){var e=parseInt(_.value),i=_via_image_grid_group_var[e].values.length,t=_via_image_grid_group_var[e].current_value_index-1;if(t<0)if(0===e)image_grid_jump_to_group(e,t=i+t);else{for(var a=e-1,n=_via_image_grid_group_var[a].current_value_index,r=n-1;0!==a&&r<0;)r=(n=_via_image_grid_group_var[a=e-1].current_value_index)-1;r<0&&(r=_via_image_grid_group_var[a].values.length-1),image_grid_jump_to_group(a,r)}else image_grid_jump_to_group(e,t);image_grid_set_content_to_current_group()}function image_grid_group_value_onchange(_){image_grid_jump_to_group(image_grid_group_select_parse_html_id(_.id),_.selectedIndex),image_grid_set_content_to_current_group()}function image_grid_jump_to_group(_,e){var i;if(!(e>=_via_image_grid_group_var[_].values.length||e<0)&&(_via_image_grid_group_var[_].current_value_index=e,image_grid_group_panel_set_selected_value(_),_+1<_via_image_grid_group_var.length)){var t=_via_image_grid_group;for(i=0;i<=_;++i)t=t[_via_image_grid_group_var[i].values[_via_image_grid_group_var[i].current_value_index]];for(i=_+1;i<_via_image_grid_group_var.length;++i){if(_via_image_grid_group_var[i].values=Object.keys(t),0===_via_image_grid_group_var[i].values.length){_via_image_grid_group_var[i].current_value_index=-1,_via_image_grid_group_var.splice(i),image_grid_group_panel_set_options(i);break}_via_image_grid_group_var[i].current_value_index=0,t=t[_via_image_grid_group_var[i].values[0]],image_grid_group_panel_set_options(i)}}}function image_grid_set_content_to_current_group(){if(0===(e=_via_image_grid_group_var.length))image_grid_show_all_project_images();else{var _,e,i=_via_image_grid_group;for(_=0;_<e;++_)i=i[_via_image_grid_group_var[_].values[_via_image_grid_group_var[_].current_value_index]];Array.isArray(i)?image_grid_set_content(i):console.log("Error: image_grid_set_content_to_current_group(): expected array while got "+typeof i)}}function image_grid_page_next(){_via_image_grid_stack_prev_page.push(_via_image_grid_page_first_index),_via_image_grid_page_first_index=_via_image_grid_page_last_index,image_grid_clear_content(),_via_image_grid_load_ongoing=!0,image_grid_page_nav_show_cancel(),image_grid_content_append_img(_via_image_grid_page_first_index)}function image_grid_page_prev(){_via_image_grid_page_first_index=_via_image_grid_stack_prev_page.pop(),_via_image_grid_page_last_index=-1,image_grid_clear_content(),_via_image_grid_load_ongoing=!0,image_grid_page_nav_show_cancel(),image_grid_content_append_img(_via_image_grid_page_first_index)}function image_grid_page_nav_show_cancel(){var _=document.getElementById("image_grid_nav"),e=[];e.push("<span>Loading images ... </span>"),e.push('<span class="text_button" onclick="image_grid_cancel_load_ongoing()">Cancel</span>'),_.innerHTML=e.join("")}function image_grid_cancel_load_ongoing(){_via_image_grid_load_ongoing=!1}function image_zoom_init(){}function _via_region(_,e,i,t,a,n){this.shape=_,this.id=e,this.scale_factor=t,this.offset_x=a,this.offset_y=n,this.recompute_svg=!1,this.attributes={};var r,s=i.length;if(this.dview=new Array(s),this.dimg=new Array(s),0!==s)for(r=0;r<s;r++){this.dimg[r]=i[r];var o=this.offset_x;r%2!=0&&(o=this.offset_y),this.dview[r]=Math.round(this.dimg[r]*this.scale_factor)+o}switch(this.shape){case"rect":_via_region_rect.call(this),this.svg_attributes=["x","y","width","height"];break;case"circle":_via_region_circle.call(this),this.svg_attributes=["cx","cy","r"];break;case"ellipse":_via_region_ellipse.call(this),this.svg_attributes=["cx","cy","rx","ry","transform"];break;case"line":_via_region_line.call(this),this.svg_attributes=["x1","y1","x2","y2"];break;case"polyline":_via_region_polyline.call(this),this.svg_attributes=["points"];break;case"polygon":_via_region_polygon.call(this),this.svg_attributes=["points"];break;case"point":_via_region_point.call(this),this.shape="circle",this.svg_attributes=["cx","cy","r"]}this.initialize()}function _via_region_rect(){this.is_inside=_via_region_rect.prototype.is_inside,this.is_on_edge=_via_region_rect.prototype.is_on_edge,this.move=_via_region_rect.prototype.move,this.resize=_via_region_rect.prototype.resize,this.initialize=_via_region_rect.prototype.initialize,this.dist_to_nearest_edge=_via_region_rect.prototype.dist_to_nearest_edge}function _via_region_circle(){this.is_inside=_via_region_circle.prototype.is_inside,this.is_on_edge=_via_region_circle.prototype.is_on_edge,this.move=_via_region_circle.prototype.move,this.resize=_via_region_circle.prototype.resize,this.initialize=_via_region_circle.prototype.initialize,this.dist_to_nearest_edge=_via_region_circle.prototype.dist_to_nearest_edge}function _via_region_ellipse(){this.is_inside=_via_region_ellipse.prototype.is_inside,this.is_on_edge=_via_region_ellipse.prototype.is_on_edge,this.move=_via_region_ellipse.prototype.move,this.resize=_via_region_ellipse.prototype.resize,this.initialize=_via_region_ellipse.prototype.initialize,this.dist_to_nearest_edge=_via_region_ellipse.prototype.dist_to_nearest_edge}function _via_region_line(){this.is_inside=_via_region_line.prototype.is_inside,this.is_on_edge=_via_region_line.prototype.is_on_edge,this.move=_via_region_line.prototype.move,this.resize=_via_region_line.prototype.resize,this.initialize=_via_region_line.prototype.initialize,this.dist_to_nearest_edge=_via_region_line.prototype.dist_to_nearest_edge}function _via_region_polyline(){this.is_inside=_via_region_polyline.prototype.is_inside,this.is_on_edge=_via_region_polyline.prototype.is_on_edge,this.move=_via_region_polyline.prototype.move,this.resize=_via_region_polyline.prototype.resize,this.initialize=_via_region_polyline.prototype.initialize,this.dist_to_nearest_edge=_via_region_polyline.prototype.dist_to_nearest_edge}function _via_region_polygon(){this.is_inside=_via_region_polygon.prototype.is_inside,this.is_on_edge=_via_region_polygon.prototype.is_on_edge,this.move=_via_region_polygon.prototype.move,this.resize=_via_region_polygon.prototype.resize,this.initialize=_via_region_polygon.prototype.initialize,this.dist_to_nearest_edge=_via_region_polygon.prototype.dist_to_nearest_edge}function _via_region_point(){this.is_inside=_via_region_point.prototype.is_inside,this.is_on_edge=_via_region_point.prototype.is_on_edge,this.move=_via_region_point.prototype.move,this.resize=_via_region_point.prototype.resize,this.initialize=_via_region_point.prototype.initialize,this.dist_to_nearest_edge=_via_region_point.prototype.dist_to_nearest_edge}function _via_cancel_current_image_loading(){document.getElementById("project_panel_title").innerHTML="Project",_via_is_loading_current_image=!1}function _via_show_img(_){if(!_via_is_loading_current_image){var e=_via_image_id_list[_];if(!_via_img_metadata.hasOwnProperty(e))return console.log("_via_show_img(): ["+_+"] "+e+" does not exist!"),void show_message("The requested image does not exist!");if((void 0===_via_img_fileref[e]||!_via_img_fileref[e]instanceof File)&&(void 0===_via_img_src[e]||""===_via_img_src[e])){if(is_url(_via_img_metadata[e].filename))return _via_img_src[e]=_via_img_metadata[e].filename,void _via_show_img(_);var i=_via_file_get_search_path_list();return 0===i.length&&i.push(""),void _via_file_resolve(_,i).then(function(e){_via_show_img(_)},function(e){show_page_404(_)})}_via_buffer_img_index_list.includes(_)?(_via_current_image_loaded=!1,_via_show_img_from_buffer(_).then(function(e){Promise.all(_via_preload_img_promise_list).then(function(e){_via_preload_img_promise_list=[];var i=_via_img_buffer_start_preload(_,0);_via_preload_img_promise_list.push(i)})},function(_){console.log("_via_show_img_from_buffer() failed for file: "+_via_image_filename_list[_]),_via_current_image_loaded=!1})):(_via_is_loading_current_image=!0,img_loading_spinbar(_,!0),_via_img_buffer_add_image(_).then(function(e){_via_is_loading_current_image=!1,img_loading_spinbar(_,!1),_via_show_img(_)},function(e){_via_is_loading_current_image=!1,img_loading_spinbar(_,!1),show_page_404(_),console.log("_via_img_buffer_add_image() failed for file: "+_via_image_filename_list[e])}))}}function _via_buffer_hide_current_image(){img_fn_list_ith_entry_selected(_via_image_index,!1),_via_clear_reg_canvas(),_via_current_image&&_via_current_image.classList.remove("visible")}function _via_show_img_from_buffer(_){return new Promise(function(e,i){_via_buffer_hide_current_image();var t=_via_img_buffer_get_html_id(_);if(_via_current_image=document.getElementById(t)){_via_current_image.classList.add("visible"),_via_image_id=_via_image_id_list[_via_image_index=_],_via_current_image_filename=_via_img_metadata[_via_image_id].filename,_via_current_image_loaded=!0;var a=_via_buffer_img_index_list.indexOf(_);_via_buffer_img_shown_timestamp[a]=Date.now(),_via_click_x0=0,_via_click_y0=0,_via_click_x1=0,_via_click_y1=0,_via_is_user_drawing_region=!1,_via_is_window_resized=!1,_via_is_user_resizing_region=!1,_via_is_user_moving_region=!1,_via_is_user_drawing_polygon=!1,_via_is_region_selected=!1,_via_user_sel_region_id=-1,_via_current_image_width=_via_current_image.naturalWidth,_via_current_image_height=_via_current_image.naturalHeight,0!==_via_current_image_width&&0!==_via_current_image_height||(_via_current_image_width=640,_via_current_image_height=480);var n=document.documentElement,r=n.clientWidth-leftsidebar.clientWidth-20;"none"===leftsidebar.style.display&&(r=n.clientWidth);var s=n.clientHeight-2*ui_top_panel.offsetHeight;if(_via_canvas_height=_via_current_image_height,(_via_canvas_width=_via_current_image_width)>r){var o=r/_via_current_image.naturalWidth;_via_canvas_width=r,_via_canvas_height=_via_current_image.naturalHeight*o}if(_via_canvas_height>s){var g=s/_via_canvas_height;_via_canvas_height=s,_via_canvas_width*=g}_via_canvas_width=Math.round(_via_canvas_width),_via_canvas_height=Math.round(_via_canvas_height),_via_canvas_scale=_via_current_image.naturalWidth/_via_canvas_width,_via_canvas_scale_without_zoom=_via_canvas_scale,set_all_canvas_size(_via_canvas_width,_via_canvas_height),toggle_all_regions_selection(!1),set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.IMAGE),img_fn_list_ith_entry_selected(_via_image_index,!0),img_fn_list_scroll_to_current_file(),annotation_editor_update_content(),_via_load_canvas_regions(),_via_redraw_reg_canvas(),_via_reg_canvas.focus(),_via_is_canvas_zoomed&&set_zoom(_via_canvas_zoom_level_index),e(_)}else i(_)})}function _via_img_buffer_add_image(_){return new Promise(function(e,i){if(_via_buffer_img_index_list.includes(_))e(_);else{var t=_via_image_id_list[_];_via_img_metadata[t].filename;if(_via_img_metadata.hasOwnProperty(t)){if(_via_img_fileref[t]instanceof File){var a=URL.createObjectURL(_via_img_fileref[t]);t=_via_image_id_list[_];return(n=document.createElement("img")).setAttribute("id",_via_img_buffer_get_html_id(_)),n.setAttribute("src",a),n.setAttribute("alt","Image loaded from base64 data of a local file selected by user."),n.addEventListener("error",function(){URL.revokeObjectURL(a),project_file_load_on_fail(_),i(_)}),void n.addEventListener("load",function(){URL.revokeObjectURL(a),img_stat_set(_,[n.naturalWidth,n.naturalHeight]),_via_img_panel.insertBefore(n,_via_reg_canvas),project_file_load_on_success(_),img_fn_list_ith_entry_add_css_class(_,"buffered");var i=_via_buffer_img_index_list.length;_via_buffer_img_index_list.push(_),_via_buffer_img_shown_timestamp[i]=Date.now(),e(_)})}if(void 0===_via_img_src[t]||""===_via_img_src[t])i(_);else{var n;t=_via_image_id_list[_];(n=document.createElement("img")).setAttribute("id",_via_img_buffer_get_html_id(_)),_via_img_src[t]=_via_img_src[t].replace("#","%23"),n.setAttribute("src",_via_img_src[t]),_via_img_src[t].startsWith("data:image")?n.setAttribute("alt","Source: image data in base64 format"):n.setAttribute("alt","Source: "+_via_img_src[t]),n.addEventListener("abort",function(){project_file_load_on_fail(_),i(_)}),n.addEventListener("error",function(){project_file_load_on_fail(_),i(_)}),n.addEventListener("load",function(){img_stat_set(_,[n.naturalWidth,n.naturalHeight]),_via_img_panel.insertBefore(n,_via_reg_canvas),project_file_load_on_success(_),img_fn_list_ith_entry_add_css_class(_,"buffered");var i=_via_buffer_img_index_list.length;_via_buffer_img_index_list.push(_),_via_buffer_img_shown_timestamp[i]=Date.now(),e(_)},!1)}}else i(_)}},!1)}function _via_img_buffer_get_html_id(_){return"bim"+_}function _via_img_buffer_parse_html_id(_){return parseInt(_.substr(3))}function _via_img_buffer_start_preload(_,e){return new Promise(function(e,i){_via_img_buffer_preload_img(_via_buffer_preload_img_index=_,0).then(function(_){e(_)})})}function _via_img_buffer_preload_img(_,e){return new Promise(function(i,t){var a=_via_img_buffer_get_preload_img_index(_,e);if(_via_buffer_preload_img_index===_via_image_index){if(_via_buffer_img_index_list.length>_via_settings.core.buffer_size)for(;_via_buffer_img_index_list.length>_via_settings.core.buffer_size;)if(_via_img_buffer_remove_least_useful_img(),_via_image_index!==_via_buffer_preload_img_index)return void i([]);_via_img_buffer_add_image(a).then(function(t){if(_via_image_index===_via_buffer_preload_img_index){var a=e+1;a!==VIA_IMG_PRELOAD_COUNT?_via_img_buffer_preload_img(_,a).then(function(_){_.push(t),i(_)}):i([t])}else i([t])},function(t){var a=e+1;a!==VIA_IMG_PRELOAD_COUNT?_via_img_buffer_preload_img(_,a).then(function(_){i(_)}):i([])})}else i([])})}function _via_img_buffer_get_preload_img_index(_,e){var i=_+VIA_IMG_PRELOAD_INDICES[e];return(i<0||i>=_via_img_count)&&(i<0?i=_via_img_count+i:i-=_via_img_count),i}function _via_img_buffer_remove_least_useful_img(){var _=_via_buffer_get_oldest_in_list(_via_buffer_img_not_in_preload_list());_via_buffer_img_index_list[_]!==_via_image_index?_via_buffer_remove(_):_via_buffer_remove(_via_buffer_get_buffer_furthest_from_current_img())}function _via_buffer_remove(_){var e=_via_buffer_img_index_list[_],i=_via_img_buffer_get_html_id(e),t=document.getElementById(i);t&&(_via_buffer_img_index_list.splice(_,1),_via_buffer_img_shown_timestamp.splice(_,1),_via_img_panel.removeChild(t),img_fn_list_ith_entry_remove_css_class(e,"buffered"))}function _via_buffer_remove_all(){var _,e;for(e=_via_buffer_img_index_list.length,_=0;_<e;++_){var i=_via_img_buffer_get_html_id(_via_buffer_img_index_list[_]),t=document.getElementById(i);t&&_via_img_panel.removeChild(t)}_via_buffer_img_index_list=[],_via_buffer_img_shown_timestamp=[]}function _via_buffer_get_oldest_in_list(_){var e,i=_.length,t=-1,a=Date.now();for(e=0;e<i;++e){var n=_[e];_via_buffer_img_shown_timestamp[n]<a&&(a=_via_buffer_img_shown_timestamp[e],t=e)}return t}function _via_buffer_get_buffer_furthest_from_current_img(){var _,e,i,t,a=_via_image_index,n=_via_buffer_img_index_list.length,r=0;e=Math.abs(_via_buffer_img_index_list[0]-a),i=_via_img_count-e;var s=Math.min(e,i);for(_=1;_<n;++_)e=Math.abs(_via_buffer_img_index_list[_]-a),i=_via_img_count-e,(t=Math.min(e,i))>s&&(s=t,r=_);return r}function _via_buffer_img_not_in_preload_list(){var _,e=_via_buffer_get_current_preload_list(),i=[];for(_=0;_<_via_buffer_img_index_list.length;++_)e.includes(_via_buffer_img_index_list[_])||i.push(_);return i}function _via_buffer_get_current_preload_list(){var _,e=[_via_image_index],i=_via_image_index;for(_=0;_<VIA_IMG_PRELOAD_COUNT;++_){var t=i+VIA_IMG_PRELOAD_INDICES[_];t<0&&(t=_via_img_count+t),t>=_via_img_count&&(t-=_via_img_count),e.push(t)}return e}function settings_panel_toggle(){_via_display_area_content_name===VIA_DISPLAY_AREA_CONTENT_NAME.SETTINGS?""!==_via_display_area_content_name_prev?set_display_area_content(_via_display_area_content_name_prev):(show_single_image_view(),_via_redraw_rleg_canvas()):(settings_init(),set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.SETTINGS))}function settings_init(){settings_region_visualisation_update_options(),settings_filepath_update_html(),settings_show_current_value()}function settings_save(){var _=!1;document.getElementById("_via_settings.core.default_filepath").value!==_via_settings.core.default_filepath&&(_=!0);var e,i,t=(i=document.getElementById("settings_panel")).getElementsByClassName("value"),a=t.length;for(e=0;e<a;++e){var n=t[e].childNodes[1],r=n.id.split(".");if("_via_settings"===r[0]){var s,o=_via_settings,g=!0;for(s=1;s<r.length-1;++s){if(!o.hasOwnProperty(r[s])){g=!1;break}o=o[r[s]]}if(g){var l=r[r.length-1];""===n.value&&void 0===n.value||(o[l]=n.value)}}}""!==(i=document.getElementById("settings_input_new_filepath")).value&&project_filepath_add(i.value.trim()),(i=document.getElementById("project_name")).value!==_via_settings.project.name&&(i.value=_via_settings.project.name),_&&(_via_file_resolve_all_to_default_filepath(),_via_show_img(_via_image_index)),show_message("Settings saved."),settings_panel_toggle()}function settings_show_current_value(){var _,e=document.getElementById("settings_panel").getElementsByClassName("value"),i=e.length;for(_=0;_<i;++_){var t=e[_].childNodes[1],a=t.id.split(".");if("_via_settings"===a[0]){var n,r=_via_settings,s=!0;for(n=1;n<a.length;++n){if(!r.hasOwnProperty(a[n])){s=!1;break}r=r[a[n]]}s&&(t.value=r)}}}function settings_region_visualisation_update_options(){var _={region_label:{default_option:"__via_region_id__",default_label:"Region id (1, 2, ...)",label_prefix:"Show value of region attribute: "},region_color:{default_option:"__via_default_region_color__",default_label:"Default Region Colour",label_prefix:"Based on value of region attribute: "}};for(var e in _){var i=document.getElementById("_via_settings.ui.image."+e);i.innerHTML="";var t,a=document.createElement("option");for(t in a.setAttribute("value",_[e].default_option),_via_settings.ui.image[e]===_[e].default_option&&a.setAttribute("selected","selected"),a.innerHTML=_[e].default_label,i.appendChild(a),_via_attributes.region){var n=document.createElement("option");n.setAttribute("value",t),n.innerHTML=_[e].label_prefix+t,_via_settings.ui.image.region_label===t&&n.setAttribute("selected","selected"),i.appendChild(n)}}}function settings_filepath_update_html(){var _,e=document.getElementById("_via_settings.core.filepath");for(_ in e.innerHTML="",_via_settings.core.filepath)if(0!==_via_settings.core.filepath[_]){var i=document.createElement("li");i.innerHTML=_+'<span class="text_button" title="Delete image path" onclick="project_filepath_del("'+_+'"); settings_filepath_update_html();">&times;</span>',e.appendChild(i)}}function _via_file_resolve_all_to_default_filepath(){var _;for(_ in _via_img_metadata)_via_img_metadata.hasOwnProperty(_)&&_via_file_resolve_file_to_default_filepath(_)}function _via_file_resolve_file_to_default_filepath(_){_via_img_metadata.hasOwnProperty(_)&&(void 0===_via_img_fileref[_]||!_via_img_fileref[_]instanceof File)&&(is_url(_via_img_metadata[_].filename)?_via_img_src[_]=_via_img_metadata[_].filename:_via_img_src[_]=_via_settings.core.default_filepath+_via_img_metadata[_].filename)}function _via_file_resolve_all(){return new Promise(function(_,e){var i,t,a=[],n=_via_file_get_search_path_list();for(i=0;i<_via_img_count;++i)if(t=_via_image_id_list[i],void 0===_via_img_src[t]||""===_via_img_src[t]){var r=_via_file_resolve(i,n);a.push(r)}Promise.all(a).then(function(e){console.log(e),_()},function(_){console.log(_),e()})})}function _via_file_get_search_path_list(){var _,e=[];for(_ in _via_settings.core.filepath)0!==_via_settings.core.filepath[_]&&e.push(_);return e}function _via_file_resolve(_,e){return new Promise(function(i,t){_via_file_resolve_check_path(_,0,e).then(function(_){i(_)},function(_){t(_)})},!1)}function _via_file_resolve_check_path(_,e,i){return new Promise(function(t,a){var n=_via_image_id_list[_],r=new Image(0,0),s=i[e]+_via_img_metadata[n].filename;is_url(_via_img_metadata[n].filename)&&""!==i[e]&&(s=i[e]+get_filename_from_url(_via_img_metadata[n].filename)),r.setAttribute("src",s),r.addEventListener("load",function(){_via_img_src[n]=s,t(_)},!1),r.addEventListener("abort",function(){a(_)}),r.addEventListener("error",function(){var n=e+1;n<i.length?_via_file_resolve_check_path(_,n,i).then(function(e){t(_)},function(e){a(_)}):a(_)},!1)},!1)}function show_page_404(_){_via_buffer_hide_current_image(),set_display_area_content(VIA_DISPLAY_AREA_CONTENT_NAME.PAGE_404),_via_image_id=_via_image_id_list[_via_image_index=_],_via_current_image_loaded=!1,img_fn_list_ith_entry_selected(_via_image_index,!0),document.getElementById("page_404_filename").innerHTML="["+(_via_image_index+1)+"]"+_via_img_metadata[_via_image_id].filename}function is_url(_){return!!(_.startsWith("http://")||_.startsWith("https://")||_.startsWith("www."))}function get_filename_from_url(_){return _.substring(_.lastIndexOf("/")+1)}function fixfloat(_){return parseFloat(_.toFixed(VIA_FLOAT_PRECISION))}function shape_attribute_fixfloat(_){for(var e in _)switch(e){case"x":case"y":case"width":case"height":case"r":case"rx":case"ry":_[e]=fixfloat(_[e]);break;case"all_points_x":case"all_points_y":for(var i in _[e])_[e][i]=fixfloat(_[e][i])}}function array_intersect(_){if(0===_.length)return[];if(1===_.length)return _[0];var e,i=_[0],t=0;for(e=1;e<_.length;++e)_[e].length<i.length&&(i=_[e],t=e);var a,n=[],r={};for(e=0;e<_.length;++e){var s;for(a=0===e?t:e,s=0;s<_[a].length;++s)r[_[a][s]]===e-1?e===_.length-1?(n.push(_[a][s]),r[_[a][s]]=0):r[_[a][s]]=e:r[_[a][s]]=0}return n}function generate_img_index_list(_){var e=[],i=[];if(""!==_.prev_next_count.value){var t=_.prev_next_count.value.split(",");if(2===t.length){var a=parseInt(t[0]),n=parseInt(t[1]);for(u=_via_image_index-a;u<=_via_image_index+n;u++)i.push(u)}}0!==i.length&&e.push(i);var r=[];if(""!==_.img_index_list.value){var s=_.img_index_list.value.split(",");if(0!==s.length)for(u=0;u<s.length;++u)if(s[u].includes("-")){var o,g=s[u].split("-"),l=parseInt(g[0])-1,d=parseInt(g[1])-1;for(o=l;o<=d;++o)r.push(o)}else r.push(parseInt(s[u])-1)}0!==r.length&&e.push(r);var v=[];if(""!==_.regex.value)for(var c=_.regex.value,u=0;u<_via_image_filename_list.length;++u){null!==_via_image_filename_list[u].match(c)&&v.push(u)}return 0!==v.length&&e.push(v),array_intersect(e)}function img_stat_set(_,e){e.length?_via_img_stat[_]=e:delete _via_img_stat[_]}function img_stat_set_all(){return new Promise(function(_,e){var i,t=[];for(var a in _via_image_id_list)_via_img_stat.hasOwnProperty(a)||(i=_via_image_id_list[a],_via_img_metadata[i].file_attributes.hasOwnProperty("width")&&_via_img_metadata[i].file_attributes.hasOwnProperty("height")?_via_img_stat[a]=[_via_img_metadata[i].file_attributes.width,_via_img_metadata[i].file_attributes.height]:t.push(img_stat_get(a)));t.length?Promise.all(t).then(function(e){_()}.bind(this),function(_){console.warn("Failed to read statistics of all images!"),e()}):_()}.bind(this))}function img_stat_get(_){return new Promise(function(e,i){var t=_via_image_id_list[_],a=document.createElement("img"),n=null;a.addEventListener("load",function(){_via_img_stat[_]=[a.naturalWidth,a.naturalHeight],null!==n&&URL.revokeObjectURL(n),e()}.bind(this)),a.addEventListener("error",function(){_via_img_stat[_]=[-1,-1],null!==n&&URL.revokeObjectURL(n),e()}.bind(this)),_via_img_fileref[t]instanceof File?(n=URL.createObjectURL(_via_img_fileref[t]),a.src=n):a.src=_via_img_src[t]}.bind(this))}function polygon_to_bbox(_){for(var e=1/0,i=-1/0,t=1/0,a=-1/0,n=0;n<_.length;n+=2)_[n]>i&&(i=_[n]),_[n]<e&&(e=_[n]),_[n+1]>a&&(a=_[n+1]),_[n+1]<t&&(t=_[n+1]);return[e,t,i-e,a-t]}_via_region.prototype.prepare_svg_element=function(){this.svg_element=document.createElementNS("http://www.w3.org/2000/svg",this.shape),this.svg_string="<"+this.shape,this.svg_element.setAttributeNS(null,"id",this.id);for(var _=this.svg_attributes.length,e=0;e<_;e++)this.svg_element.setAttributeNS(null,this.svg_attributes[e],this[this.svg_attributes[e]]),this.svg_string+=" "+this.svg_attributes[e]+'="'+this[this.svg_attributes[e]]+'"';this.svg_string+="/>"},_via_region.prototype.get_svg_element=function(){return this.recompute_svg&&(this.prepare_svg_element(),this.recompute_svg=!1),this.svg_element},_via_region.prototype.get_svg_string=function(){return this.recompute_svg&&(this.prepare_svg_element(),this.recompute_svg=!1),this.svg_string},_via_region_rect.prototype.initialize=function(){this.dview[0]<this.dview[2]?(this.x=this.dview[0],this.x2=this.dview[2]):(this.x=this.dview[2],this.x2=this.dview[0]),this.dview[1]<this.dview[3]?(this.y=this.dview[1],this.y2=this.dview[3]):(this.y=this.dview[3],this.y2=this.dview[1]),this.width=this.x2-this.x,this.height=this.y2-this.y,this.recompute_svg=!0},_via_region_circle.prototype.initialize=function(){this.cx=this.dview[0],this.cy=this.dview[1];var _=this.dview[2]-this.dview[0],e=this.dview[3]-this.dview[1];this.r=Math.round(Math.sqrt(_*_+e*e)),this.r2=this.r*this.r,this.recompute_svg=!0},_via_region_ellipse.prototype.initialize=function(){this.cx=this.dview[0],this.cy=this.dview[1],this.rx=Math.abs(this.dview[2]-this.dview[0]),this.ry=Math.abs(this.dview[3]-this.dview[1]),this.inv_rx2=1/(this.rx*this.rx),this.inv_ry2=1/(this.ry*this.ry),this.recompute_svg=!0},_via_region_line.prototype.initialize=function(){this.x1=this.dview[0],this.y1=this.dview[1],this.x2=this.dview[2],this.y2=this.dview[3],this.dx=this.x1-this.x2,this.dy=this.y1-this.y2,this.mconst=this.x1*this.y2-this.x2*this.y1,this.recompute_svg=!0},_via_region_polyline.prototype.initialize=function(){for(var _=this.dview.length,e=new Array(_/2),i=0,t=0;t<_;t+=2)e[i]=this.dview[t]+" "+this.dview[t+1],i++;this.points=e.join(","),this.recompute_svg=!0},_via_region_polygon.prototype.initialize=function(){for(var _=this.dview.length,e=new Array(_/2),i=0,t=0;t<_;t+=2)e[i]=this.dview[t]+" "+this.dview[t+1],i++;this.points=e.join(","),this.recompute_svg=!0},_via_region_point.prototype.initialize=function(){this.cx=this.dview[0],this.cy=this.dview[1],this.r=2,this.r2=this.r*this.r,this.recompute_svg=!0},_via_is_debug_mode||(window.onbeforeunload=function(_){return(_=_||window.event)&&(_.returnValue="Did you save your data?"),"Did you save your data?"});
        </script>

        <div
            id="ToolTipDic"
            class="tooltip_dic"
            style="
                display: none !important;
                visibility: hidden !important;
                position: absolute !important;
                height: auto !important;
                width: auto !important;
                z-index: 1410065406 !important;
                vertical-align: middle;
                padding: 1px;
                margin: 0px !important;
                font-size: 9pt !important;
                line-height: normal !important;
                font-family: '맑은 고딕';
                font-weight: bold;
                color: rgb(0, 0, 0);
                border: 1px solid rgb(112, 112, 112);
                background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(rgb(240, 240, 240)), to(rgb(220, 220, 220)));
                overflow: hidden;
                white-space: nowrap;
                border-radius: 0.2em;
                box-shadow: rgba(0, 0, 0, 0.4) 2px 2px 5px;
                left: 618px !important;
                top: 409px !important;
            "
        ></div>
    </body>
    <loom-container id="lo-engage-ext-container"
        ><div></div>
        <loom-shadow classname="resolved"></loom-shadow
    ></loom-container>
</html>
